<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MongoDB | Qing's Blog</title><meta name="description" content="MongoDB 对MongoDB的初步学习。  MongoDB介绍  MongoDB is a document database with the scalability and flexibility that you want with the querying and indexing that you need.  mongoDB是目前比较流行的一个基于分布式文件存储的数据库，它是一个"><meta name="keywords" content="MongoDB学习"><meta name="author" content="qingbo,qingbo1011@163.com"><meta name="copyright" content="qingbo"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MongoDB"><meta name="twitter:description" content="MongoDB 对MongoDB的初步学习。  MongoDB介绍  MongoDB is a document database with the scalability and flexibility that you want with the querying and indexing that you need.  mongoDB是目前比较流行的一个基于分布式文件存储的数据库，它是一个"><meta name="twitter:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220529151443.png"><meta property="og:type" content="article"><meta property="og:title" content="MongoDB"><meta property="og:url" content="http://www.qingbo1011.top/2022/05/20/MangoDB/"><meta property="og:site_name" content="Qing's Blog"><meta property="og:description" content="MongoDB 对MongoDB的初步学习。  MongoDB介绍  MongoDB is a document database with the scalability and flexibility that you want with the querying and indexing that you need.  mongoDB是目前比较流行的一个基于分布式文件存储的数据库，它是一个"><meta property="og:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220529151443.png"><meta property="article:published_time" content="2022-05-20T00:47:03.000Z"><meta property="article:modified_time" content="2023-10-03T08:16:11.785Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://www.qingbo1011.top/2022/05/20/MangoDB/"><link rel="prev" title="Gin+Websocket+MangoDB实现的IM系统" href="http://www.qingbo1011.top/2022/05/21/Gin+WebSocket+MongoDB%E7%9A%84IM%E5%8D%B3%E6%97%B6%E8%81%8A%E5%A4%A9Demo/"><link rel="next" title="Gin限流" href="http://www.qingbo1011.top/2022/05/10/Gin%E9%99%90%E6%B5%81/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230440.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">87</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">81</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mongodb"><span class="toc-number">1.</span> <span class="toc-text"> MongoDB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mongodb介绍"><span class="toc-number">2.</span> <span class="toc-text"> MongoDB介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mongodb安装"><span class="toc-number">2.1.</span> <span class="toc-text"> MongoDB安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mongodb使用"><span class="toc-number">2.2.</span> <span class="toc-text"> MongoDB使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go操作mongodb"><span class="toc-number">3.</span> <span class="toc-text"> Go操作MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#客户端连接"><span class="toc-number">3.1.</span> <span class="toc-text"> 客户端连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模块配置式连接"><span class="toc-number">3.1.1.</span> <span class="toc-text"> 模块配置式连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crud操作"><span class="toc-number">3.2.</span> <span class="toc-text"> CRUD操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#先了解bson"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 先了解bson</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取db"><span class="toc-number">3.2.2.</span> <span class="toc-text"> 获取db</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取collection"><span class="toc-number">3.2.3.</span> <span class="toc-text"> 获取collection</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建索引"><span class="toc-number">3.2.3.1.</span> <span class="toc-text"> 创建索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看索引"><span class="toc-number">3.2.3.2.</span> <span class="toc-text"> 查看索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert"><span class="toc-number">3.2.4.</span> <span class="toc-text"> Insert</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#insertone"><span class="toc-number">3.2.4.1.</span> <span class="toc-text"> InsertOne</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#insertmany"><span class="toc-number">3.2.4.2.</span> <span class="toc-text"> InsertMany</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#find"><span class="toc-number">3.2.5.</span> <span class="toc-text"> Find</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#find-2"><span class="toc-number">3.2.5.1.</span> <span class="toc-text"> Find</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#findone"><span class="toc-number">3.2.5.2.</span> <span class="toc-text"> FindOne</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#findoneanddelete"><span class="toc-number">3.2.5.3.</span> <span class="toc-text"> FindOneAndDelete</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#findoneandreplace"><span class="toc-number">3.2.5.4.</span> <span class="toc-text"> FindOneAndReplace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#findoneandupdate"><span class="toc-number">3.2.5.5.</span> <span class="toc-text"> FindOneAndUpdate</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update"><span class="toc-number">3.2.6.</span> <span class="toc-text"> Update</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#updateone"><span class="toc-number">3.2.6.1.</span> <span class="toc-text"> UpdateOne</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#updatemany"><span class="toc-number">3.2.6.2.</span> <span class="toc-text"> UpdateMany</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replaceone"><span class="toc-number">3.2.6.3.</span> <span class="toc-text"> ReplaceOne</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete"><span class="toc-number">3.2.7.</span> <span class="toc-text"> Delete</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#deleteone"><span class="toc-number">3.2.7.1.</span> <span class="toc-text"> DeleteOne</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#deletemany"><span class="toc-number">3.2.7.2.</span> <span class="toc-text"> DeleteMany</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#批量操作bulkwrite"><span class="toc-number">3.3.</span> <span class="toc-text"> 批量操作BulkWrite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务transaction"><span class="toc-number">3.4.</span> <span class="toc-text"> 事务transaction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#distinct和count"><span class="toc-number">3.5.</span> <span class="toc-text"> Distinct和Count</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#distinct"><span class="toc-number">3.5.1.</span> <span class="toc-text"> Distinct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count"><span class="toc-number">3.5.2.</span> <span class="toc-text"> Count</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#聚合aggregate"><span class="toc-number">3.6.</span> <span class="toc-text"> 聚合Aggregate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事件监控watch"><span class="toc-number">3.7.</span> <span class="toc-text"> 事件监控Watch</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220529151443.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Qing's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">MongoDB</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2022-05-20 08:47:03"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2022-05-20</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2023-10-03 16:16:11"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2023-10-03</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Database/">Database</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">4.7k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 24 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2022/05/20/MangoDB/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2022/05/20/MangoDB/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="mongodb"><a class="markdownIt-Anchor" href="#mongodb"></a> MongoDB</h1>
<p>对MongoDB的初步学习。</p>
<h1 id="mongodb介绍"><a class="markdownIt-Anchor" href="#mongodb介绍"></a> MongoDB介绍</h1>
<blockquote>
<p><em>MongoDB</em> is a document database with the scalability and flexibility that you want with the querying and indexing that you need.</p>
</blockquote>
<p>mongoDB是目前比较流行的一个基于分布式文件存储的数据库，它是一个介于关系数据库和非关系数据库(NoSQL)之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</p>
<p>mongoDB中将一条数据存储为一个文档（document），数据结构由键值（key-value）对组成。 其中文档类似于我们平常编程中用到的JSON对象。 文档中的字段值可以包含其他文档，数组及文档数组。</p>
<ul>
<li><a href="https://www.mongodb.com/" target="_blank" rel="noopener">MongoDB官网</a></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">MongoDB术语/概念</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">对比SQL术语/概念</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">database</td>
<td style="text-align:center">数据库</td>
<td style="text-align:center">database</td>
</tr>
<tr>
<td style="text-align:center">collection</td>
<td style="text-align:center">集合</td>
<td style="text-align:center">table</td>
</tr>
<tr>
<td style="text-align:center">document</td>
<td style="text-align:center">文档</td>
<td style="text-align:center">row</td>
</tr>
<tr>
<td style="text-align:center">field</td>
<td style="text-align:center">字段</td>
<td style="text-align:center">column</td>
</tr>
<tr>
<td style="text-align:center">index</td>
<td style="text-align:center">index</td>
<td style="text-align:center">索引</td>
</tr>
<tr>
<td style="text-align:center">primary key</td>
<td style="text-align:center">主键 MongoDB自动将<code>_id</code>字段设置为主键</td>
<td style="text-align:center">primary key</td>
</tr>
</tbody>
</table>
<h2 id="mongodb安装"><a class="markdownIt-Anchor" href="#mongodb安装"></a> MongoDB安装</h2>
<p>通过docker安装比较方便。</p>
<p>这里我们以安装MongoDB5.0版本为例。</p>
<p>首先<code>docker pull</code>拉取镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mongo:5.0</span><br></pre></td></tr></table></figure>
<p>接下来<code>docker run</code>启动容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mongodb5 \</span><br><span class="line">-p 27017:27017 \</span><br><span class="line">-v /home/root/dockerVolumes/mongo/mongo5.0:/data/db \</span><br><span class="line">-e MONGO_INITDB_ROOT_USERNAME=root \</span><br><span class="line">-e MONGO_INITDB_ROOT_PASSWORD=1234 --privileged=true \</span><br><span class="line">mongo:5.0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参数说明：</p>
<ul>
<li><code>-d</code>：后台运行容器，并返回容器ID</li>
<li><code>--name mongodb5</code>：为该容器指定名称为mongodb5</li>
<li><code>-p 27017:27017</code>：端口映射（主机(宿主)端口:容器端口），即宿主机开放出27017端口，指向容器内的27017端口</li>
<li><code>-v /home/root/dockerVolumes/mongo/mongo5.0:/data/db</code>：绑定数据卷（/宿主机绝对路径目录:/容器内目录），将容器内的<code>/data/db</code>挂载到宿主机的<code>/home/root/dockerVolumes/mongo/mongo5.0</code>文件夹下</li>
<li><code>-e MONGO_INITDB_ROOT_USERNAME=root</code>：设置环境变量，在这里我们设置MongoDB的root用户</li>
<li><code>-e MONGO_INITDB_ROOT_PASSWORD=1234 --privileged=true</code>：设置环境变量，root用户密码为1234。<code>privileged=true</code> 使得容器内的root拥有真正的root权限</li>
</ul>
</blockquote>
<h2 id="mongodb使用"><a class="markdownIt-Anchor" href="#mongodb使用"></a> MongoDB使用</h2>
<p>MongoDB的使用，玩一玩官网的<code>Getting Started</code>就差不多清楚了。</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/tutorial/getting-started/" target="_blank" rel="noopener">MongoDBGetting Started</a></li>
<li><a href="https://www.mongodb.com/docs/manual/crud/" target="_blank" rel="noopener">MongoDB CRUD Operations</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/sql-comparison/" target="_blank" rel="noopener">SQL to MongoDB Mapping Chart</a></li>
</ul>
<p>这里引入一下李文周老师<a href="https://www.liwenzhou.com/posts/Go/go_mongodb/" target="_blank" rel="noopener">博客</a>的一些内容：</p>
<blockquote>
<p>数据库常用命令：</p>
<p><code>show dbs;</code>：查看数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs;</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line"><span class="built_in">local</span>   0.000GB</span><br><span class="line"><span class="built_in">test</span>    0.000GB</span><br></pre></td></tr></table></figure>
<p><code>use q1mi;</code>：切换到指定数据库，如果不存在该数据库就创建。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; use q1mi;</span><br><span class="line">switched to db q1mi</span><br></pre></td></tr></table></figure>
<p><code>db;</code>：显示当前所在数据库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db;</span><br><span class="line">q1mi</span><br></pre></td></tr></table></figure>
<p><code>db.dropDatabase()</code>：删除当前数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.dropDatabase();</span><br><span class="line">&#123; <span class="string">"ok"</span> : 1 &#125;</span><br></pre></td></tr></table></figure>
<p>数据集常用命令：</p>
<p><code>db.createCollection(name,options)</code>：创建数据集</p>
<ul>
<li>name：数据集名称</li>
<li>options：可选参数，指定内存大小和索引。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.createCollection(<span class="string">"student"</span>);</span><br><span class="line">&#123; <span class="string">"ok"</span> : 1 &#125;</span><br></pre></td></tr></table></figure>
<p><code>show collections;</code>：查看当前数据库中所有集合。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; show collections;</span><br><span class="line">student</span><br></pre></td></tr></table></figure>
<p><code>db.student.drop()</code>：删除指定数据集</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.drop()</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>文档常用命令：</p>
<p>插入一条文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.insertOne(&#123;name:<span class="string">"小王子"</span>,age:18&#125;);</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"insertedId"</span> : ObjectId(<span class="string">"5db149e904b33457f8c02509"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>插入多条文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.insertMany([</span><br><span class="line">... &#123;name:<span class="string">"张三"</span>,age:20&#125;,</span><br><span class="line">... &#123;name:<span class="string">"李四"</span>,age:25&#125;</span><br><span class="line">... ]);</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"insertedIds"</span> : [</span><br><span class="line">		ObjectId(<span class="string">"5db14c4704b33457f8c0250a"</span>),</span><br><span class="line">		ObjectId(<span class="string">"5db14c4704b33457f8c0250b"</span>)</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查询所有文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.find();</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db149e904b33457f8c02509"</span>), <span class="string">"name"</span> : <span class="string">"小王子"</span>, <span class="string">"age"</span> : 18 &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db14c4704b33457f8c0250a"</span>), <span class="string">"name"</span> : <span class="string">"张三"</span>, <span class="string">"age"</span> : 20 &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db14c4704b33457f8c0250b"</span>), <span class="string">"name"</span> : <span class="string">"李四"</span>, <span class="string">"age"</span> : 25 &#125;</span><br></pre></td></tr></table></figure>
<p>查询age&gt;20岁的文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.find(</span><br><span class="line">... &#123;age:&#123;<span class="variable">$gt</span>:20&#125;&#125;</span><br><span class="line">... )</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db14c4704b33457f8c0250b"</span>), <span class="string">"name"</span> : <span class="string">"李四"</span>, <span class="string">"age"</span> : 25 &#125;</span><br></pre></td></tr></table></figure>
<p>更新文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.update(</span><br><span class="line">... &#123;name:<span class="string">"小王子"</span>&#125;,</span><br><span class="line">... &#123;name:<span class="string">"老王子"</span>,age:98&#125;</span><br><span class="line">... );</span><br><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : 1, <span class="string">"nUpserted"</span> : 0, <span class="string">"nModified"</span> : 1 &#125;)</span><br><span class="line">&gt; db.student.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db149e904b33457f8c02509"</span>), <span class="string">"name"</span> : <span class="string">"老王子"</span>, <span class="string">"age"</span> : 98 &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db14c4704b33457f8c0250a"</span>), <span class="string">"name"</span> : <span class="string">"张三"</span>, <span class="string">"age"</span> : 20 &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db14c4704b33457f8c0250b"</span>), <span class="string">"name"</span> : <span class="string">"李四"</span>, <span class="string">"age"</span> : 25 &#125;</span><br></pre></td></tr></table></figure>
<p>删除文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.student.deleteOne(&#123;name:<span class="string">"李四"</span>&#125;);</span><br><span class="line">&#123; <span class="string">"acknowledged"</span> : <span class="literal">true</span>, <span class="string">"deletedCount"</span> : 1 &#125;</span><br><span class="line">&gt; db.student.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db149e904b33457f8c02509"</span>), <span class="string">"name"</span> : <span class="string">"老王子"</span>, <span class="string">"age"</span> : 98 &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5db14c4704b33457f8c0250a"</span>), <span class="string">"name"</span> : <span class="string">"张三"</span>, <span class="string">"age"</span> : 20 &#125;</span><br></pre></td></tr></table></figure>
<p>命令实在太多，更多命令请参阅<a href="https://docs.mongodb.com/manual/mongo/" target="_blank" rel="noopener">官方文档：shell命令</a>和<a href="https://docs.mongodb.com/manual/crud/" target="_blank" rel="noopener">官方文档：CRUD操作</a>。</p>
</blockquote>
<h1 id="go操作mongodb"><a class="markdownIt-Anchor" href="#go操作mongodb"></a> Go操作MongoDB</h1>
<p>对<code>mongo</code>的任何操作，包括<code>Connect</code>、<code>CURD</code>、<code>Disconnect</code>等都离不开一个操作的上下文<code>Context</code>环境，需要一个<code>Context</code>实例作为操作的第一个参数。</p>
<p>参考下面掘金这篇文章就可以学到很多。遇到有不懂的代码直接Google搜英文，很快就能搞懂。</p>
<ul>
<li><strong><a href="https://juejin.cn/post/6908063164726771719#heading-0" target="_blank" rel="noopener">掘金：go语言操作mongodb</a></strong></li>
<li><a href="https://www.liwenzhou.com/posts/Go/go_mongodb/" target="_blank" rel="noopener">Go语言操作mongoDB</a></li>
<li><a href="https://www.mongodb.com/docs/drivers/go/current/" target="_blank" rel="noopener">MongoDB Go Driver</a></li>
<li><strong><a href="https://pkg.go.dev/go.mongodb.org/mongo-driver@v1.9.0/mongo" target="_blank" rel="noopener">MongoDB Go Driver API documentation</a></strong></li>
<li><strong><a href="https://pkg.go.dev/go.mongodb.org/mongo-driver#section-readme" target="_blank" rel="noopener">mongo-driver README</a></strong></li>
</ul>
<h2 id="客户端连接"><a class="markdownIt-Anchor" href="#客户端连接"></a> 客户端连接</h2>
<p>使用<code>mongo.Connect()</code>函数且带用户名密码认证连接：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 使用credential可以直接使用带用户名和密码的uri连接</span></span><br><span class="line">	<span class="comment">// clientOpts := options.Client().ApplyURI("mongodb://username:password@localhost:27017")</span></span><br><span class="line">	credential := options.Credential&#123;</span><br><span class="line">		Username: <span class="string">"root"</span>,</span><br><span class="line">		Password: <span class="string">"1234"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	clientOps := options.Client().ApplyURI(<span class="string">"mongodb://localhost:27017"</span>).SetAuth(credential)</span><br><span class="line">	client, err := mongo.Connect(context.TODO(), clientOps)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;  </span><br><span class="line">    <span class="comment">// 实例化client后，延迟调用断开连接函数</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="模块配置式连接"><a class="markdownIt-Anchor" href="#模块配置式连接"></a> 模块配置式连接</h3>
<p>在实际项目中，通常都会有配置模块，因此最常用的连接方式是将连接配置写在专门的配置模块文件中。</p>
<p>首先编写config：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/mongo/readpref"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ClientOpts mongoClient 连接客户端参数</span></span><br><span class="line"><span class="keyword">var</span> ClientOpts = options.Client().</span><br><span class="line">	SetAuth(options.Credential&#123;</span><br><span class="line">		AuthMechanism: <span class="string">"SCRAM-SHA-1"</span>,</span><br><span class="line">		<span class="comment">//AuthSource:              "anquan",	// 用于身份验证的数据库的名称</span></span><br><span class="line">		Username: <span class="string">"root"</span>,</span><br><span class="line">		Password: <span class="string">"1234"</span>,</span><br><span class="line">	&#125;).</span><br><span class="line">	SetConnectTimeout(time.Second * <span class="number">10</span>).</span><br><span class="line">	SetHosts([]<span class="keyword">string</span>&#123;<span class="string">"localhost:27017"</span>&#125;).</span><br><span class="line">	SetMaxPoolSize(<span class="number">20</span>).</span><br><span class="line">	SetMinPoolSize(<span class="number">5</span>).</span><br><span class="line">	SetReadPreference(readpref.Primary()). <span class="comment">// 默认值是readpref.Primary()（https://www.mongodb.com/docs/manual/core/read-preference/#read-preference）</span></span><br><span class="line">	SetReplicaSet(<span class="string">""</span>)                      <span class="comment">// SetReplicaSet指定集群的副本集名称。（默认为空）</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>有不明确的地方可以点进去看源码，源码中的注释说的非常明确了，以<code>SetReadPreference</code>举例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetReadPreference specifies the read preference to use for read operations. This can also be set through the</span></span><br><span class="line"><span class="comment">// following URI options:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 1. "readPreference" - Specify the read preference mode (e.g. "readPreference=primary").</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 2. "readPreferenceTags": Specify one or more read preference tags</span></span><br><span class="line"><span class="comment">// (e.g. "readPreferenceTags=region:south,datacenter:A").</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 3. "maxStalenessSeconds" (or "maxStaleness"): Specify a maximum replication lag for reads from secondaries in a</span></span><br><span class="line"><span class="comment">// replica set (e.g. "maxStalenessSeconds=10").</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The default is readpref.Primary(). See https://docs.mongodb.com/manual/core/read-preference/#read-preference for</span></span><br><span class="line"><span class="comment">// more information about read preferences.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ClientOptions)</span> <span class="title">SetReadPreference</span><span class="params">(rp *readpref.ReadPref)</span> *<span class="title">ClientOptions</span></span> &#123;</span><br><span class="line">c.ReadPreference = rp</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>然后主模块中引入配置：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// 实例化client后，延迟调用断开连接函数</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="crud操作"><a class="markdownIt-Anchor" href="#crud操作"></a> CRUD操作</h2>
<h3 id="先了解bson"><a class="markdownIt-Anchor" href="#先了解bson"></a> 先了解bson</h3>
<p>使用<code>mongo-driver</code>操作<code>mongodb</code>需要用到该模块提供的<code>bson</code>。主要用来写查询的筛选条件filter、构造文档记录以及接收查询解码的值，也就是在go与mongo之间做<code>序列化</code>。其中，基本只会用到如下三种数据结构：</p>
<ul>
<li>
<p><code>bson.D{}</code>: 对文档(Document)的<strong>有序</strong>描述，<strong>key-value以逗号<code>,</code>分隔</strong>；</p>
<p>如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bson.D&#123;&#123;<span class="string">"bame"</span>,<span class="number">1</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>bson.M{}</code>: Map结构，<strong>key-value以冒号<code>:</code>分隔</strong>，<strong>无序</strong>，使用最方便；</p>
<p>如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bson.M&#123;<span class="string">"name"</span>:<span class="string">"虎哥"</span>,<span class="string">"gender"</span>:<span class="string">"男"</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>bson.A{}</code>: 数组结构，元素要求是<strong>有序</strong>的文档描述，也就是元素是<code>bson.D{}</code>类型。</p>
</li>
</ul>
<h3 id="获取db"><a class="markdownIt-Anchor" href="#获取db"></a> 获取db</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 对mongo的任何操作，包括Connect、CURD、Disconnect等都离不开一个操作的上下文Context环境，需要一个Context实例作为操作的第一个参数。</span></span><br><span class="line">	<span class="comment">// ctx</span></span><br><span class="line">	ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// client</span></span><br><span class="line">	client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 实例化client后，延迟调用断开连接函数</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	db := client.Database(<span class="string">"test"</span>) <span class="comment">// 获取名为test的db</span></span><br><span class="line">	collectionNames, err := db.ListCollectionNames(ctx, bson.M&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"collectionNames: "</span>, collectionNames)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>client的连接方式是上面的模块配置式连接。</p>
</blockquote>
<h3 id="获取collection"><a class="markdownIt-Anchor" href="#获取collection"></a> 获取collection</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// 对mongo的任何操作，包括Connect、CURD、Disconnect等都离不开一个操作的上下文Context环境，需要一个Context实例作为操作的第一个参数。</span></span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 实例化client后，延迟调用断开连接函数</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   db := client.Database(<span class="string">"test"</span>)         <span class="comment">// 获取名为test的db</span></span><br><span class="line">   collection := db.Collection(<span class="string">"person"</span>) <span class="comment">// 获取collection</span></span><br><span class="line">   fmt.Println(<span class="string">"collection:"</span>, collection.Name())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建索引"><a class="markdownIt-Anchor" href="#创建索引"></a> 创建索引</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   db := client.Database(<span class="string">"test"</span>)         <span class="comment">// 获取名为test的db</span></span><br><span class="line">   collection := db.Collection(<span class="string">"person"</span>) <span class="comment">// 获取collection</span></span><br><span class="line">   <span class="comment">// 创建索引</span></span><br><span class="line">   indexView := collection.Indexes()</span><br><span class="line">   indexName := <span class="string">"index_by_name"</span></span><br><span class="line">   indexBackground := <span class="literal">true</span></span><br><span class="line">   indexUnique := <span class="literal">true</span></span><br><span class="line">   indexModel := mongo.IndexModel&#123;</span><br><span class="line">      Keys: bson.D&#123;&#123;<span class="string">"name"</span>, <span class="number">1</span>&#125;&#125;,	<span class="comment">// name字段作为索引（1：索引按升序，-1：索引按降序）</span></span><br><span class="line">      Options: &amp;options.IndexOptions&#123;</span><br><span class="line">         Name:       &amp;indexName,</span><br><span class="line">         Background: &amp;indexBackground,</span><br><span class="line">         Unique:     &amp;indexUnique,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line">   index, err := indexView.CreateOne(ctx, indexModel)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalf(<span class="string">"index created failed. err: %v \n"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"new index name:"</span>, index)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="查看索引"><a class="markdownIt-Anchor" href="#查看索引"></a> 查看索引</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   db := client.Database(<span class="string">"test"</span>)         <span class="comment">// 获取名为test的db</span></span><br><span class="line">   collection := db.Collection(<span class="string">"person"</span>) <span class="comment">// 获取collection</span></span><br><span class="line">   <span class="comment">// 查看索引</span></span><br><span class="line">   indexCursor, err := collection.Indexes().List(ctx)</span><br><span class="line">   <span class="keyword">var</span> indexes []bson.M</span><br><span class="line">   <span class="keyword">if</span> err = indexCursor.All(ctx, &amp;indexes); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(indexes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="insert"><a class="markdownIt-Anchor" href="#insert"></a> Insert</h3>
<h4 id="insertone"><a class="markdownIt-Anchor" href="#insertone"></a> InsertOne</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//db := client.Database("test")         // 获取名为test的db</span></span><br><span class="line">   <span class="comment">//collection := db.Collection("person") // 获取collection</span></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// InsertOne</span></span><br><span class="line">   insertOneResult, err := collection.InsertOne(ctx, bson.M&#123;</span><br><span class="line">      <span class="string">"name"</span>:   <span class="string">"虎哥"</span>,</span><br><span class="line">      <span class="string">"gender"</span>: <span class="string">"男"</span>,</span><br><span class="line">      <span class="string">"level"</span>:  <span class="number">1</span>,</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"id:"</span>, insertOneResult.InsertedID)</span><br><span class="line">   fmt.Println(insertOneResult)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="insertmany"><a class="markdownIt-Anchor" href="#insertmany"></a> InsertMany</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//db := client.Database("test")         // 获取名为test的db</span></span><br><span class="line">   <span class="comment">//collection := db.Collection("person") // 获取collection</span></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// InsertMany</span></span><br><span class="line">   docs := []<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">      bson.M&#123;<span class="string">"name"</span>: <span class="string">"二次元刀哥"</span>, <span class="string">"gender"</span>: <span class="string">"男"</span>, <span class="string">"level"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">      bson.M&#123;<span class="string">"name"</span>: <span class="string">"小亮"</span>, <span class="string">"gender"</span>: <span class="string">"男"</span>, <span class="string">"level"</span>: <span class="number">2</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// Ordered 设置为false表示其中一条插入失败不会影响其他文档的插入，默认为true，一条失败其他都不会被写入</span></span><br><span class="line">   insertManyOptions := options.InsertMany().SetOrdered(<span class="literal">false</span>)</span><br><span class="line">   insertManyResult, err := collection.InsertMany(ctx, docs, insertManyOptions)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"ids:"</span>, insertManyResult.InsertedIDs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="find"><a class="markdownIt-Anchor" href="#find"></a> Find</h3>
<h4 id="find-2"><a class="markdownIt-Anchor" href="#find-2"></a> Find</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// Find</span></span><br><span class="line">   <span class="comment">// SetSort 设置排序字段（1表示升序；-1表示降序）</span></span><br><span class="line">   findOptions := options.Find().SetSort(bson.D&#123;&#123;<span class="string">"level"</span>, <span class="number">1</span>&#125;&#125;)</span><br><span class="line">   findCursor, err := collection.Find(ctx, bson.M&#123;<span class="string">"gender"</span>: <span class="string">"男"</span>&#125;, findOptions)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">var</span> results []bson.M</span><br><span class="line">   err = findCursor.All(ctx, &amp;results)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> _, result := <span class="keyword">range</span> results &#123;</span><br><span class="line">      fmt.Println(result)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="findone"><a class="markdownIt-Anchor" href="#findone"></a> FindOne</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// FindOne</span></span><br><span class="line">   <span class="comment">// 可以使用struct来接收解码结果</span></span><br><span class="line">   <span class="comment">// var result struct &#123;</span></span><br><span class="line">   <span class="comment">//     Name   string</span></span><br><span class="line">   <span class="comment">//     Gender string</span></span><br><span class="line">   <span class="comment">//     Level  int</span></span><br><span class="line">   <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// 或者更好的是直接使用bson.M</span></span><br><span class="line">   <span class="keyword">var</span> result bson.M</span><br><span class="line">   <span class="comment">// 按照level排序并跳过第一个, 且只需返回name、gender字段（SetProjection：1表示包含某些字段；0表示不包含某些字段）</span></span><br><span class="line">   findOneOptions := options.FindOne().SetSkip(<span class="number">1</span>).SetSort(bson.D&#123;&#123;<span class="string">"level"</span>, <span class="number">1</span>&#125;&#125;).SetProjection(bson.D&#123;&#123;<span class="string">"name"</span>, <span class="number">1</span>&#125;, &#123;<span class="string">"gender"</span>, <span class="number">1</span>&#125;&#125;)</span><br><span class="line">   singleResult := collection.FindOne(ctx, bson.M&#123;<span class="string">"level"</span>: <span class="number">0</span>&#125;, findOneOptions)</span><br><span class="line">   err = singleResult.Decode(&amp;result)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="findoneanddelete"><a class="markdownIt-Anchor" href="#findoneanddelete"></a> FindOneAndDelete</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// FindOneAndDelete</span></span><br><span class="line">   findOneAndDeleteOptions := options.FindOneAndDelete().SetProjection(bson.D&#123;&#123;<span class="string">"name"</span>, <span class="number">1</span>&#125;, &#123;<span class="string">"gender"</span>, <span class="number">1</span>&#125;&#125;)</span><br><span class="line">   <span class="keyword">var</span> deleteDocs bson.M</span><br><span class="line">   singleResult := collection.FindOneAndDelete(ctx, bson.M&#123;<span class="string">"name"</span>: <span class="string">"胖虎"</span>&#125;, findOneAndDeleteOptions)</span><br><span class="line">   err = singleResult.Decode(&amp;deleteDocs)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(deleteDocs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="findoneandreplace"><a class="markdownIt-Anchor" href="#findoneandreplace"></a> FindOneAndReplace</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">	<span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// ctx</span></span><br><span class="line">	ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// client</span></span><br><span class="line">	client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">	<span class="comment">// FindOneAndReplace</span></span><br><span class="line">	<span class="comment">// 注意： 返回的是被替换前的document，满足条件的doc将会被完全替换为replacement</span></span><br><span class="line">	<span class="comment">// SetUpsert设置为true：如果没有find到结果，直接插入新结果（默认为false）</span></span><br><span class="line">	findOneAndReplaceOptions := options.FindOneAndReplace().SetUpsert(<span class="literal">true</span>)</span><br><span class="line">	replacement := bson.M&#123;</span><br><span class="line">		<span class="string">"name"</span>:  <span class="string">"张三"</span>,</span><br><span class="line">		<span class="string">"skill"</span>: <span class="string">"打官司"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> replacePersonDoc bson.M</span><br><span class="line">	err = collection.FindOneAndReplace(ctx, bson.M&#123;<span class="string">"name"</span>: <span class="string">"小夫"</span>&#125;, replacement, findOneAndReplaceOptions).Decode(&amp;replacePersonDoc)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(replacePersonDoc)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="findoneandupdate"><a class="markdownIt-Anchor" href="#findoneandupdate"></a> FindOneAndUpdate</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson/primitive"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// FindOneAndUpdate</span></span><br><span class="line">   <span class="comment">// 注意：返回的结果仍然是更新前的document</span></span><br><span class="line">   _id, err := primitive.ObjectIDFromHex(<span class="string">"62920f38b37f84c93079b7b1"</span>) <span class="comment">// 从一个十六进制字符串创建一个新的ObjectID</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   findOneAndUpdateOptions := options.FindOneAndUpdate().SetUpsert(<span class="literal">true</span>)</span><br><span class="line">   <span class="comment">// "$set"：Field Update Operators之一。表示更新字段</span></span><br><span class="line">   update := bson.M&#123;<span class="string">"$set"</span>: bson.M&#123;</span><br><span class="line">      <span class="string">"level"</span>:  <span class="number">0</span>,</span><br><span class="line">      <span class="string">"gender"</span>: <span class="string">"男"</span>,</span><br><span class="line">      <span class="string">"msg"</span>:    <span class="string">"新的field"</span>,</span><br><span class="line">   &#125;&#125;</span><br><span class="line">   <span class="keyword">var</span> toUpdateDoc bson.M</span><br><span class="line">   err = collection.FindOneAndUpdate(ctx, bson.M&#123;<span class="string">"_id"</span>: _id&#125;, update, findOneAndUpdateOptions).Decode(&amp;toUpdateDoc)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(toUpdateDoc)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>FindOneAndReplace</code>：完全替换</li>
<li><code>FindOneAndUpdate</code>：更新指定字段，原有字段会保留</li>
</ul>
</blockquote>
<h3 id="update"><a class="markdownIt-Anchor" href="#update"></a> Update</h3>
<h4 id="updateone"><a class="markdownIt-Anchor" href="#updateone"></a> UpdateOne</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// UpdateOne</span></span><br><span class="line">   updateOptions := options.Update().SetUpsert(<span class="literal">true</span>)</span><br><span class="line">   filter := bson.M&#123;<span class="string">"name"</span>: <span class="string">"小亮"</span>&#125;</span><br><span class="line">   update := bson.M&#123;<span class="string">"$set"</span>: bson.M&#123;<span class="string">"skill"</span>: <span class="string">"整个活！"</span>&#125;&#125;</span><br><span class="line">   updateResult, err := collection.UpdateOne(ctx, filter, update, updateOptions)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Printf(<span class="string">"matched: %v  modified: %v  upserted: %v  upsertedID: %v\n"</span>,</span><br><span class="line">      updateResult.MatchedCount,</span><br><span class="line">      updateResult.ModifiedCount,</span><br><span class="line">      updateResult.UpsertedCount,</span><br><span class="line">      updateResult.UpsertedID)</span><br><span class="line">   fmt.Println(updateResult)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="updatemany"><a class="markdownIt-Anchor" href="#updatemany"></a> UpdateMany</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// UpdateMany</span></span><br><span class="line">   filter := bson.M&#123;<span class="string">"level"</span>: <span class="number">0</span>&#125;</span><br><span class="line">   update := bson.M&#123;<span class="string">"$set"</span>: bson.M&#123;<span class="string">"level"</span>: <span class="number">10</span>&#125;&#125;</span><br><span class="line">   updateResult, err := collection.UpdateMany(ctx, filter, update)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Printf(<span class="string">"matched: %v  modified: %v  upserted: %v  upsertedID: %v\n"</span>,</span><br><span class="line">      updateResult.MatchedCount,</span><br><span class="line">      updateResult.ModifiedCount,</span><br><span class="line">      updateResult.UpsertedCount,</span><br><span class="line">      updateResult.UpsertedID)</span><br><span class="line">   fmt.Println(updateResult)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220529001850.png" alt="" /></p>
</blockquote>
<h4 id="replaceone"><a class="markdownIt-Anchor" href="#replaceone"></a> ReplaceOne</h4>
<p>就影响数据层面和<a href="#FindOneAndReplace">FindOneAndReplace</a>没有差别。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// FindOneAndReplace</span></span><br><span class="line">   replaceOptions := options.Replace().SetUpsert(<span class="literal">true</span>)</span><br><span class="line">   filter := bson.M&#123;<span class="string">"name"</span>: <span class="string">"二次元刀哥"</span>&#125;</span><br><span class="line">   replacement := bson.M&#123;</span><br><span class="line">      <span class="string">"name"</span>:   <span class="string">"二次元"</span>,</span><br><span class="line">      <span class="string">"gender"</span>: <span class="string">"女"</span>,</span><br><span class="line">      <span class="string">"level"</span>:  <span class="number">0</span>,</span><br><span class="line">      <span class="string">"msg"</span>:    <span class="string">"生日快乐"</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   updateResult, err := collection.ReplaceOne(ctx, filter, replacement, replaceOptions)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Printf(<span class="string">"matched: %v  modified: %v  upserted: %v  upsertedID: %v\n"</span>,</span><br><span class="line">      updateResult.MatchedCount,</span><br><span class="line">      updateResult.ModifiedCount,</span><br><span class="line">      updateResult.UpsertedCount,</span><br><span class="line">      updateResult.UpsertedID)</span><br><span class="line">   fmt.Println(updateResult)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="delete"><a class="markdownIt-Anchor" href="#delete"></a> Delete</h3>
<h4 id="deleteone"><a class="markdownIt-Anchor" href="#deleteone"></a> DeleteOne</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// DeleteOne</span></span><br><span class="line">   deleteOptions := options.Delete().SetCollation(&amp;options.Collation&#123;</span><br><span class="line">      CaseLevel: <span class="literal">false</span>, <span class="comment">// 忽略大小写</span></span><br><span class="line">   &#125;)</span><br><span class="line">   filter := bson.M&#123;<span class="string">"name"</span>: <span class="string">"虎哥"</span>&#125;</span><br><span class="line">   deleteResult, err := collection.DeleteOne(ctx, filter, deleteOptions)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"delete count:"</span>, deleteResult.DeletedCount)</span><br><span class="line">   fmt.Println(deleteResult)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="deletemany"><a class="markdownIt-Anchor" href="#deletemany"></a> DeleteMany</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// DeleteMany</span></span><br><span class="line">   deleteOptions := options.Delete().SetCollation(&amp;options.Collation&#123;</span><br><span class="line">      CaseLevel: <span class="literal">false</span>, <span class="comment">// 忽略大小写</span></span><br><span class="line">   &#125;)</span><br><span class="line">   filter := bson.M&#123;<span class="string">"level"</span>: <span class="number">0</span>&#125;</span><br><span class="line">   deleteResult, err := collection.DeleteMany(ctx, filter, deleteOptions)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"delete count:"</span>, deleteResult.DeletedCount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="批量操作bulkwrite"><a class="markdownIt-Anchor" href="#批量操作bulkwrite"></a> 批量操作BulkWrite</h2>
<p><a href="https://juejin.cn/post/6908063164726771719#heading-32" target="_blank" rel="noopener">批量操作BulkWrite</a></p>
<h2 id="事务transaction"><a class="markdownIt-Anchor" href="#事务transaction"></a> 事务transaction</h2>
<p><a href="https://juejin.cn/post/6908063164726771719#heading-33" target="_blank" rel="noopener">事务transaction</a></p>
<h2 id="distinct和count"><a class="markdownIt-Anchor" href="#distinct和count"></a> Distinct和Count</h2>
<h3 id="distinct"><a class="markdownIt-Anchor" href="#distinct"></a> Distinct</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo/options"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//db := client.Database("test")         // 获取名为test的db</span></span><br><span class="line">   <span class="comment">//collection := db.Collection("person") // 获取collection</span></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// Distinct</span></span><br><span class="line">   distinctOptions := options.Distinct().SetMaxTime(time.Second * <span class="number">2</span>)</span><br><span class="line">   <span class="comment">// 返回所有的level值（注意是不同的结果，重复的level值不会重复输出）</span></span><br><span class="line">   fieldName := <span class="string">"level"</span></span><br><span class="line">   filter := bson.M&#123;&#125;</span><br><span class="line">   distinctValues, err := collection.Distinct(ctx, fieldName, filter, distinctOptions)</span><br><span class="line">   <span class="keyword">for</span> _, value := <span class="keyword">range</span> distinctValues &#123;</span><br><span class="line">      fmt.Println(value)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="count"><a class="markdownIt-Anchor" href="#count"></a> Count</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"db/nosql/mongodb/demo01/config"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/bson"</span></span><br><span class="line">   <span class="string">"go.mongodb.org/mongo-driver/mongo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ctx</span></span><br><span class="line">   ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*<span class="number">10</span>)</span><br><span class="line">   <span class="keyword">defer</span> cancelFunc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// client</span></span><br><span class="line">   client, err := mongo.Connect(context.TODO(), config.ClientOpts)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err = client.Disconnect(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="built_in">panic</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   collection := client.Database(<span class="string">"test"</span>).Collection(<span class="string">"person"</span>)</span><br><span class="line">   <span class="comment">// Count</span></span><br><span class="line">   <span class="comment">// EstimatedDocumentCount</span></span><br><span class="line">   totalCount, err := collection.EstimatedDocumentCount(ctx)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(totalCount)</span><br><span class="line">   <span class="comment">// CountDocuments</span></span><br><span class="line">   filter := bson.M&#123;<span class="string">"gender"</span>: <span class="string">"男"</span>&#125;</span><br><span class="line">   count, err := collection.CountDocuments(ctx, filter)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="聚合aggregate"><a class="markdownIt-Anchor" href="#聚合aggregate"></a> 聚合Aggregate</h2>
<p><a href="https://juejin.cn/post/6908063164726771719#heading-41" target="_blank" rel="noopener">聚合Aggregate</a></p>
<h2 id="事件监控watch"><a class="markdownIt-Anchor" href="#事件监控watch"></a> 事件监控Watch</h2>
<p><a href="https://juejin.cn/post/6908063164726771719#heading-42" target="_blank" rel="noopener">事件监控Watch</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:qingbo1011@163.com">qingbo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.qingbo1011.top/2022/05/20/MangoDB/">http://www.qingbo1011.top/2022/05/20/MangoDB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.qingbo1011.top" target="_blank">Qing's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Database/">Database</a><a class="post-meta__tags" href="/tags/Go/">Go</a><a class="post-meta__tags" href="/tags/MongoDB/">MongoDB</a></div><div class="post_share"><div class="social-share" data-image="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20231003161115.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2022/05/21/Gin+WebSocket+MongoDB%E7%9A%84IM%E5%8D%B3%E6%97%B6%E8%81%8A%E5%A4%A9Demo/"><img class="prev_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Gin+Websocket+MangoDB实现的IM系统</div></div></a></div><div class="next-post pull_right"><a href="/2022/05/10/Gin%E9%99%90%E6%B5%81/"><img class="next_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220718144444.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Gin限流</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2022/06/25/Gorm v2/" title="GORM v2操作MySQL"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220806214514.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-25</div><div class="relatedPosts_title">GORM v2操作MySQL</div></div></a></div><div class="relatedPosts_item"><a href="/2022/06/21/Go操作ElasticSearch/" title="Go操作Elasticsearch"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220705111821.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-21</div><div class="relatedPosts_title">Go操作Elasticsearch</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/22/Go操作Redis/" title="Go操作Redis"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220715143752.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-22</div><div class="relatedPosts_title">Go操作Redis</div></div></a></div><div class="relatedPosts_item"><a href="/2022/06/20/Elasticsearch/" title="Elasticsearch"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220621122244.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-20</div><div class="relatedPosts_title">Elasticsearch</div></div></a></div><div class="relatedPosts_item"><a href="/2021/03/25/JDBC（一）/" title="JDBC（一）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220508214453.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-25</div><div class="relatedPosts_title">JDBC（一）</div></div></a></div><div class="relatedPosts_item"><a href="/2021/03/28/JDBC（二）/" title="JDBC（二）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220508214453.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-28</div><div class="relatedPosts_title">JDBC（二）</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'oNS5Emx1qUL3wN5yvPLKol0W-gzGzoHsz',
  appKey: 'ytbw0ho3DMX0FeoAOWa37lf9',
  notify: false,
  verify: false,
  placeholder: 'Stay hungry,stay foolish~',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: 'https://',
  emojiMaps: {"欢呼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100836.gif","笑眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100849.gif","花心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100907.gif","吐舌":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100937.gif","疑问":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100951.gif","滑稽":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101004.gif","太开心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101017.gif","酷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101029.gif","怒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101044.gif","阴险":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101100.gif","委屈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101116.gif","乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101129.gif","你懂的":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101204.gif","小乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101215.gif","突然兴奋":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101228.gif","喷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101241.gif","哈哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101255.gif","喝酒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101305.gif","汗":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101323.gif","笑尿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102004.gif","嘿嘿嘿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102018.gif","真棒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102047.gif","托腮":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102108.gif","微笑":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e3/2018new_weixioa02_org.png","礼貌":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/09/2018new_keai_org.png","笑哭":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/4a/2018new_xiaoku_thumb.png","无奈":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/83/2018new_kuxiao_org.png","爱你":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f6/2018new_aini_org.png","吃瓜":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/01/2018new_chigua_thumb.png","doge":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a1/2018new_doge02_org.png","dog":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/22/2018new_erha_org.png","cat":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7b/2018new_miaomiao_thumb.png","星星眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102225.png","酸了":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102240.png","大哭":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102254.png","傲娇":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102314.png","给心心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102328.png","嘿哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102345.png","custom0":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101410.gif","custom1":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101424.webp","狗头":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101710.png","搬砖中":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101744.png","忙到飞起":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102411.png","裂开":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102426.png","叹气":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102439.png","让我看看":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102456.png","panda0":"https://bbs.res.meizu.com/static/image/smiley/panda/_000.png","panda1":"https://bbs.res.meizu.com/static/image/smiley/panda/_001.png","panda2":"https://bbs.res.meizu.com/static/image/smiley/panda/_002.png","panda3":"https://bbs.res.meizu.com/static/image/smiley/panda/_003.png","panda4":"https://bbs.res.meizu.com/static/image/smiley/panda/_004.png","panda5":"https://bbs.res.meizu.com/static/image/smiley/panda/_005.png","panda6":"https://bbs.res.meizu.com/static/image/smiley/panda/_006.png","panda7":"https://bbs.res.meizu.com/static/image/smiley/panda/_007.png","panda8":"https://bbs.res.meizu.com/static/image/smiley/panda/_008.png","panda9":"https://bbs.res.meizu.com/static/image/smiley/panda/_009.png","panda10":"https://bbs.res.meizu.com/static/image/smiley/panda/_010.png","panda11":"https://bbs.res.meizu.com/static/image/smiley/panda/_011.png","panda12":"https://bbs.res.meizu.com/static/image/smiley/panda/_012.png","panda13":"https://bbs.res.meizu.com/static/image/smiley/panda/_013.png","panda14":"https://bbs.res.meizu.com/static/image/smiley/panda/_014.png","panda15":"https://bbs.res.meizu.com/static/image/smiley/panda/_015.png","panda16":"https://bbs.res.meizu.com/static/image/smiley/panda/_016.png","panda17":"https://bbs.res.meizu.com/static/image/smiley/panda/_017.png","panda18":"https://bbs.res.meizu.com/static/image/smiley/panda/_018.png","panda19":"https://bbs.res.meizu.com/static/image/smiley/panda/_019.png","panda20":"https://bbs.res.meizu.com/static/image/smiley/panda/_020.png","panda21":"https://bbs.res.meizu.com/static/image/smiley/panda/_021.png","panda22":"https://bbs.res.meizu.com/static/image/smiley/panda/_022.png","panda23":"https://bbs.res.meizu.com/static/image/smiley/panda/_023.png","panda24":"https://bbs.res.meizu.com/static/image/smiley/panda/_024.png","panda25":"https://bbs.res.meizu.com/static/image/smiley/panda/_025.png","panda26":"https://bbs.res.meizu.com/static/image/smiley/panda/_026.png","panda27":"https://bbs.res.meizu.com/static/image/smiley/panda/_027.png","panda28":"https://bbs.res.meizu.com/static/image/smiley/panda/_028.png","panda29":"https://bbs.res.meizu.com/static/image/smiley/panda/_029.png"},
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220529151443.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By qingbo</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">宇宙很大，生活更大</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>
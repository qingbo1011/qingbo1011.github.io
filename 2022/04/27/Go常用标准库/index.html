<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Go常用标准库 | Qing's Blog</title><meta name="description" content="Go常用标准库 常用标准库  fmt fmt fmt包实现了类似C语言printf和scanf的格式化I&#x2F;O。主要分为向外输出内容和获取输入内容两大部分。  输出  Print Print系列函数会将内容输出到系统的标准输出，区别在于：  Print()函数直接输出内容 Printf()函数支持格式化输出字符串 Println()函数会在输出内容的结尾添加一个换行符  123func Print"><meta name="keywords" content="Go常用标准库"><meta name="author" content="qingbo,qingbo1011@163.com"><meta name="copyright" content="qingbo"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Go常用标准库"><meta name="twitter:description" content="Go常用标准库 常用标准库  fmt fmt fmt包实现了类似C语言printf和scanf的格式化I&#x2F;O。主要分为向外输出内容和获取输入内容两大部分。  输出  Print Print系列函数会将内容输出到系统的标准输出，区别在于：  Print()函数直接输出内容 Printf()函数支持格式化输出字符串 Println()函数会在输出内容的结尾添加一个换行符  123func Print"><meta name="twitter:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220711144924.png"><meta property="og:type" content="article"><meta property="og:title" content="Go常用标准库"><meta property="og:url" content="http://www.qingbo1011.top/2022/04/27/Go%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/"><meta property="og:site_name" content="Qing's Blog"><meta property="og:description" content="Go常用标准库 常用标准库  fmt fmt fmt包实现了类似C语言printf和scanf的格式化I&#x2F;O。主要分为向外输出内容和获取输入内容两大部分。  输出  Print Print系列函数会将内容输出到系统的标准输出，区别在于：  Print()函数直接输出内容 Printf()函数支持格式化输出字符串 Println()函数会在输出内容的结尾添加一个换行符  123func Print"><meta property="og:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220711144924.png"><meta property="article:published_time" content="2022-04-27T00:47:03.000Z"><meta property="article:modified_time" content="2023-10-03T08:16:11.761Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://www.qingbo1011.top/2022/04/27/Go%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/"><link rel="prev" title="Go排序" href="http://www.qingbo1011.top/2022/04/28/Go%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"><link rel="next" title="Golang进阶——并发编程" href="http://www.qingbo1011.top/2022/04/26/Golang%E8%BF%9B%E9%98%B602%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230440.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">87</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">81</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#go常用标准库"><span class="toc-number">1.</span> <span class="toc-text"> Go常用标准库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fmt"><span class="toc-number">2.</span> <span class="toc-text"> fmt</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#输出"><span class="toc-number">2.1.</span> <span class="toc-text"> 输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#print"><span class="toc-number">2.1.1.</span> <span class="toc-text"> Print</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fprint"><span class="toc-number">2.1.2.</span> <span class="toc-text"> Fprint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sprint"><span class="toc-number">2.1.3.</span> <span class="toc-text"> Sprint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#errorf"><span class="toc-number">2.1.4.</span> <span class="toc-text"> Errorf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#格式化占位符"><span class="toc-number">2.1.5.</span> <span class="toc-text"> 格式化占位符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#通用占位符"><span class="toc-number">2.1.5.1.</span> <span class="toc-text"> 通用占位符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#布尔型"><span class="toc-number">2.1.5.2.</span> <span class="toc-text"> 布尔型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#整型"><span class="toc-number">2.1.5.3.</span> <span class="toc-text"> 整型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#浮点数与复数"><span class="toc-number">2.1.5.4.</span> <span class="toc-text"> 浮点数与复数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字符串和byte"><span class="toc-number">2.1.5.5.</span> <span class="toc-text"> 字符串和[]byte</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#指针"><span class="toc-number">2.1.5.6.</span> <span class="toc-text"> 指针</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#宽度标识符"><span class="toc-number">2.1.5.7.</span> <span class="toc-text"> 宽度标识符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他falg"><span class="toc-number">2.1.5.8.</span> <span class="toc-text"> 其他falg</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#输入"><span class="toc-number">2.2.</span> <span class="toc-text"> 输入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fmtscan"><span class="toc-number">2.2.1.</span> <span class="toc-text"> fmt.Scan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fmtscanf"><span class="toc-number">2.2.2.</span> <span class="toc-text"> fmt.Scanf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fmtscanln"><span class="toc-number">2.2.3.</span> <span class="toc-text"> fmt.Scanln</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bufionewreader"><span class="toc-number">2.2.4.</span> <span class="toc-text"> bufio.NewReader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fscan系列"><span class="toc-number">2.2.5.</span> <span class="toc-text"> Fscan系列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sscan系列"><span class="toc-number">2.2.6.</span> <span class="toc-text"> Sscan系列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#time"><span class="toc-number">3.</span> <span class="toc-text"> Time</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#时间类型"><span class="toc-number">3.1.</span> <span class="toc-text"> 时间类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时间戳"><span class="toc-number">3.2.</span> <span class="toc-text"> 时间戳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时间间隔"><span class="toc-number">3.3.</span> <span class="toc-text"> 时间间隔</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时间操作"><span class="toc-number">3.4.</span> <span class="toc-text"> 时间操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#add"><span class="toc-number">3.4.1.</span> <span class="toc-text"> Add</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub"><span class="toc-number">3.4.2.</span> <span class="toc-text"> Sub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#equal"><span class="toc-number">3.4.3.</span> <span class="toc-text"> Equal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#before"><span class="toc-number">3.4.4.</span> <span class="toc-text"> Before</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#after"><span class="toc-number">3.4.5.</span> <span class="toc-text"> After</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定时器"><span class="toc-number">3.5.</span> <span class="toc-text"> 定时器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时间格式化"><span class="toc-number">3.6.</span> <span class="toc-text"> 时间格式化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解析字符串格式的时间"><span class="toc-number">3.6.1.</span> <span class="toc-text"> 解析字符串格式的时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string转time"><span class="toc-number">3.7.</span> <span class="toc-text"> string转time</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#flag"><span class="toc-number">4.</span> <span class="toc-text"> Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#osargs"><span class="toc-number">4.1.</span> <span class="toc-text"> os.Args</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag参数类型"><span class="toc-number">4.2.</span> <span class="toc-text"> flag参数类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定义命令行flag参数"><span class="toc-number">4.3.</span> <span class="toc-text"> 定义命令行flag参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#flagtype"><span class="toc-number">4.3.1.</span> <span class="toc-text"> flag.Type()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flagtypevar"><span class="toc-number">4.3.2.</span> <span class="toc-text"> flag.TypeVar()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flagparse"><span class="toc-number">4.3.3.</span> <span class="toc-text"> flag.Parse()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag其他函数"><span class="toc-number">4.4.</span> <span class="toc-text"> flag其他函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#完整示例"><span class="toc-number">4.5.</span> <span class="toc-text"> 完整示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#log"><span class="toc-number">5.</span> <span class="toc-text"> Log</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用logger"><span class="toc-number">5.1.</span> <span class="toc-text"> 使用logger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置logger"><span class="toc-number">5.2.</span> <span class="toc-text"> 配置logger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag选项"><span class="toc-number">5.3.</span> <span class="toc-text"> flag选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置日志前缀"><span class="toc-number">5.4.</span> <span class="toc-text"> 配置日志前缀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置日志输出位置"><span class="toc-number">5.5.</span> <span class="toc-text"> 配置日志输出位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建logger"><span class="toc-number">5.6.</span> <span class="toc-text"> 创建logger</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#io操作"><span class="toc-number">6.</span> <span class="toc-text"> IO操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#输入输出的底层原理"><span class="toc-number">6.1.</span> <span class="toc-text"> 输入输出的底层原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件操作相关api"><span class="toc-number">6.2.</span> <span class="toc-text"> 文件操作相关API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打开和关闭文件"><span class="toc-number">6.3.</span> <span class="toc-text"> 打开和关闭文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写文件"><span class="toc-number">6.4.</span> <span class="toc-text"> 写文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读文件"><span class="toc-number">6.5.</span> <span class="toc-text"> 读文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拷贝文件"><span class="toc-number">6.6.</span> <span class="toc-text"> 拷贝文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bufio"><span class="toc-number">6.7.</span> <span class="toc-text"> bufio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ioutil工具包"><span class="toc-number">6.8.</span> <span class="toc-text"> ioutil工具包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例实现一个cat命令"><span class="toc-number">6.9.</span> <span class="toc-text"> 实例：实现一个cat命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#strconv"><span class="toc-number">7.</span> <span class="toc-text"> Strconv</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#string转int"><span class="toc-number">7.1.</span> <span class="toc-text"> string转int</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#int转string"><span class="toc-number">7.2.</span> <span class="toc-text"> int转string</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parse系列函数string转其他类型"><span class="toc-number">7.3.</span> <span class="toc-text"> Parse系列函数：string转其他类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#parsebool"><span class="toc-number">7.3.1.</span> <span class="toc-text"> ParseBool()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parseint"><span class="toc-number">7.3.2.</span> <span class="toc-text"> ParseInt()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parseunit"><span class="toc-number">7.3.3.</span> <span class="toc-text"> ParseUnit()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parsefloat"><span class="toc-number">7.3.4.</span> <span class="toc-text"> ParseFloat()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码示例"><span class="toc-number">7.3.5.</span> <span class="toc-text"> 代码示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#format系列函数其他类型转string"><span class="toc-number">7.4.</span> <span class="toc-text"> Format系列函数：其他类型转string</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#formatbool"><span class="toc-number">7.4.1.</span> <span class="toc-text"> FormatBool()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#formatint"><span class="toc-number">7.4.2.</span> <span class="toc-text"> FormatInt()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#formatuint"><span class="toc-number">7.4.3.</span> <span class="toc-text"> FormatUint()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#formatfloat"><span class="toc-number">7.4.4.</span> <span class="toc-text"> FormatFloat()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码示例-2"><span class="toc-number">7.4.5.</span> <span class="toc-text"> 代码示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他函数"><span class="toc-number">7.5.</span> <span class="toc-text"> 其他函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#isprint"><span class="toc-number">7.5.1.</span> <span class="toc-text"> isPrint()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#canbackquote"><span class="toc-number">7.5.2.</span> <span class="toc-text"> CanBackquote()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他"><span class="toc-number">7.5.3.</span> <span class="toc-text"> 其他</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#template"><span class="toc-number">8.</span> <span class="toc-text"> Template</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#模板示例"><span class="toc-number">8.1.</span> <span class="toc-text"> 模板示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板语法"><span class="toc-number">8.2.</span> <span class="toc-text"> 模板语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注释"><span class="toc-number">8.2.1.</span> <span class="toc-text"> 注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pipeline"><span class="toc-number">8.2.2.</span> <span class="toc-text"> pipeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量"><span class="toc-number">8.2.3.</span> <span class="toc-text"> 变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#条件判断"><span class="toc-number">8.2.4.</span> <span class="toc-text"> 条件判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#range"><span class="toc-number">8.2.5.</span> <span class="toc-text"> range</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#with"><span class="toc-number">8.2.6.</span> <span class="toc-text"> with</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#预定义函数"><span class="toc-number">8.2.7.</span> <span class="toc-text"> 预定义函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#比较函数"><span class="toc-number">8.2.8.</span> <span class="toc-text"> 比较函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义函数"><span class="toc-number">8.2.9.</span> <span class="toc-text"> 自定义函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#嵌套template"><span class="toc-number">8.2.10.</span> <span class="toc-text"> 嵌套template</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http"><span class="toc-number">9.</span> <span class="toc-text"> Http</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#http客户端"><span class="toc-number">9.1.</span> <span class="toc-text"> HTTP客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#get请求示例"><span class="toc-number">9.1.1.</span> <span class="toc-text"> GET请求示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#带参数的get请求示例"><span class="toc-number">9.1.2.</span> <span class="toc-text"> 带参数的GET请求示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#post请求示例"><span class="toc-number">9.1.3.</span> <span class="toc-text"> Post请求示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义client"><span class="toc-number">9.1.4.</span> <span class="toc-text"> 自定义Client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义transport"><span class="toc-number">9.1.5.</span> <span class="toc-text"> 自定义Transport</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http服务端"><span class="toc-number">9.2.</span> <span class="toc-text"> HTTP服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#默认的server"><span class="toc-number">9.2.1.</span> <span class="toc-text"> 默认的Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#默认的server示例"><span class="toc-number">9.2.2.</span> <span class="toc-text"> 默认的Server示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义server"><span class="toc-number">9.2.3.</span> <span class="toc-text"> 自定义Server</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#context"><span class="toc-number">10.</span> <span class="toc-text"> Context</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么需要context"><span class="toc-number">10.1.</span> <span class="toc-text"> 为什么需要Context</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基本示例"><span class="toc-number">10.1.1.</span> <span class="toc-text"> 基本示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局变量方式"><span class="toc-number">10.1.2.</span> <span class="toc-text"> 全局变量方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通道方式"><span class="toc-number">10.1.3.</span> <span class="toc-text"> 通道方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#官方版的方案context"><span class="toc-number">10.1.4.</span> <span class="toc-text"> 官方版的方案：context</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#context初识"><span class="toc-number">10.2.</span> <span class="toc-text"> Context初识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#context接口"><span class="toc-number">10.2.1.</span> <span class="toc-text"> Context接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#background和todo"><span class="toc-number">10.2.2.</span> <span class="toc-text"> Background()和TODO()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#with系列函数"><span class="toc-number">10.3.</span> <span class="toc-text"> With系列函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#withcancel"><span class="toc-number">10.3.1.</span> <span class="toc-text"> WithCancel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#withdeadline"><span class="toc-number">10.3.2.</span> <span class="toc-text"> WithDeadline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#withtimeout"><span class="toc-number">10.3.3.</span> <span class="toc-text"> WithTimeout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#withvalue"><span class="toc-number">10.3.4.</span> <span class="toc-text"> WithValue</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用context的注意事项"><span class="toc-number">10.4.</span> <span class="toc-text"> 使用Context的注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#客户端超时取消示例"><span class="toc-number">10.5.</span> <span class="toc-text"> 客户端超时取消示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#server端"><span class="toc-number">10.5.1.</span> <span class="toc-text"> Server端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#client端"><span class="toc-number">10.5.2.</span> <span class="toc-text"> Client端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据格式"><span class="toc-number">11.</span> <span class="toc-text"> 数据格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#json"><span class="toc-number">11.1.</span> <span class="toc-text"> JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#结构体生成json"><span class="toc-number">11.1.1.</span> <span class="toc-text"> 结构体生成json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json解析到结构体"><span class="toc-number">11.1.2.</span> <span class="toc-text"> json解析到结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map生成json"><span class="toc-number">11.1.3.</span> <span class="toc-text"> map生成json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json解析到anymap"><span class="toc-number">11.1.4.</span> <span class="toc-text"> json解析到any（map）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xml"><span class="toc-number">11.2.</span> <span class="toc-text"> XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msgpack"><span class="toc-number">11.3.</span> <span class="toc-text"> MSGPack</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射"><span class="toc-number">12.</span> <span class="toc-text"> 反射</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#变量的内在机制"><span class="toc-number">12.1.</span> <span class="toc-text"> 变量的内在机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反射的使用"><span class="toc-number">12.2.</span> <span class="toc-text"> 反射的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空接口与反射"><span class="toc-number">12.3.</span> <span class="toc-text"> 空接口与反射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#反射获取interface类型信息"><span class="toc-number">12.3.1.</span> <span class="toc-text"> 反射获取interface类型信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#反射获取interface值信息"><span class="toc-number">12.3.2.</span> <span class="toc-text"> 反射获取interface值信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#反射修改值信息"><span class="toc-number">12.3.3.</span> <span class="toc-text"> 反射修改值信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结构体与反射"><span class="toc-number">12.4.</span> <span class="toc-text"> 结构体与反射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查看类型-字段和方法"><span class="toc-number">12.4.1.</span> <span class="toc-text"> 查看类型、字段和方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看匿名字段"><span class="toc-number">12.4.2.</span> <span class="toc-text"> 查看匿名字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改结构体的值"><span class="toc-number">12.4.3.</span> <span class="toc-text"> 修改结构体的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调用方法"><span class="toc-number">12.4.4.</span> <span class="toc-text"> 调用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取字段的tag"><span class="toc-number">12.4.5.</span> <span class="toc-text"> 获取字段的tag</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220711144924.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Qing's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Go常用标准库</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2022-04-27 08:47:03"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2022-04-27</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2023-10-03 16:16:11"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2023-10-03</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Go/">Go</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">17.9k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 76 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2022/04/27/Go%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2022/04/27/Go%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="go常用标准库"><a class="markdownIt-Anchor" href="#go常用标准库"></a> Go常用标准库</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/" target="_blank" rel="noopener">常用标准库</a></p>
<h1 id="fmt"><a class="markdownIt-Anchor" href="#fmt"></a> fmt</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/fmt.html" target="_blank" rel="noopener">fmt</a></p>
<p>fmt包实现了类似C语言printf和scanf的格式化I/O。主要分为向外<strong>输出</strong>内容和获取<strong>输入</strong>内容两大部分。</p>
<h2 id="输出"><a class="markdownIt-Anchor" href="#输出"></a> 输出</h2>
<h3 id="print"><a class="markdownIt-Anchor" href="#print"></a> Print</h3>
<p>Print系列函数会将内容输出到系统的标准输出，区别在于：</p>
<ul>
<li><code>Print()</code>函数直接输出内容</li>
<li><code>Printf()</code>函数支持格式化输出字符串</li>
<li><code>Println()</code>函数会在输出内容的结尾添加一个换行符</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Print</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Printf</span><span class="params">(format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Println</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>举个简单的例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Print(<span class="string">"在终端打印该信息。"</span>)</span><br><span class="line">	name := <span class="string">"qingbo1011.top"</span></span><br><span class="line">	fmt.Printf(<span class="string">"我是：%s\n"</span>, name)</span><br><span class="line">	fmt.Println(<span class="string">"在终端打印单独一行显示"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220622231624.png" alt="" /></p>
<h3 id="fprint"><a class="markdownIt-Anchor" href="#fprint"></a> Fprint</h3>
<p>Fprint系列函数会将内容输出到一个<code>io.Writer</code>接口类型的变量w中，我们通常用这个函数往文件中写入内容。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fprint</span><span class="params">(w io.Writer, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fprintf</span><span class="params">(w io.Writer, format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fprintln</span><span class="params">(w io.Writer, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// 向标准输出写入内容</span></span><br><span class="line">   fmt.Fprintln(os.Stdout, <span class="string">"向标准输出写入内容"</span>)</span><br><span class="line">   openFile, err := os.OpenFile(<span class="string">"./test.txt"</span>, os.O_CREATE|os.O_WRONLY|os.O_APPEND, <span class="number">0644</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"打开文件出错，err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   name := <span class="string">"qingbo1011.top"</span></span><br><span class="line">   <span class="comment">// 向打开的文件句柄中写入内容</span></span><br><span class="line">   fmt.Fprintf(openFile, <span class="string">"往文件中写入信息："</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，只要满足<code>io.Writer</code>接口的类型都支持写入。</p>
<h3 id="sprint"><a class="markdownIt-Anchor" href="#sprint"></a> Sprint</h3>
<p>Sprint系列函数会<strong>把传入的数据生成并返回一个字符串</strong>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sprint</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sprintf</span><span class="params">(format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sprintln</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure>
<p>示例如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str1 := fmt.Sprint(<span class="string">"qingbo1011.top"</span>)</span><br><span class="line">	name := <span class="string">"张三"</span></span><br><span class="line">	age := <span class="number">20</span></span><br><span class="line">	str2 := fmt.Sprintf(<span class="string">"name:%s, age:%v "</span>, name, age)</span><br><span class="line">	str3 := fmt.Sprintln(<span class="string">"qingbo"</span>)</span><br><span class="line">	fmt.Println(str1, str2, str3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220622235157.png" alt="" /></p>
<h3 id="errorf"><a class="markdownIt-Anchor" href="#errorf"></a> Errorf</h3>
<p>Errorf函数<strong>根据format参数生成格式化字符串并返回一个包含该字符串的错误</strong>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Errorf</span><span class="params">(format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span></span><br></pre></td></tr></table></figure>
<p>通常使用这种方式来<strong>自定义错误类型</strong>，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := fmt.Errorf(<span class="string">"这是一个错误"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="格式化占位符"><a class="markdownIt-Anchor" href="#格式化占位符"></a> 格式化占位符</h3>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/fmt.html#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8D%A0%E4%BD%8D%E7%AC%A6" target="_blank" rel="noopener">格式化占位符</a></p>
<p>这里我们按照占位符将被替换的变量类型划分，方便查询和记忆。</p>
<h4 id="通用占位符"><a class="markdownIt-Anchor" href="#通用占位符"></a> 通用占位符</h4>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%v</td>
<td style="text-align:left">值的默认格式表示</td>
</tr>
<tr>
<td style="text-align:center">%+v</td>
<td style="text-align:left">类似%v，但输出结构体时会添加字段名</td>
</tr>
<tr>
<td style="text-align:center">%#v</td>
<td style="text-align:left">值的Go语法表示</td>
</tr>
<tr>
<td style="text-align:center">%T</td>
<td style="text-align:left">打印值的类型</td>
</tr>
<tr>
<td style="text-align:center">%%</td>
<td style="text-align:left">百分号</td>
</tr>
</tbody>
</table>
<h4 id="布尔型"><a class="markdownIt-Anchor" href="#布尔型"></a> 布尔型</h4>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%t</td>
<td style="text-align:left">true或false</td>
</tr>
</tbody>
</table>
<h4 id="整型"><a class="markdownIt-Anchor" href="#整型"></a> 整型</h4>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%b</td>
<td style="text-align:left">表示为二进制</td>
</tr>
<tr>
<td style="text-align:center">%c</td>
<td style="text-align:left">该值对应的unicode码值</td>
</tr>
<tr>
<td style="text-align:center">%d</td>
<td style="text-align:left">表示为十进制</td>
</tr>
<tr>
<td style="text-align:center">%o</td>
<td style="text-align:left">表示为八进制</td>
</tr>
<tr>
<td style="text-align:center">%x</td>
<td style="text-align:left">表示为十六进制，使用a-f</td>
</tr>
<tr>
<td style="text-align:center">%X</td>
<td style="text-align:left">表示为十六进制，使用A-F</td>
</tr>
<tr>
<td style="text-align:center">%U</td>
<td style="text-align:left">表示为Unicode格式：U+1234，等价于”U+%04X”</td>
</tr>
<tr>
<td style="text-align:center">%q</td>
<td style="text-align:left">该值对应的单引号括起来的go语法字符字面值，必要时会采用安全的转义表示</td>
</tr>
</tbody>
</table>
<h4 id="浮点数与复数"><a class="markdownIt-Anchor" href="#浮点数与复数"></a> 浮点数与复数</h4>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%b</td>
<td>无小数部分、二进制指数的科学计数法，如-123456p-78</td>
</tr>
<tr>
<td style="text-align:center">%e</td>
<td>科学计数法，如-1234.456e+78</td>
</tr>
<tr>
<td style="text-align:center">%E</td>
<td>科学计数法，如-1234.456E+78</td>
</tr>
<tr>
<td style="text-align:center">%f</td>
<td>有小数部分但无指数部分，如123.456</td>
</tr>
<tr>
<td style="text-align:center">%F</td>
<td>等价于%f</td>
</tr>
<tr>
<td style="text-align:center">%g</td>
<td>根据实际情况采用%e或%f格式（以获得更简洁、准确的输出）</td>
</tr>
<tr>
<td style="text-align:center">%G</td>
<td>根据实际情况采用%E或%F格式（以获得更简洁、准确的输出）</td>
</tr>
</tbody>
</table>
<h4 id="字符串和byte"><a class="markdownIt-Anchor" href="#字符串和byte"></a> 字符串和[]byte</h4>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%s</td>
<td>直接输出字符串或者[]byte</td>
</tr>
<tr>
<td style="text-align:center">%q</td>
<td>该值对应的双引号括起来的go语法字符串字面值，必要时会采用安全的转义表示</td>
</tr>
<tr>
<td style="text-align:center">%x</td>
<td>每个字节用两字符十六进制数表示（使用a-f</td>
</tr>
<tr>
<td style="text-align:center">%X</td>
<td>每个字节用两字符十六进制数表示（使用A-F）</td>
</tr>
</tbody>
</table>
<h4 id="指针"><a class="markdownIt-Anchor" href="#指针"></a> 指针</h4>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%p</td>
<td>表示为十六进制，并加上前导的0x</td>
</tr>
</tbody>
</table>
<h4 id="宽度标识符"><a class="markdownIt-Anchor" href="#宽度标识符"></a> 宽度标识符</h4>
<p>宽度通过一个紧跟在百分号后面的十进制数指定，如果未指定宽度，则表示值时除必需之外不作填充。精度通过（可选的）宽度后跟点号后跟的十进制数指定。如果未指定精度，会使用默认精度；如果点号后没有跟数字，表示精度为0。举例如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%f</td>
<td>默认宽度，默认精度</td>
</tr>
<tr>
<td style="text-align:center">%9f</td>
<td>宽度9，默认精度</td>
</tr>
<tr>
<td style="text-align:center">%.2f</td>
<td>默认宽度，精度2</td>
</tr>
<tr>
<td style="text-align:center">%9.2f</td>
<td>宽度9，精度2</td>
</tr>
<tr>
<td style="text-align:center">%9.f</td>
<td>宽度9，精度0</td>
</tr>
</tbody>
</table>
<h4 id="其他falg"><a class="markdownIt-Anchor" href="#其他falg"></a> 其他falg</h4>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>+</code></td>
<td>总是输出数值的正负号；对%q（%+q）会生成全部是ASCII字符的输出（通过转义）；</td>
</tr>
<tr>
<td style="text-align:center"><code></code></td>
<td>对数值，正数前加<strong>空格</strong>而负数前加负号；对字符串采用%x或%X时（% x或% X）会给各打印的字节之间加空格</td>
</tr>
<tr>
<td style="text-align:center"><code>-</code></td>
<td>在输出右边填充空白而不是默认的左边（即从默认的右对齐切换为左对齐）</td>
</tr>
<tr>
<td style="text-align:center"><code>#</code></td>
<td>八进制数前加0（%#o），十六进制数前加0x（%#x）或0X（%#X），指针去掉前面的0x（%#p）对%q（%#q），对%U（%#U）会输出空格和单引号括起来的go字面值</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td>使用0而不是空格填充，对于数值类型会把填充的0放在正负号后面</td>
</tr>
</tbody>
</table>
<p>举个例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="string">"张三"</span></span><br><span class="line">	fmt.Printf(<span class="string">"%s\n"</span>, s)</span><br><span class="line">	fmt.Printf(<span class="string">"%5s\n"</span>, s)</span><br><span class="line">	fmt.Printf(<span class="string">"%-5s\n"</span>, s)</span><br><span class="line">	fmt.Printf(<span class="string">"%5.7s\n"</span>, s)</span><br><span class="line">	fmt.Printf(<span class="string">"%-5.7s\n"</span>, s)</span><br><span class="line">	fmt.Printf(<span class="string">"%5.2s\n"</span>, s)</span><br><span class="line">	fmt.Printf(<span class="string">"%05s\n"</span>, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">张三</span><br><span class="line">   张三</span><br><span class="line">张三   </span><br><span class="line">   张三</span><br><span class="line">张三   </span><br><span class="line">   张三</span><br><span class="line">000张三</span><br></pre></td></tr></table></figure>
<h2 id="输入"><a class="markdownIt-Anchor" href="#输入"></a> 输入</h2>
<p>Go语言fmt包下有<code>fmt.Scan</code>、<code>fmt.Scanf</code>、<code>fmt.Scanln</code>三个函数，可以在程序运行过程中从标准输入获取用户的输入。</p>
<h3 id="fmtscan"><a class="markdownIt-Anchor" href="#fmtscan"></a> fmt.Scan</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scan</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Scan()</code>从标准输入扫描文本，读取由<strong>空白符</strong>分隔的值保存到传递给本函数的参数中，<strong>换行符视为空白符</strong>。</li>
<li>本函数返回成功扫描的数据个数和遇到的任何错误。如果读取的数据个数比提供的参数少，会返回一个错误报告原因。</li>
</ul>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> (</span><br><span class="line">      name    <span class="keyword">string</span></span><br><span class="line">      age     <span class="keyword">int</span></span><br><span class="line">      married <span class="keyword">bool</span></span><br><span class="line">   )</span><br><span class="line">   fmt.Print(<span class="string">"请分别输入name age和married："</span>)</span><br><span class="line">   fmt.Scan(&amp;name, &amp;age, &amp;married)</span><br><span class="line">   fmt.Println(name, age, married)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fmt.Scan</code>从标准输入中扫描用户输入的数据，将以<strong>空白符</strong>分隔的数据分别存入指定的参数。</p>
<h3 id="fmtscanf"><a class="markdownIt-Anchor" href="#fmtscanf"></a> fmt.Scanf</h3>
<p>函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scanf</span><span class="params">(format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Scanf</code>从标准输入扫描文本，根据format参数指定的格式去读取由空白符分隔的值保存到传递给本函数的参数中。</li>
<li>本函数返回成功扫描的数据个数和遇到的任何错误。</li>
</ul>
<p>代码示例如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		name    <span class="keyword">string</span></span><br><span class="line">		age     <span class="keyword">int</span></span><br><span class="line">		married <span class="keyword">bool</span></span><br><span class="line">	)</span><br><span class="line">	fmt.Scanf(<span class="string">"1:%s 2:%d 3:%t"</span>, &amp;name, &amp;age, &amp;married)</span><br><span class="line">	fmt.Printf(<span class="string">"扫描结果 name:%s age:%d married:%t \n"</span>, name, age, married)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fmt.Scanf</code>不同于<code>fmt.Scan</code>简单的以空格作为输入数据的分隔符，<code>fmt.Scanf</code>为输入数据指定了具体的输入内容格式，只有按照格式输入数据才会被扫描并存入对应变量。</p>
<h3 id="fmtscanln"><a class="markdownIt-Anchor" href="#fmtscanln"></a> fmt.Scanln</h3>
<p>函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scanln</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Scanln</code>类似<code>Scan</code>，它在遇<strong>到换行时才停止扫描</strong>。最后一个数据后面必须有换行或者到达结束位置。</li>
<li>本函数返回成功扫描的数据个数和遇到的任何错误。</li>
</ul>
<p>具体代码示例如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		name    <span class="keyword">string</span></span><br><span class="line">		age     <span class="keyword">int</span></span><br><span class="line">		married <span class="keyword">bool</span></span><br><span class="line">	)</span><br><span class="line">	fmt.Scanln(&amp;name, &amp;age, &amp;married)</span><br><span class="line">	fmt.Printf(<span class="string">"扫描结果 name:%s age:%d married:%t \n"</span>, name, age, married)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fmt.Scanln</code>遇到回车就结束扫描了，这个比较常用。</p>
<h3 id="bufionewreader"><a class="markdownIt-Anchor" href="#bufionewreader"></a> bufio.NewReader</h3>
<p>有时候我们想完整获取输入的内容，而输入的内容可能包含空格，这种情况下可以使用<code>bufio</code>包来实现。</p>
<p>示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"bufio"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">   <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   reader := bufio.NewReader(os.Stdin) <span class="comment">// 从标准输入生成读对象</span></span><br><span class="line">   fmt.Print(<span class="string">"请输入内容："</span>)</span><br><span class="line">   text, _ := reader.ReadString(<span class="string">'\n'</span>) <span class="comment">// 读到换行</span></span><br><span class="line">   text = strings.TrimSpace(text)</span><br><span class="line">   fmt.Printf(<span class="string">"%#v\n"</span>, text)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="fscan系列"><a class="markdownIt-Anchor" href="#fscan系列"></a> Fscan系列</h3>
<p>这几个函数功能分别类似于<code>fmt.Scan</code>、<code>fmt.Scanf</code>、<code>fmt.Scanln</code>三个函数，只不过它们不是从标准输入中读取数据而是从<code>io.Reader</code>中读取数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fscan</span><span class="params">(r io.Reader, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fscanln</span><span class="params">(r io.Reader, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fscanf</span><span class="params">(r io.Reader, format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="sscan系列"><a class="markdownIt-Anchor" href="#sscan系列"></a> Sscan系列</h3>
<p>这几个函数功能分别类似于<code>fmt.Scan</code>、<code>fmt.Scanf</code>、<code>fmt.Scanln</code>三个函数，只不过它们不是从标准输入中读取数据而是从指定字符串中读取数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sscan</span><span class="params">(str <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sscanln</span><span class="params">(str <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sscanf</span><span class="params">(str <span class="keyword">string</span>, format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<h1 id="time"><a class="markdownIt-Anchor" href="#time"></a> Time</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/time.html" target="_blank" rel="noopener">Time</a></p>
<p>时间和日期是编程中经常会用到的，这里学习一下Go语言内置的time包的基本用法。</p>
<p><code>time</code>包提供了时间的显示和测量用的函数。日历的计算采用的是公历。</p>
<h2 id="时间类型"><a class="markdownIt-Anchor" href="#时间类型"></a> 时间类型</h2>
<p>time.Time类型表示时间。我们可以通过<code>time.Now()</code>函数获取当前的时间对象，然后获取时间对象的年月日时分秒等信息。示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	now := time.Now() <span class="comment">// 获取当前时间</span></span><br><span class="line">	fmt.Printf(<span class="string">"current time:%v\n"</span>, now)	<span class="comment">// current time:2022-06-27 22:47:59.3370572 +0800 CST m=+0.007709001</span></span><br><span class="line"></span><br><span class="line">	year := now.Year()     <span class="comment">//年</span></span><br><span class="line">	month := now.Month()   <span class="comment">//月</span></span><br><span class="line">	day := now.Day()       <span class="comment">//日</span></span><br><span class="line">	hour := now.Hour()     <span class="comment">//小时</span></span><br><span class="line">	minute := now.Minute() <span class="comment">//分钟</span></span><br><span class="line">	second := now.Second() <span class="comment">//秒</span></span><br><span class="line">	fmt.Printf(<span class="string">"%d-%02d-%02d %02d:%02d:%02d\n"</span>, year, month, day, hour, minute, second)	<span class="comment">// 2022-06-27 22:47:59</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="时间戳"><a class="markdownIt-Anchor" href="#时间戳"></a> 时间戳</h2>
<p><strong>时间戳</strong>是自<strong>1970年1月1日（08:00:00GMT）<strong>至当前时间的</strong>总毫秒数</strong>。它也被称为Unix时间戳（UnixTimestamp）。</p>
<p>基于时间对象获取时间戳的示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   now := time.Now()                                 <span class="comment">// 获取当前时间</span></span><br><span class="line">   timestamp1 := now.Unix()                          <span class="comment">// 时间戳</span></span><br><span class="line">   timestamp2 := now.UnixNano()                      <span class="comment">// 纳秒时间戳</span></span><br><span class="line">   fmt.Printf(<span class="string">"current timestamp1:%v\n"</span>, timestamp1) <span class="comment">// current timestamp1:1656341407</span></span><br><span class="line">   fmt.Printf(<span class="string">"current timestamp2:%v\n"</span>, timestamp2) <span class="comment">// current timestamp2:1656341407763484600</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>time.Unix()</code>函数可以将时间戳转为时间格式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   timestamp := <span class="keyword">int64</span>(<span class="number">1656341407</span>)</span><br><span class="line">   t := time.Unix(timestamp, <span class="number">0</span>) <span class="comment">// 将时间戳转为时间格式</span></span><br><span class="line">   fmt.Println(t)               <span class="comment">// 2022-06-27 22:50:07 +0800 CST</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="时间间隔"><a class="markdownIt-Anchor" href="#时间间隔"></a> 时间间隔</h2>
<p><code>time.Duration</code>是time包定义的一个类型，它代表两个时间点之间经过的时间，以纳秒为单位。<code>time.Duration</code>表示一段时间间隔，可表示的最长时间段大约290年。</p>
<p>time包中定义的时间间隔类型的常量如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    Nanosecond  Duration = <span class="number">1</span></span><br><span class="line">    Microsecond          = <span class="number">1000</span> * Nanosecond</span><br><span class="line">    Millisecond          = <span class="number">1000</span> * Microsecond</span><br><span class="line">    Second               = <span class="number">1000</span> * Millisecond</span><br><span class="line">    Minute               = <span class="number">60</span> * Second</span><br><span class="line">    Hour                 = <span class="number">60</span> * Minute</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>例如：<code>time.Duration</code>表示1纳秒，<code>time.Second</code>表示1秒。</p>
<h2 id="时间操作"><a class="markdownIt-Anchor" href="#时间操作"></a> 时间操作</h2>
<h3 id="add"><a class="markdownIt-Anchor" href="#add"></a> Add</h3>
<p>我们在日常的编码过程中可能会遇到要求时间+时间间隔的需求，Go语言的时间对象有提供<code>Add</code>方法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Time)</span> <span class="title">Add</span><span class="params">(d Duration)</span> <span class="title">Time</span></span></span><br></pre></td></tr></table></figure>
<p>举个例子，求一个小时之后的时间：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	now := time.Now()</span><br><span class="line">	later := now.Add(time.Hour) <span class="comment">// 当前时间加1小时后的时间</span></span><br><span class="line">	fmt.Println(later)          <span class="comment">// 2022-06-27 23:54:46.2589154 +0800 CST m=+3600.006495401</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sub"><a class="markdownIt-Anchor" href="#sub"></a> Sub</h3>
<p>求两个时间之间的差值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Time)</span> <span class="title">Sub</span><span class="params">(u Time)</span> <span class="title">Duration</span></span></span><br></pre></td></tr></table></figure>
<p>返回一个时间段t-u。如果结果超出了Duration可以表示的最大值/最小值，将返回最大值/最小值。要获取时间点t-d（d为Duration），可以使用t.Add(-d)。</p>
<h3 id="equal"><a class="markdownIt-Anchor" href="#equal"></a> Equal</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Time)</span> <span class="title">Equal</span><span class="params">(u Time)</span> <span class="title">bool</span></span></span><br></pre></td></tr></table></figure>
<p>判断两个时间是否相同，会考虑时区的影响，因此不同时区标准的时间也可以正确比较。本方法和用<code>t==u</code>不同，这种方法<strong>还会比较地点和时区信息</strong>。</p>
<h3 id="before"><a class="markdownIt-Anchor" href="#before"></a> Before</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Time)</span> <span class="title">Before</span><span class="params">(u Time)</span> <span class="title">bool</span></span></span><br></pre></td></tr></table></figure>
<p>如果t代表的时间点在u之前，返回<code>true</code>；否则返回<code>false</code>。</p>
<h3 id="after"><a class="markdownIt-Anchor" href="#after"></a> After</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Time)</span> <span class="title">After</span><span class="params">(u Time)</span> <span class="title">bool</span></span></span><br></pre></td></tr></table></figure>
<p>如果t代表的时间点在u之后，返回<code>true</code>；否则返回<code>false</code>。</p>
<h2 id="定时器"><a class="markdownIt-Anchor" href="#定时器"></a> 定时器</h2>
<p>使用<code>time.Tick</code>(时间间隔)来设置定时器，定时器的本质上是一个通道（<code>channel</code>）。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ticker := time.Tick(time.Second * <span class="number">2</span>) <span class="comment">// 定义一个2秒间隔的定时器</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="keyword">range</span> ticker &#123;</span><br><span class="line">      fmt.Println(i) <span class="comment">// 每2秒都会执行的任务</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="时间格式化"><a class="markdownIt-Anchor" href="#时间格式化"></a> 时间格式化</h2>
<p>时间类型有一个自带的方法Format进行格式化，需要注意的是<strong>Go语言中格式化时间模板</strong>不是常见的<code>Y-m-d H:M:S</code>，而是使用<strong>Go的诞生时间2006年1月2号15点04分（记忆口诀为2006 1 2 3 4）</strong>。也许这就是技术人员的浪漫吧。（补充：如果想格式化为12小时方式，需指定PM。）</p>
<p>例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   now := time.Now() <span class="comment">// 获取当前时间</span></span><br><span class="line">   <span class="comment">// 格式化的模板为Go的出生时间2006年1月2号15点04分 Mon Jan</span></span><br><span class="line">   <span class="comment">// 24小时制</span></span><br><span class="line">   fmt.Println(now.Format(<span class="string">"2006-01-02 15:04:05.000 Mon Jan"</span>)) <span class="comment">// 2022-06-27 22:59:51.212 Mon Jun</span></span><br><span class="line">   <span class="comment">// 12小时制</span></span><br><span class="line">   fmt.Println(now.Format(<span class="string">"2006-01-02 03:04:05.000 PM Mon Jan"</span>)) <span class="comment">// 2022-06-27 10:59:51.212 PM Mon Jun</span></span><br><span class="line">   fmt.Println(now.Format(<span class="string">"2006/01/02 15:04"</span>))                   <span class="comment">// 2022/06/27 22:59</span></span><br><span class="line">   fmt.Println(now.Format(<span class="string">"15:04 2006/01/02"</span>))                   <span class="comment">// 22:59 2022/06/27</span></span><br><span class="line">   fmt.Println(now.Format(<span class="string">"2006/01/02"</span>))                         <span class="comment">// 2022/06/27</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解析字符串格式的时间"><a class="markdownIt-Anchor" href="#解析字符串格式的时间"></a> 解析字符串格式的时间</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   now := time.Now()</span><br><span class="line">   fmt.Println(now) <span class="comment">// 2022-06-27 23:05:34.8975132 +0800 CST m=+0.006696001</span></span><br><span class="line">   <span class="comment">// 加载时区</span></span><br><span class="line">   location, err := time.LoadLocation(<span class="string">"Asia/Shanghai"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 按照指定时区和指定格式解析字符串时间</span></span><br><span class="line">   str := <span class="string">"2022/06/28 21:15:20"</span> <span class="comment">// 时间字符串</span></span><br><span class="line">   t, err := time.ParseInLocation(<span class="string">"2006/01/02 15:04:05"</span>, str, location)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(t)          <span class="comment">// 2022-06-28 21:15:20 +0800 CST</span></span><br><span class="line">   fmt.Println(t.Sub(now)) <span class="comment">// 22h9m45.1024868s</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="string转time"><a class="markdownIt-Anchor" href="#string转time"></a> string转time</h2>
<p>最近在工作的时候，遇到过将腾讯云返回的时间和阿里云返回的时间字符串转成<code>time.Time</code>类型的问题。这里记录一下。</p>
<p>腾讯云中返回的时间字符串为：<code>&quot;2019-03-24T12:52:28Z&quot;</code>。代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	str := <span class="string">"2019-03-24T12:52:28Z"</span></span><br><span class="line">	t, err := time.Parse(<span class="string">"2006-01-02T15:04:05Z"</span>, str)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>阿里云中返回的时间字符串为：<code>&quot;2022-01-25T10:02Z&quot;</code>。代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   str := <span class="string">"2022-01-25T10:02Z"</span></span><br><span class="line">   t, err := time.Parse(<span class="string">"2006-01-02T15:04Z"</span>, str)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="flag"><a class="markdownIt-Anchor" href="#flag"></a> Flag</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/flag.html" target="_blank" rel="noopener">Flag</a></p>
<p>Go语言内置的<code>flag</code>包实现了<strong>命令行参数</strong>的解析，<code>flag</code>包使得开发命令行工具更为简单。</p>
<h2 id="osargs"><a class="markdownIt-Anchor" href="#osargs"></a> os.Args</h2>
<p>如果你只是简单的想要获取命令行参数，可以像下面的代码示例一样使用<code>os.Args</code>来获取命令行参数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// os.Args是一个[]string</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(os.Args) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> i, arg := <span class="keyword">range</span> os.Args &#123;</span><br><span class="line">         fmt.Printf(<span class="string">"args[%d]=%v\n"</span>, i, arg)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将上面的代码执行<code>go build -o &quot;args_demo.exe&quot;</code>编译之后，生成可执行文件。</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704114232.png" alt="" /></p>
<p>执行：<code>args_demo.exe a b c d</code>。结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704114439.png" alt="" /></p>
<blockquote>
<p>因为是在Windows环境下，所以可执行文件是<code>exe</code>。如果在linux环境下，直接<code>go build -o &quot;args_demo&quot;</code>生成可执行文件，然后<code>args_demo a b c d</code>即可。</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704121055.png" alt="" /></p>
<p>（如果提示<code>go: go.mod file not found in current directory or any parent directory; see 'go help modules'</code>，当然在当前目录或上级目录下执行<code>go mod init 目录名</code>命令即可。）</p>
</blockquote>
<p><code>os.Args</code>是一个存储命令行参数的字符串切片，它的第一个元素是可执行文件的名称。</p>
<h2 id="flag参数类型"><a class="markdownIt-Anchor" href="#flag参数类型"></a> flag参数类型</h2>
<p>flag包支持的命令行参数类型有<code>bool</code>、<code>int</code>、<code>int64</code>、<code>uint</code>、<code>uint64</code>、<code>float</code>、<code>float64</code>、<code>string</code>、<code>time.Duration</code>。</p>
<table>
<thead>
<tr>
<th>flag参数</th>
<th>有效值</th>
</tr>
</thead>
<tbody>
<tr>
<td>字符串flag</td>
<td>合法字符串</td>
</tr>
<tr>
<td>整数flag</td>
<td>1234、0664、0x1234等类型，也可以是负数。</td>
</tr>
<tr>
<td>浮点数flag</td>
<td>合法浮点数</td>
</tr>
<tr>
<td>bool类型flag</td>
<td>1, 0, t, f, T, F, true, false, TRUE, FALSE, True, False。</td>
</tr>
<tr>
<td>时间段flag</td>
<td>任何合法的时间段字符串。如”300ms”、”-1.5h”、”2h45m”。 合法的单位有”ns”、”us” /“µs”、”ms”、”s”、”m”、”h”。</td>
</tr>
</tbody>
</table>
<h2 id="定义命令行flag参数"><a class="markdownIt-Anchor" href="#定义命令行flag参数"></a> 定义命令行flag参数</h2>
<p>有以下两种常用的定义命令行<code>flag</code>参数的方法：</p>
<ul>
<li><code>flag.Type()</code></li>
<li><code>flag.TypeVar()</code></li>
</ul>
<h3 id="flagtype"><a class="markdownIt-Anchor" href="#flagtype"></a> flag.Type()</h3>
<p>基本格式：<code>flag.Type(name flag名, value 默认值, usage 备注说明) *Type</code>。</p>
<p>例如我们要定义姓名、年龄、婚否三个命令行参数，我们可以按如下方式定义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name := flag.String(<span class="string">"name"</span>, <span class="string">"张三"</span>, <span class="string">"姓名"</span>)</span><br><span class="line">age := flag.Int(<span class="string">"age"</span>, <span class="number">18</span>, <span class="string">"年龄"</span>)</span><br><span class="line">married := flag.Bool(<span class="string">"married"</span>, <span class="literal">false</span>, <span class="string">"婚否"</span>)</span><br><span class="line">delay := flag.Duration(<span class="string">"d"</span>, <span class="number">0</span>, <span class="string">"时间间隔"</span>)</span><br></pre></td></tr></table></figure>
<p>需要注意的是，此时name、age、married、delay均为对应类型的<strong>指针</strong>。</p>
<blockquote>
<p>以<code>flag.String为</code>例，源码如下。可以发现返回的类型是<code>*string</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// String defines a string flag with specified name, default value, and usage string.</span></span><br><span class="line"><span class="comment">// The return value is the address of a string variable that stores the value of the flag.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">String</span><span class="params">(name <span class="keyword">string</span>, value <span class="keyword">string</span>, usage <span class="keyword">string</span>)</span> *<span class="title">string</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> CommandLine.String(name, value, usage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="flagtypevar"><a class="markdownIt-Anchor" href="#flagtypevar"></a> flag.TypeVar()</h3>
<p>基本格式：<code>flag.TypeVar(Type指针, name flag名, value 默认值, usage 备注说明)</code> 。</p>
<p>例如我们要定义姓名、年龄、婚否三个命令行参数，我们可以按如下方式定义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> married <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">var</span> delay time.Duration</span><br><span class="line">flag.StringVar(&amp;name, <span class="string">"name"</span>, <span class="string">"张三"</span>, <span class="string">"姓名"</span>)</span><br><span class="line">flag.IntVar(&amp;age, <span class="string">"age"</span>, <span class="number">18</span>, <span class="string">"年龄"</span>)</span><br><span class="line">flag.BoolVar(&amp;married, <span class="string">"married"</span>, <span class="literal">false</span>, <span class="string">"婚否"</span>)</span><br><span class="line">flag.DurationVar(&amp;delay, <span class="string">"d"</span>, <span class="number">0</span>, <span class="string">"时间间隔"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="flagparse"><a class="markdownIt-Anchor" href="#flagparse"></a> flag.Parse()</h3>
<p>通过以上两种方法定义好命令行flag参数后，需要通过调用<code>flag.Parse()</code>来对命令行参数进行解析。</p>
<p>支持的命令行参数格式有以下几种：</p>
<ul>
<li><code>-flag xxx</code> （使用空格，一个<code>-</code>符号）</li>
<li><code>--flag xxx</code> （使用空格，两个<code>-</code>符号）</li>
<li><code>-flag=xxx</code> （使用等号，一个<code>-</code>符号）</li>
<li><code>--flag=xxx</code> （使用等号，两个<code>-</code>符号）</li>
</ul>
<p>其中，<strong>布尔类型的参数必须使用等号的方式指定</strong>。</p>
<p>Flag解析在第一个非flag参数（单个<code>-</code>不是flag参数）之前停止，或者在终止符<code>–</code>之后停止。</p>
<h2 id="flag其他函数"><a class="markdownIt-Anchor" href="#flag其他函数"></a> flag其他函数</h2>
<ul>
<li><code>flag.Args()</code>：返回命令行参数后的其他参数，为[]string类型</li>
<li><code>flag.NArg()</code>：返回命令行参数后的其他参数个数</li>
<li><code>flag.NFlag()</code>：返回使用的命令行参数个数</li>
</ul>
<h2 id="完整示例"><a class="markdownIt-Anchor" href="#完整示例"></a> 完整示例</h2>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"flag"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// flag.TypeVar方式定义命令行参数</span></span><br><span class="line">   <span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line">   <span class="keyword">var</span> age <span class="keyword">int</span></span><br><span class="line">   <span class="keyword">var</span> married <span class="keyword">bool</span></span><br><span class="line">   <span class="keyword">var</span> delay time.Duration</span><br><span class="line">   flag.StringVar(&amp;name, <span class="string">"name"</span>, <span class="string">"张三"</span>, <span class="string">"姓名"</span>)</span><br><span class="line">   flag.IntVar(&amp;age, <span class="string">"age"</span>, <span class="number">18</span>, <span class="string">"年龄"</span>)</span><br><span class="line">   flag.BoolVar(&amp;married, <span class="string">"married"</span>, <span class="literal">false</span>, <span class="string">"婚姻状况"</span>)</span><br><span class="line">   flag.DurationVar(&amp;delay, <span class="string">"d"</span>, <span class="number">0</span>, <span class="string">"延迟的时间间隔"</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 解析命令行参数</span></span><br><span class="line">   flag.Parse()</span><br><span class="line">   fmt.Println(name, age, married, delay)</span><br><span class="line"></span><br><span class="line">   fmt.Println(flag.Args())  <span class="comment">// 返回命令行参数后的其他参数，为[]string类型</span></span><br><span class="line">   fmt.Println(flag.NArg())  <span class="comment">// 返回命令行参数后的其他参数个数</span></span><br><span class="line">   fmt.Println(flag.NFlag()) <span class="comment">// 返回使用的命令行参数个数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码编写完成后，执行<code>go build -o &quot;flag_demo&quot;</code>生成可执行文件。</p>
<p>命令行参数使用提示：<code>./flag_demo -help</code>，结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704131520.png" alt="" /></p>
<p>正常使用命令行flag参数：<code>./flag_demo -name qingbo --age 20 -married=false -d=1h30m</code>，结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704142616.png" alt="" /></p>
<p>使用非flag命令行参数：<code>./flag_demo a b c</code>，结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704142647.png" alt="" /></p>
<h1 id="log"><a class="markdownIt-Anchor" href="#log"></a> Log</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/log.html" target="_blank" rel="noopener">Log</a></p>
<p>Go语言内置的<code>log</code>包实现了简单的日志服务。</p>
<h2 id="使用logger"><a class="markdownIt-Anchor" href="#使用logger"></a> 使用logger</h2>
<p>log包定义了Logger类型，该类型提供了一些格式化输出的方法。本包也提供了一个预定义的“标准”logger，可以通过调用函数<strong>Print系列</strong>(<code>Print</code>|<code>Printf</code>|<code>Println</code>）、<strong>Fatal系列</strong>（<code>Fatal</code>|<code>Fatalf</code>|<code>Fatalln</code>）、和<strong>Panic系列</strong>（<code>Panic</code>|<code>Panicf</code>|<code>Panicln</code>）来使用，比自行创建一个logger对象更容易使用。</p>
<p>例如，我们可以像下面的代码一样直接通过log包来调用上面提到的方法，默认它们会将日志信息打印到终端界面：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   log.Println(<span class="string">"这是一条很普通的日志。"</span>)</span><br><span class="line">   v := <span class="string">"很普通的"</span></span><br><span class="line">   log.Printf(<span class="string">"这是一条%s日志。\n"</span>, v)</span><br><span class="line">   log.Fatalln(<span class="string">"这是一条会触发fatal的日志。"</span>)</span><br><span class="line">   log.Panicln(<span class="string">"这是一条会触发panic的日志。"</span>)    <span class="comment">// Unreachable code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704145342.png" alt="" />、</p>
<blockquote>
<p>可以发现<code>log.Panicln(&quot;这是一条会触发panic的日志。&quot;)</code>并没有被执行到，因为<code>log.Fatalln</code>（<strong>Fatal系列</strong>）会调用<code>os.Exit(1)</code>。</p>
</blockquote>
<p>logger会打印每条日志信息的日期、时间，默认输出到系统的标准错误。Fatal系列函数会在写入日志信息后调用<code>os.Exit(1)</code>。Panic系列函数会在写入日志信息后panic。</p>
<h2 id="配置logger"><a class="markdownIt-Anchor" href="#配置logger"></a> 配置logger</h2>
<p><strong>默认情况下的logger只会提供日志的时间信息</strong>，但是很多情况下我们希望得到更多信息，比如记录该日志的文件名和行号等。log标准库中为我们提供了定制这些设置的方法：</p>
<ul>
<li><code>Flags()</code>函数会返回标准logger的输出配置</li>
<li><code>SetFlags()</code>函数用来设置标准logger的输出配置。</li>
</ul>
<blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Flags returns the output flags for the standard logger.</span></span><br><span class="line"><span class="comment">// The flag bits are Ldate, Ltime, and so on.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Flags</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> std.Flags()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetFlags sets the output flags for the standard logger.</span></span><br><span class="line"><span class="comment">// The flag bits are Ldate, Ltime, and so on.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetFlags</span><span class="params">(flag <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">   std.SetFlags(flag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="flag选项"><a class="markdownIt-Anchor" href="#flag选项"></a> flag选项</h2>
<p><code>log</code>标准库提供了如下的flag选项，它们是一系列定义好的常量。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    <span class="comment">// 控制输出日志信息的细节，不能控制输出的顺序和格式。</span></span><br><span class="line">    <span class="comment">// 输出的日志在每一项后会有一个冒号分隔：例如2009/01/23 01:23:23.123123 /a/b/c/d.go:23: message</span></span><br><span class="line">    Ldate         = <span class="number">1</span> &lt;&lt; <span class="literal">iota</span>     <span class="comment">// 日期：2009/01/23</span></span><br><span class="line">    Ltime                         <span class="comment">// 时间：01:23:23</span></span><br><span class="line">    Lmicroseconds                 <span class="comment">// 微秒级别的时间：01:23:23.123123（用于增强Ltime位）</span></span><br><span class="line">    Llongfile                     <span class="comment">// 文件全路径名+行号： /a/b/c/d.go:23</span></span><br><span class="line">    Lshortfile                    <span class="comment">// 文件名+行号：d.go:23（会覆盖掉Llongfile）</span></span><br><span class="line">    LUTC                          <span class="comment">// 使用UTC时间</span></span><br><span class="line">    LstdFlags     = Ldate | Ltime <span class="comment">// 标准logger的初始值</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>下面我们在记录日志之前先设置一下标准logger的输出选项如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"log"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)</span><br><span class="line">   log.Println(<span class="string">"一条普通的日志"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704170524.png" alt="" /></p>
<h2 id="配置日志前缀"><a class="markdownIt-Anchor" href="#配置日志前缀"></a> 配置日志前缀</h2>
<p><code>log</code>标准库中还提供了关于日志信息前缀的两个方法：</p>
<ul>
<li><code>Prefix()</code>函数用来查看标准logger的输出前缀</li>
<li><code>SetPrefix()</code>函数用来设置输出前缀</li>
</ul>
<blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Prefix returns the output prefix for the standard logger.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Prefix</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> std.Prefix()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetPrefix sets the output prefix for the standard logger.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetPrefix</span><span class="params">(prefix <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">   std.SetPrefix(prefix)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"log"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)</span><br><span class="line">   log.Println(<span class="string">"一条普通的日志"</span>)</span><br><span class="line">   log.SetPrefix(<span class="string">"[前缀]"</span>)</span><br><span class="line">   log.Println(<span class="string">"一条普通的日志"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704171305.png" alt="" /></p>
<p>这样我们就能够在代码中为我们的日志信息添加指定的前缀，方便之后对日志信息进行检索和处理。</p>
<h2 id="配置日志输出位置"><a class="markdownIt-Anchor" href="#配置日志输出位置"></a> 配置日志输出位置</h2>
<ul>
<li><code>SetOutput()</code>函数用来设置标准logger的输出目的地，默认是标准错误输出。</li>
</ul>
<blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetOutput sets the output destination for the standard logger.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetOutput</span><span class="params">(w io.Writer)</span></span> &#123;</span><br><span class="line">   std.mu.Lock()</span><br><span class="line">   <span class="keyword">defer</span> std.mu.Unlock()</span><br><span class="line">   std.out = w</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>例如，下面的代码会把日志输出到当前目录下的test.log文件中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   logFile, err := os.OpenFile(<span class="string">"./test.log"</span>, os.O_CREATE|os.O_WRONLY|os.O_APPEND, <span class="number">0644</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   log.SetOutput(logFile)</span><br><span class="line">   log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)</span><br><span class="line">   log.Println(<span class="string">"一条普通的日志"</span>)</span><br><span class="line">   log.SetPrefix(<span class="string">"[前缀]"</span>)</span><br><span class="line">   log.Println(<span class="string">"一条普通的日志"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704172201.png" alt="" /></p>
<p>如果你要使用标准的logger，我们通常会把上面的配置操作写到<code>init</code>函数中。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   log.Println(<span class="string">"一条普通的日志"</span>)</span><br><span class="line">   log.SetPrefix(<span class="string">"[前缀]"</span>)</span><br><span class="line">   log.Println(<span class="string">"一条普通的日志"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   logFile, err := os.OpenFile(<span class="string">"./test.log"</span>, os.O_CREATE|os.O_WRONLY|os.O_APPEND, <span class="number">0644</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   log.SetOutput(logFile)</span><br><span class="line">   log.SetFlags(log.Llongfile | log.Lmicroseconds | log.Ldate)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建logger"><a class="markdownIt-Anchor" href="#创建logger"></a> 创建logger</h2>
<p>log标准库中还提供了一个创建新logger对象的构造函数：<code>New()</code>，支持我们创建自己的logger示例。</p>
<blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// New creates a new Logger. The out variable sets the destination to which log data will be written.The prefix appears at the beginning of each generated log line, or after the log header if the Lmsgprefix flag is provided.The flag argument defines the logging properties.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(out io.Writer, prefix <span class="keyword">string</span>, flag <span class="keyword">int</span>)</span> *<span class="title">Logger</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Logger&#123;out: out, prefix: prefix, flag: flag&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>New()</code>创建一个Logger对象。其中：</p>
<ul>
<li>参数<code>out</code>设置日志信息写入的目的地</li>
<li>参数<code>prefix</code>会添加到生成的每一条日志前面</li>
<li>参数<code>flag</code>定义日志的属性（时间、文件等等）</li>
</ul>
<p>举个例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   log.New(os.Stdout, <span class="string">"&lt;New&gt;"</span>, log.Lshortfile|log.Ldate|log.Ltime)</span><br><span class="line">   log.Println(<span class="string">"自定义的logger记录的日志"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704175322.png" alt="" /></p>
<p>总结 : Go内置的log库功能有限，例如无法满足记录不同级别日志的情况，我们在实际的项目中根据自己的需要选择使用第三方的日志库，如<strong>logrus</strong>、zap等。</p>
<h1 id="io操作"><a class="markdownIt-Anchor" href="#io操作"></a> IO操作</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/IO%E6%93%8D%E4%BD%9C.html" target="_blank" rel="noopener">IO操作</a></p>
<h2 id="输入输出的底层原理"><a class="markdownIt-Anchor" href="#输入输出的底层原理"></a> 输入输出的底层原理</h2>
<p>终端其实是一个文件，相关实例如下：</p>
<ul>
<li><code>os.Stdin</code>：标准输入的文件实例，类型为<code>*File</code></li>
<li><code>os.Stdout</code>：标准输出的文件实例，类型为<code>*File</code></li>
<li><code>os.Stderr</code>：标准错误输出的文件实例，类型为<code>*File</code></li>
</ul>
<h2 id="文件操作相关api"><a class="markdownIt-Anchor" href="#文件操作相关api"></a> 文件操作相关API</h2>
<ul>
<li><code>func Create(name string) (file *File, err Error)</code>：根据提供的文件名创建新的文件，返回一个文件对象，默认权限是0666</li>
<li><code>func NewFile(fd uintptr, name string) *File</code>：根据文件描述符创建相应的文件，返回一个文件对象</li>
<li><code>func Open(name string) (file *File, err Error)</code>：只读方式打开一个名称为name的文件</li>
<li><code>func OpenFile(name string, flag int, perm uint32) (file *File, err Error)</code>：打开名称为name的文件，flag是打开的方式，只读、读写等，perm是权限</li>
<li><code>func (file *File) Write(b []byte) (n int, err Error)</code>：写入byte类型的信息到文件</li>
<li><code>func (file *File) WriteAt(b []byte, off int64) (n int, err Error)</code>：在指定位置开始写入byte类型的信息</li>
<li><code>func (file *File) WriteString(s string) (ret int, err Error)</code>：写入string信息到文件</li>
<li><code>func (file *File) Read(b []byte) (n int, err Error)</code>：读取数据到b中</li>
<li><code>func (file *File) ReadAt(b []byte, off int64) (n int, err Error)</code>：从off开始读取数据到b中</li>
<li><code>func Remove(name string) Error</code>：删除文件名为name的文件</li>
</ul>
<h2 id="打开和关闭文件"><a class="markdownIt-Anchor" href="#打开和关闭文件"></a> 打开和关闭文件</h2>
<ul>
<li><code>os.Open()</code>函数能够打开一个文件，返回一个<code>*File</code>和一个<code>err</code></li>
<li>对得到的文件实例调用<code>close()</code>方法能够关闭文件</li>
</ul>
<p>例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   file, err := os.Open(<span class="string">"./hello.txt"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   file.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="写文件"><a class="markdownIt-Anchor" href="#写文件"></a> 写文件</h2>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   file, err := os.Create(<span class="string">"./test.txt"</span>) <span class="comment">// 新建文件</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> file.Close()</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">      _, err := file.WriteString(<span class="string">"hello\n"</span>)</span><br><span class="line">      _, err = file.Write([]<span class="keyword">byte</span>(<span class="string">"world\n"</span>))</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         log.Fatalln(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704181121.png" alt="" /></p>
<h2 id="读文件"><a class="markdownIt-Anchor" href="#读文件"></a> 读文件</h2>
<p>文件读取可以用<code>file.Read()</code>和<code>file.ReadAt()</code>，读到文件末尾会返回<code>io.EOF</code>的错误</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   file, err := os.Open(<span class="string">"./test.txt"</span>) <span class="comment">// 打开文件</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> file.Close()</span><br><span class="line">   <span class="keyword">var</span> buf [<span class="number">128</span>]<span class="keyword">byte</span> <span class="comment">// 定义接收文件读取的字节数组</span></span><br><span class="line">   <span class="keyword">var</span> content []<span class="keyword">byte</span></span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      n, err := file.Read(buf[:])</span><br><span class="line">      <span class="keyword">if</span> err == io.EOF &#123; <span class="comment">//  读取结束</span></span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         log.Fatalln(err)</span><br><span class="line">      &#125;</span><br><span class="line">      content = <span class="built_in">append</span>(content, buf[:n]...) <span class="comment">// ...作用：展开slice。通过append合并两个slice</span></span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="keyword">string</span>(content))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220704182452.png" alt="" /></p>
<blockquote>
<p>关于<code>...</code>的用法：函数可变数量参数在go中<code>...</code>有4个用途：</p>
<ol>
<li>函数可变数量参数</li>
<li>展开slice</li>
<li>定义数组时忽略数组元素数量</li>
<li>go命令：go描述软件包列表时，命令使用<code>...</code>作为通配符。此命令测试当前目录及其子目录的所有软件包。（<code>go test ./...</code>）</li>
</ol>
<p>在这里显然是展开列表的作用。关于展开列表：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">   add := []<span class="keyword">int</span>&#123;<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>&#125;</span><br><span class="line">   fmt.Println(s) <span class="comment">// [1 2 3 4 5]</span></span><br><span class="line">   s = <span class="built_in">append</span>(s, <span class="number">1</span>)</span><br><span class="line">   fmt.Println(s)        <span class="comment">// [1 2 3 4 5 1]</span></span><br><span class="line">   s = <span class="built_in">append</span>(s, add...) <span class="comment">// s = append(s, add)当然会报错，所以需要Unpack slice</span></span><br><span class="line">   fmt.Println(s)        <span class="comment">// [1 2 3 4 5 1 9 9 9]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="拷贝文件"><a class="markdownIt-Anchor" href="#拷贝文件"></a> 拷贝文件</h2>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   srcFile, err := os.Open(<span class="string">"./hello.txt"</span>) <span class="comment">// 打开文件</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   newFile, err := os.Create(<span class="string">"./world.txt"</span>) <span class="comment">// 创建新文件</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> srcFile.Close()</span><br><span class="line">   <span class="keyword">defer</span> newFile.Close()</span><br><span class="line">   <span class="comment">// 缓冲读取</span></span><br><span class="line">   buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">200</span>)</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      n, err := srcFile.Read(buf) <span class="comment">// 从源文件中读取</span></span><br><span class="line">      <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">         fmt.Println(<span class="string">"读取完毕"</span>)</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         log.Fatalln(err)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 写出去</span></span><br><span class="line">      _, err = newFile.Write(buf[:n])</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         log.Fatalln(err)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bufio"><a class="markdownIt-Anchor" href="#bufio"></a> bufio</h2>
<p>bufio包实现了带缓冲区的读写，是对文件读写的封装。</p>
<table>
<thead>
<tr>
<th style="text-align:center">模式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">os.O_WRONLY</td>
<td>只写</td>
</tr>
<tr>
<td style="text-align:center">os.O_CREATE</td>
<td>创建文件</td>
</tr>
<tr>
<td style="text-align:center">os.O_RDONLY</td>
<td>只读</td>
</tr>
<tr>
<td style="text-align:center">os.O_RDWR</td>
<td>读写</td>
</tr>
<tr>
<td style="text-align:center">os.O_TRUNC</td>
<td>清空</td>
</tr>
<tr>
<td style="text-align:center">os.O_APPEND</td>
<td>追加</td>
</tr>
</tbody>
</table>
<p>例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bufio"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wr</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 参数2：打开模式，所有模式d都在上面</span></span><br><span class="line">    <span class="comment">// 参数3是权限控制</span></span><br><span class="line">    <span class="comment">// w写 r读 x执行   w  2   r  4   x  1</span></span><br><span class="line">    file, err := os.OpenFile(<span class="string">"./xxx.txt"</span>, os.O_CREATE|os.O_WRONLY, <span class="number">0666</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> file.Close()</span><br><span class="line">    <span class="comment">// 获取writer对象</span></span><br><span class="line">    writer := bufio.NewWriter(file)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        writer.WriteString(<span class="string">"hello\n"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 刷新缓冲区，强制写出</span></span><br><span class="line">    writer.Flush()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">re</span><span class="params">()</span></span> &#123;</span><br><span class="line">    file, err := os.Open(<span class="string">"./xxx.txt"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> file.Close()</span><br><span class="line">    reader := bufio.NewReader(file)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        line, _, err := reader.ReadLine()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(<span class="keyword">string</span>(line))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    re()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ioutil工具包"><a class="markdownIt-Anchor" href="#ioutil工具包"></a> ioutil工具包</h2>
<ul>
<li>工具包写文件</li>
<li>工具包读取文件</li>
</ul>
<p>例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io/ioutil"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wr</span><span class="params">()</span></span> &#123;</span><br><span class="line">   err := ioutil.WriteFile(<span class="string">"./yyy.txt"</span>, []<span class="keyword">byte</span>(<span class="string">"www.5lmh.com"</span>), <span class="number">0666</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">re</span><span class="params">()</span></span> &#123;</span><br><span class="line">   content, err := ioutil.ReadFile(<span class="string">"./yyy.txt"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="keyword">string</span>(content))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   re()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实例实现一个cat命令"><a class="markdownIt-Anchor" href="#实例实现一个cat命令"></a> 实例：实现一个cat命令</h2>
<p>使用文件操作相关知识，模拟实现linux平台<code>cat</code>命令的功能。</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"bufio"</span></span><br><span class="line">   <span class="string">"flag"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   flag.Parse()          <span class="comment">// 解析命令行参数</span></span><br><span class="line">   <span class="keyword">if</span> flag.NArg() == <span class="number">0</span> &#123; <span class="comment">// 如果没有参数默认从标准输入读取内容</span></span><br><span class="line">      cat(bufio.NewReader(os.Stdin))</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 依次读取每个指定文件的内容并打印到终端</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; flag.NArg(); i++ &#123;</span><br><span class="line">      file, err := os.Open(flag.Arg(i))</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Fprintf(os.Stdout, <span class="string">"reading from %s failed, err:%v\n"</span>, flag.Arg(i), err)</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">      cat(bufio.NewReader(file))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cat</span><span class="params">(reader *bufio.Reader)</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      bytes, err := reader.ReadBytes(<span class="string">'\n'</span>) <span class="comment">// 注意是字符</span></span><br><span class="line">      <span class="keyword">if</span> err == io.EOF &#123;                   <span class="comment">// 读取完毕</span></span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Fprintf(os.Stdout, <span class="string">"%s"</span>, bytes)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来<code>go build</code>一下，生成可执行文件：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220705003128.png" alt="" /></p>
<p>随便创建一个文件试一下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220705003232.png" alt="" /></p>
<h1 id="strconv"><a class="markdownIt-Anchor" href="#strconv"></a> Strconv</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/strconv.html" target="_blank" rel="noopener">Strconv</a></p>
<p><code>strconv</code>包实现了基<strong>本数据类型与其字符串表示的转换</strong>，主要有以下常用函数： <code>Atoi()</code>、<code>Itia()</code>、<code>parse</code>系列、<code>format</code>系列、<code>append</code>系列。</p>
<p>更多函数请查看<a href="https://golang.org/pkg/strconv/" target="_blank" rel="noopener">官方文档</a>。</p>
<h2 id="string转int"><a class="markdownIt-Anchor" href="#string转int"></a> string转int</h2>
<p><code>Atoi()</code>函数用于将字符串类型的整数转换为int类型，函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Atoi</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(i <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>如果传入的字符串参数无法转换为int类型，就会返回错误。</p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s1 := <span class="string">"100"</span></span><br><span class="line">	num1, err := strconv.Atoi(s1)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(num1) <span class="comment">// 100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="int转string"><a class="markdownIt-Anchor" href="#int转string"></a> int转string</h2>
<p><code>Itoa()</code>函数用于将int类型数据转换为对应的字符串表示，具体的函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Itoa</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   num1 := <span class="number">1011</span></span><br><span class="line">   s1 := strconv.Itoa(num1)</span><br><span class="line">   fmt.Println(s1) <span class="comment">// 1011</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="parse系列函数string转其他类型"><a class="markdownIt-Anchor" href="#parse系列函数string转其他类型"></a> Parse系列函数：string转其他类型</h2>
<p>Parse类函数用于<strong>转换字符串为给定类型的值</strong>：</p>
<ul>
<li><code>ParseBool()</code></li>
<li><code>ParseFloat()</code></li>
<li><code>ParseInt()</code></li>
<li><code>ParseUint()</code></li>
</ul>
<h3 id="parsebool"><a class="markdownIt-Anchor" href="#parsebool"></a> ParseBool()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseBool</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="params">(value <span class="keyword">bool</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>返回字符串表示的<code>bool</code>值。它接受1、0、t、f、T、F、true、false、True、False、TRUE、FALSE；否则返回错误。</p>
<h3 id="parseint"><a class="markdownIt-Anchor" href="#parseint"></a> ParseInt()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseInt</span><span class="params">(s <span class="keyword">string</span>, base <span class="keyword">int</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(i <span class="keyword">int64</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>返回字符串表示的整数值，接受正负号。</p>
<ul>
<li><code>base</code>：指定进制（2到36），如果base为0，则会从字符串前置判断，”0x”是16进制，”0”是8进制，否则是10进制</li>
<li><code>bitSize</code>：指定结果必须能无溢出赋值的整数类型，0、8、16、32、64 分别代表 int、int8、int16、int32、int64</li>
<li>返回的<code>err</code>是<code>*NumErr</code>类型的，如果语法有误，<code>err.Error = ErrSyntax</code>；如果结果超出类型范围<code>err.Error = ErrRange</code>。</li>
</ul>
<h3 id="parseunit"><a class="markdownIt-Anchor" href="#parseunit"></a> ParseUnit()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseUint</span><span class="params">(s <span class="keyword">string</span>, base <span class="keyword">int</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(n <span class="keyword">uint64</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p><code>ParseUint</code>类似<code>ParseInt</code>但不接受正负号，用于无符号整型。</p>
<h3 id="parsefloat"><a class="markdownIt-Anchor" href="#parsefloat"></a> ParseFloat()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseFloat</span><span class="params">(s <span class="keyword">string</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(f <span class="keyword">float64</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>解析一个表示浮点数的字符串并返回其值。如果s合乎语法规则，函数会返回最为接近s表示值的一个浮点数（使用IEEE754规范舍入）。</p>
<ul>
<li><code>bitSize</code>指定了期望的接收类型，32是float32（返回值可以不改变精确值的赋值给float32），64是float64；</li>
<li>返回值<code>err</code>是<code>*NumErr</code>类型的，语法有误的，<code>err.Error=ErrSyntax</code>；结果超出表示范围的，返回值f为<code>±Inf</code>，<code>err.Error= ErrRange</code>。</li>
</ul>
<h3 id="代码示例"><a class="markdownIt-Anchor" href="#代码示例"></a> 代码示例</h3>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   parseBool, err := strconv.ParseBool(<span class="string">"true"</span>)</span><br><span class="line">   parseInt, err := strconv.ParseInt(<span class="string">"-10"</span>, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">   parseUint, err := strconv.ParseUint(<span class="string">"11"</span>, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">   parseFloat, err := strconv.ParseFloat(<span class="string">"3.1415927"</span>, <span class="number">64</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(parseBool)  <span class="comment">// true</span></span><br><span class="line">   fmt.Println(parseInt)   <span class="comment">// -10</span></span><br><span class="line">   fmt.Println(parseUint)  <span class="comment">// 11</span></span><br><span class="line">   fmt.Println(parseFloat) <span class="comment">// 3.1415927</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="format系列函数其他类型转string"><a class="markdownIt-Anchor" href="#format系列函数其他类型转string"></a> Format系列函数：其他类型转string</h2>
<p>Format系列函数实现了<strong>将给定类型数据格式化为string类型数据</strong>的功能。</p>
<ul>
<li><code>FormatBool()</code></li>
<li><code>FormatInt()</code></li>
<li><code>FormatUint()</code></li>
<li><code>FormatFloat()</code></li>
</ul>
<h3 id="formatbool"><a class="markdownIt-Anchor" href="#formatbool"></a> FormatBool()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FormatBool</span><span class="params">(b <span class="keyword">bool</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure>
<p>根据b的值返回”true”或”false”。</p>
<h3 id="formatint"><a class="markdownIt-Anchor" href="#formatint"></a> FormatInt()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FormatInt</span><span class="params">(i <span class="keyword">int64</span>, base <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure>
<p>返回<code>i</code>的<code>base</code>进制的字符串表示。base 必须在2到36之间，结果中会使用小写字母<code>a</code>到<code>z</code>表示大于10的数字。</p>
<h3 id="formatuint"><a class="markdownIt-Anchor" href="#formatuint"></a> FormatUint()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FormatUint</span><span class="params">(i <span class="keyword">uint64</span>, base <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure>
<p><code>FormatInt()</code>的无符号整数版本。</p>
<h3 id="formatfloat"><a class="markdownIt-Anchor" href="#formatfloat"></a> FormatFloat()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FormatFloat</span><span class="params">(f <span class="keyword">float64</span>, fmt <span class="keyword">byte</span>, prec, bitSize <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure>
<p>函数将浮点数表示为字符串并返回。</p>
<ul>
<li><code>fmt</code>：表示格式：
<ul>
<li><code>f</code>（-ddd.dddd）</li>
<li><code>b</code>（-ddddp±ddd，指数为二进制）</li>
<li><code>e</code>（-d.dddde±dd，十进制指数）</li>
<li><code>E</code>（-d.ddddE±dd，十进制指数）</li>
<li><code>g</code>（指数很大时用<code>e</code>格式，否则<code>f</code>格式）</li>
<li><code>G</code>（指数很大时用<code>E</code>格式，否则<code>f</code>格式）</li>
</ul>
</li>
<li><code>prec</code>：控制精度（排除指数部分）：
<ul>
<li>对<code>f</code>、<code>e</code>、<code>E</code>，它表示小数点后的数字个数</li>
<li>对<code>g</code>、<code>G</code>，它控制总的数字个数</li>
<li>如果<code>prec</code> 为-1，则代表使用最少数量的、但又必需的数字来表示<code>f</code>。</li>
</ul>
</li>
<li><code>bitSize</code>：表示返回结果的来源类型（32：float32、64：float64），会据此进行舍入。</li>
</ul>
<h3 id="代码示例-2"><a class="markdownIt-Anchor" href="#代码示例-2"></a> 代码示例</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   s1 := strconv.FormatBool(<span class="literal">false</span>)</span><br><span class="line">   s2 := strconv.FormatInt(<span class="number">-15</span>, <span class="number">16</span>) <span class="comment">// 返回结果为16进制</span></span><br><span class="line">   s3 := strconv.FormatUint(<span class="number">11</span>, <span class="number">10</span>)</span><br><span class="line">   s4 := strconv.FormatFloat(<span class="number">3.1415926</span>, <span class="string">'E'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line">   fmt.Println(s1) <span class="comment">// false</span></span><br><span class="line">   fmt.Println(s2) <span class="comment">// -f</span></span><br><span class="line">   fmt.Println(s3) <span class="comment">// 11</span></span><br><span class="line">   fmt.Println(s4) <span class="comment">// 3.1415926E+00</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="其他函数"><a class="markdownIt-Anchor" href="#其他函数"></a> 其他函数</h2>
<h3 id="isprint"><a class="markdownIt-Anchor" href="#isprint"></a> isPrint()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsPrint</span><span class="params">(r <span class="keyword">rune</span>)</span> <span class="title">bool</span></span></span><br></pre></td></tr></table></figure>
<p>返回一个字符是否是可打印的，和<code>unicode.IsPrint</code>一样，r必须是：字母（广义）、数字、标点、符号、ASCII空格。</p>
<h3 id="canbackquote"><a class="markdownIt-Anchor" href="#canbackquote"></a> CanBackquote()</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CanBackquote</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span></span><br></pre></td></tr></table></figure>
<p>返回字符串s是否可以不被修改的表示为一个<strong>单行的</strong>、<strong>没有空格</strong>和<code>tab</code>之外控制字符的反引号字符串。</p>
<h3 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h3>
<p>除上文列出的函数外，strconv包中还有Append系列、Quote系列等函数。具体用法可查看<a href="https://golang.org/pkg/strconv/" target="_blank" rel="noopener">官方文档</a>。</p>
<h1 id="template"><a class="markdownIt-Anchor" href="#template"></a> Template</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/template.html" target="_blank" rel="noopener">Template</a></p>
<p><code>html/template</code>包实现了数据驱动的模板，用于生成可对抗代码注入的安全HTML输出。它提供了和<code>text/template</code>包相同的接口，Go语言中输出HTML的场景都应使用<code>text/template</code>包。</p>
<p>在基于MVC的Web架构中，我们通常需要在后端渲染一些数据到HTML文件中，从而实现动态的网页效果。</p>
<h2 id="模板示例"><a class="markdownIt-Anchor" href="#模板示例"></a> 模板示例</h2>
<p>通过将模板应用于一个数据结构（即该数据结构作为模板的参数）来执行，来获得输出。模板中的注释引用数据接口的元素（一般如结构体的字段或者字典的键）来控制执行过程和获取需要呈现的值。模板执行时会遍历结构并将指针表示为<code>.</code>（称之为”dot”）指向运行过程中数据结构的当前位置的值。</p>
<p>用作模板的输入文本必须是utf-8编码的文本。”Action”，数据运算和控制单位，由<code>”“</code>界定；在Action之外的所有文本都不做修改的拷贝到输出中。<strong>Action内部不能有换行，但注释可以有换行</strong>。</p>
<p>HTML文件代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello &#123;&#123;.&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Http Server端代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"html/template"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">"/"</span>, sayHello)</span><br><span class="line">   err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   <span class="comment">// 解析指定文件生成模板对象</span></span><br><span class="line">   teml, err := template.ParseFiles(<span class="string">"./template/hello.html"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 利用给定数据渲染模板，并将结果写入w</span></span><br><span class="line">   teml.Execute(w, <span class="string">"qingbo1011.top"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问<code>http://localhost:8080/</code>，结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220705104316.png" alt="" /></p>
<h2 id="模板语法"><a class="markdownIt-Anchor" href="#模板语法"></a> 模板语法</h2>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/template.html" target="_blank" rel="noopener">模板语法</a></p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220711154016.png" alt="" /></p>
<p>当我们传入一个结构体对象时，我们可以根据<code>.</code>来访问结构体的对应字段。例如：</p>
<p>HTML代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello &#123;&#123;.Name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：&#123;&#123;.Gender&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：&#123;&#123;.Name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Http Server端代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"html/template"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">   Name   <span class="keyword">string</span></span><br><span class="line">   Gender <span class="keyword">string</span></span><br><span class="line">   Age    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">"/"</span>, sayHello)</span><br><span class="line">   err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   <span class="comment">// 解析指定文件生成模板对象</span></span><br><span class="line">   tmpl, err := template.ParseFiles(<span class="string">"./template/hello.html"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(<span class="string">"create template failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 利用给定数据渲染模板，并将结果写入w</span></span><br><span class="line">   user := UserInfo&#123;</span><br><span class="line">      Name:   <span class="string">"张三"</span>,</span><br><span class="line">      Gender: <span class="string">"男"</span>,</span><br><span class="line">      Age:    <span class="number">18</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   tmpl.Execute(w, user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问<code>http://localhost:8080/</code>：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220705104911.png" alt="" /></p>
<p>同理，当我们传入的变量是<code>map</code>时，也可以在模板文件中通过<code>.</code>来根据<code>key</code>取值。</p>
<h3 id="注释"><a class="markdownIt-Anchor" href="#注释"></a> 注释</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x2F;* a comment *&#x2F;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>​    注释，执行时会忽略。可以多行。注释不能嵌套，并且必须紧贴分界符始止。</p>
<h3 id="pipeline"><a class="markdownIt-Anchor" href="#pipeline"></a> pipeline</h3>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/template.html" target="_blank" rel="noopener">模板语法</a></p>
<p>pipeline是指产生数据的操作。Go的模板语法中支持使用管道符号<code>|</code>链接多个命令，用法和unix下的管道类似：<code>|</code>前面的命令会将运算结果(或返回值)传递给后一个命令的最后一个位置。</p>
<p>注意 : 并不是只有使用了<code>|</code>才是pipeline。Go的模板语法中，pipeline的概念是传递数据，只要能产生数据的，都是pipeline。</p>
<h3 id="变量"><a class="markdownIt-Anchor" href="#变量"></a> 变量</h3>
<p>Action里可以初始化一个变量来捕获管道的执行结果。初始化语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$variable :&#x3D; pipeline</span><br></pre></td></tr></table></figure>
<p>其中<code>$variable</code>是变量的名字。声明变量的action不会产生任何输出。</p>
<h3 id="条件判断"><a class="markdownIt-Anchor" href="#条件判断"></a> 条件判断</h3>
<p>Go模板语法中的条件判断有以下几种:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="keyword">if</span> pipeline&#125;&#125; T1 &#123;&#123;end&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="keyword">if</span> pipeline&#125;&#125; T1 &#123;&#123;<span class="keyword">else</span>&#125;&#125; T0 &#123;&#123;end&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="keyword">if</span> pipeline&#125;&#125; T1 &#123;&#123;<span class="keyword">else</span> <span class="keyword">if</span> pipeline&#125;&#125; T0 &#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="range"><a class="markdownIt-Anchor" href="#range"></a> range</h3>
<p>Go的模板语法中使用range关键字进行遍历，有以下两种写法，其中pipeline的值必须是数组、切片、字典或者通道。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="keyword">range</span> pipeline&#125;&#125; T1 &#123;&#123;end&#125;&#125;</span><br><span class="line">如果pipeline的值其长度为<span class="number">0</span>，不会有任何输出</span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="keyword">range</span> pipeline&#125;&#125; T1 &#123;&#123;<span class="keyword">else</span>&#125;&#125; T0 &#123;&#123;end&#125;&#125;</span><br><span class="line">如果pipeline的值其长度为<span class="number">0</span>，则会执行T0。</span><br></pre></td></tr></table></figure>
<h3 id="with"><a class="markdownIt-Anchor" href="#with"></a> with</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;with pipeline&#125;&#125; T1 &#123;&#123;end&#125;&#125;</span><br><span class="line">如果pipeline为empty不产生输出，否则将dot设为pipeline的值并执行T1。不修改外面的dot。</span><br><span class="line"></span><br><span class="line">&#123;&#123;with pipeline&#125;&#125; T1 &#123;&#123;<span class="keyword">else</span>&#125;&#125; T0 &#123;&#123;end&#125;&#125;</span><br><span class="line">如果pipeline为empty，不改变dot并执行T0，否则dot设为pipeline的值并执行T1。</span><br></pre></td></tr></table></figure>
<h3 id="预定义函数"><a class="markdownIt-Anchor" href="#预定义函数"></a> 预定义函数</h3>
<p>执行模板时，函数从两个函数字典中查找：首先是模板函数字典，然后是全局函数字典。一般不在模板内定义函数，而是使用Funcs方法添加函数到模板里。</p>
<p>预定义的全局函数如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">and</span><br><span class="line">    函数返回它的第一个empty参数或者最后一个参数；</span><br><span class="line">    就是说<span class="string">"and x y"</span>等价于<span class="string">"if x then y else x"</span>；所有参数都会执行；</span><br><span class="line">or</span><br><span class="line">    返回第一个非empty参数或者最后一个参数；</span><br><span class="line">    亦即<span class="string">"or x y"</span>等价于<span class="string">"if x then x else y"</span>；所有参数都会执行；</span><br><span class="line">not</span><br><span class="line">    返回它的单个参数的布尔值的否定</span><br><span class="line"><span class="built_in">len</span></span><br><span class="line">    返回它的参数的整数类型长度</span><br><span class="line">index</span><br><span class="line">    执行结果为第一个参数以剩下的参数为索引/键指向的值；</span><br><span class="line">    如<span class="string">"index x 1 2 3"</span>返回x[<span class="number">1</span>][<span class="number">2</span>][<span class="number">3</span>]的值；每个被索引的主体必须是数组、切片或者字典。</span><br><span class="line"><span class="built_in">print</span></span><br><span class="line">    即fmt.Sprint</span><br><span class="line">printf</span><br><span class="line">    即fmt.Sprintf</span><br><span class="line"><span class="built_in">println</span></span><br><span class="line">    即fmt.Sprintln</span><br><span class="line">html</span><br><span class="line">    返回其参数文本表示的HTML逸码等价表示。</span><br><span class="line">urlquery</span><br><span class="line">    返回其参数文本表示的可嵌入URL查询的逸码等价表示。</span><br><span class="line">js</span><br><span class="line">    返回其参数文本表示的JavaScript逸码等价表示。</span><br><span class="line">call</span><br><span class="line">    执行结果是调用第一个参数的返回值，该参数必须是函数类型，其余参数作为调用该函数的参数；</span><br><span class="line">    如<span class="string">"call .X.Y 1 2"</span>等价于<span class="keyword">go</span>语言里的dot.X.Y(<span class="number">1</span>, <span class="number">2</span>)；</span><br><span class="line">    其中Y是函数类型的字段或者字典的值，或者其他类似情况；</span><br><span class="line">    call的第一个参数的执行结果必须是函数类型的值（和预定义函数如<span class="built_in">print</span>明显不同）；</span><br><span class="line">    该函数类型值必须有<span class="number">1</span>到<span class="number">2</span>个返回值，如果有<span class="number">2</span>个则后一个必须是error接口类型；</span><br><span class="line">    如果有<span class="number">2</span>个返回值的方法返回的error非<span class="literal">nil</span>，模板执行会中断并返回给调用模板执行者该错误；</span><br></pre></td></tr></table></figure>
<h3 id="比较函数"><a class="markdownIt-Anchor" href="#比较函数"></a> 比较函数</h3>
<p>布尔函数会将任何类型的零值视为假，其余视为真。</p>
<p>下面是定义为函数的二元比较运算的集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">eq      如果arg1 &#x3D;&#x3D; arg2则返回真</span><br><span class="line">ne      如果arg1 !&#x3D; arg2则返回真</span><br><span class="line">lt      如果arg1 &lt; arg2则返回真</span><br><span class="line">le      如果arg1 &lt;&#x3D; arg2则返回真</span><br><span class="line">gt      如果arg1 &gt; arg2则返回真</span><br><span class="line">ge      如果arg1 &gt;&#x3D; arg2则返回真</span><br></pre></td></tr></table></figure>
<p>为了简化多参数相等检测，eq（只有eq）可以接受2个或更多个参数，它会将第一个参数和其余参数依次比较，返回下式的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;eq arg1 arg2 arg3&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>比较函数只适用于基本类型（或重定义的基本类型，如”type Celsius float32”）。但是，整数和浮点数不能互相比较。</p>
<h3 id="自定义函数"><a class="markdownIt-Anchor" href="#自定义函数"></a> 自定义函数</h3>
<p>Go的模板支持自定义函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    htmlByte, err := ioutil.ReadFile(<span class="string">"./hello.html"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"read html failed, err:"</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 自定义一个夸人的模板函数</span></span><br><span class="line">    kua := <span class="function"><span class="keyword">func</span><span class="params">(arg <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> arg + <span class="string">"真帅"</span>, <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 采用链式操作在Parse之前调用Funcs添加自定义的kua函数</span></span><br><span class="line">    tmpl, err := template.New(<span class="string">"hello"</span>).Funcs(template.FuncMap&#123;<span class="string">"kua"</span>: kua&#125;).Parse(<span class="keyword">string</span>(htmlByte))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"create template failed, err:"</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    user := UserInfo&#123;</span><br><span class="line">        Name:   <span class="string">"张三"</span>,</span><br><span class="line">        Gender: <span class="string">"男"</span>,</span><br><span class="line">        Age:    <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用user渲染模板，并将结果写入w</span></span><br><span class="line">    tmpl.Execute(w, user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以在模板文件hello.html中使用我们自定义的kua函数了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;kua .Name&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="嵌套template"><a class="markdownIt-Anchor" href="#嵌套template"></a> 嵌套template</h3>
<p>我们可以在template中嵌套其他的template。这个template可以是单独的文件，也可以是通过define定义的template。</p>
<p>举个例子： t.html文件内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>tmpl test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>测试嵌套template语法<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;&#123;template "ul.html"&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;&#123;template "ol.html"&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;&#123; define "ol.html"&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是ol.html<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>吃饱<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>喝足<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>唱跳Rap<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>ul.html文件内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>注释<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>日志<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Http Server端如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"html/template"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">   Name   <span class="keyword">string</span></span><br><span class="line">   Gender <span class="keyword">string</span></span><br><span class="line">   Age    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">"/tmpl"</span>, tmplDemo)</span><br><span class="line">   err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tmplDemo</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   <span class="comment">// 解析指定文件生成模板对象</span></span><br><span class="line">   tmpl, err := template.ParseFiles(<span class="string">"./template/t.html"</span>, <span class="string">"./template/ul.html"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(<span class="string">"create template failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   user := UserInfo&#123;</span><br><span class="line">      Name:   <span class="string">"张三"</span>,</span><br><span class="line">      Gender: <span class="string">"男"</span>,</span><br><span class="line">      Age:    <span class="number">18</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   tmpl.Execute(w, user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问http://localhost:8080/tmpl：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220705110654.png" alt="" /></p>
<h1 id="http"><a class="markdownIt-Anchor" href="#http"></a> Http</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/http.html" target="_blank" rel="noopener">Http</a></p>
<p><a href="https://www.qingbo1011.top/2022/04/25/Golang%E8%BF%9B%E9%98%B601%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">Golang进阶——网络编程 笔记</a></p>
<p>Go语言内置的<code>net/http</code>包十分的优秀，提供了HTTP<strong>客户端</strong>和<strong>服务端</strong>的实现。</p>
<blockquote>
<p>HTTP协议：超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络传输协议，所有的WWW文件都必须遵守这个标准。设计HTTP最初的目的是为了提供一种发布和接收HTML页面的方法。</p>
</blockquote>
<h2 id="http客户端"><a class="markdownIt-Anchor" href="#http客户端"></a> HTTP客户端</h2>
<p>基本的HTTP/HTTPS请求由 <code>Get</code>、<code>Head</code>、<code>Post</code>和<code>PostForm</code>函数发出HTTP/HTTPS请求。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">resp, err := http.Get(<span class="string">"http://qingbo1011.top/"</span>)</span><br><span class="line">...</span><br><span class="line">resp, err := http.Post(<span class="string">"http://qingbo1011.top/upload"</span>, <span class="string">"image/jpeg"</span>, &amp;buf)</span><br><span class="line">...</span><br><span class="line">resp, err := http.PostForm(<span class="string">"http://5lmh.com/form"</span>,</span><br><span class="line">    url.Values&#123;<span class="string">"key"</span>: &#123;<span class="string">"Value"</span>&#125;, <span class="string">"id"</span>: &#123;<span class="string">"123"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>程序在使用完response后必须<code>Close()</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">resp, err := http.Get(<span class="string">"http://5lmh.com/"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// handle error</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h3 id="get请求示例"><a class="markdownIt-Anchor" href="#get请求示例"></a> GET请求示例</h3>
<p>使用<code>net/http</code>包编写一个简单的发送HTTP请求的Client端，代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	resp, err := http.Get(<span class="string">"https://www.baidu.com/"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行上面的代码，就可以在终端输出https://www.baidu.com/网站首页的内容了，我们的浏览器其实就是一个发送和接收HTTP协议数据的客户端，我们平时通过浏览器访问网页其实就是从网站的服务器接收HTTP数据，然后浏览器会按照HTML、CSS等规则将网页渲染展示出来。</p>
<h3 id="带参数的get请求示例"><a class="markdownIt-Anchor" href="#带参数的get请求示例"></a> 带参数的GET请求示例</h3>
<p>关于GET请求的参数需要使用Go语言内置的<code>net/url</code>这个标准库来处理。</p>
<p>Client端代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io/ioutil"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">   <span class="string">"net/url"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   apiUrl := <span class="string">"http://127.0.0.1:8080/get"</span></span><br><span class="line">   <span class="comment">// URL param</span></span><br><span class="line">   values := url.Values&#123;&#125;</span><br><span class="line">   values.Set(<span class="string">"name"</span>,<span class="string">"张三"</span>)</span><br><span class="line">   values.Set(<span class="string">"age"</span>,<span class="string">"18"</span>)</span><br><span class="line">   uri, err := url.ParseRequestURI(apiUrl)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(err)</span><br><span class="line">   &#125;</span><br><span class="line">   uri.RawQuery = values.Encode() <span class="comment">// URL encode</span></span><br><span class="line">   log.Println(uri.String())</span><br><span class="line">   resp, err := http.Get(uri.String())</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">   bytes, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="keyword">string</span>(bytes))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Server端代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">"/get"</span>, getHandler)               <span class="comment">// 单独写回调函数</span></span><br><span class="line">   err := http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>) <span class="comment">// 参数说明：addr：监听的地址 handler：回调函数</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">   query := r.URL.Query()</span><br><span class="line">   fmt.Println(query.Get(<span class="string">"name"</span>))</span><br><span class="line">   fmt.Println(query.Get(<span class="string">"age"</span>))</span><br><span class="line">   response := <span class="string">`&#123;"status": "ok"&#125;`</span></span><br><span class="line">   w.Write([]<span class="keyword">byte</span>(response))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220706000252.png" alt="" /></p>
<p>先运行Server端，再运行Client端，结果如下：</p>
<center class="half">
    <img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220706000522.png" width="350"/>
    <img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220706000551.png" width="350" />
</center>
<h3 id="post请求示例"><a class="markdownIt-Anchor" href="#post请求示例"></a> Post请求示例</h3>
<p>Client端代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io/ioutil"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">   <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   url := <span class="string">"http://127.0.0.1:8080/post"</span></span><br><span class="line">   <span class="comment">// 表单数据</span></span><br><span class="line">   <span class="comment">//contentType := "application/x-www-form-urlencoded"</span></span><br><span class="line">   <span class="comment">//data := "name=枯藤&amp;age=18"</span></span><br><span class="line">   <span class="comment">// json</span></span><br><span class="line">   contentType := <span class="string">"application/json"</span></span><br><span class="line">   data := <span class="string">`&#123;"name":"张三","age":18&#125;`</span></span><br><span class="line">   resp, err := http.Post(url, contentType, strings.NewReader(data))</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(<span class="string">"post failed, err:%v\n"</span>, err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">   b, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(<span class="string">"get resp failed,err:%v\n"</span>, err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="keyword">string</span>(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Server端代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io/ioutil"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">"/post"</span>, postHandler)             <span class="comment">// 单独写回调函数</span></span><br><span class="line">   err := http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>) <span class="comment">// 参数说明：addr：监听的地址 handler：回调函数</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">postHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">   <span class="comment">// 1. 请求类型是application/x-www-form-urlencoded时解析form数据</span></span><br><span class="line">   r.ParseForm()</span><br><span class="line">   fmt.Println(r.PostForm) <span class="comment">// 打印form数据</span></span><br><span class="line">   fmt.Println(r.PostForm.Get(<span class="string">"name"</span>), r.PostForm.Get(<span class="string">"age"</span>))</span><br><span class="line">   <span class="comment">// 2. 请求类型是application/json时从r.Body读取数据</span></span><br><span class="line">   b, err := ioutil.ReadAll(r.Body)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Println(<span class="string">"read request.Body failed, err:%v\n"</span>, err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="keyword">string</span>(b))</span><br><span class="line">   answer := <span class="string">`&#123;"status": "ok"&#125;`</span></span><br><span class="line">   w.Write([]<span class="keyword">byte</span>(answer))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先运行Server端，再运行Client端，结果如下：</p>
<center class="half">
    <img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220706003925.png" width="350"/>
    <img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220706003938.png" width="350" />
</center>
<h3 id="自定义client"><a class="markdownIt-Anchor" href="#自定义client"></a> 自定义Client</h3>
<p>要管理HTTP客户端的头域、重定向策略和其他设置，创建一个Client：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">client := &amp;http.Client&#123;</span><br><span class="line">    CheckRedirect: redirectPolicyFunc,</span><br><span class="line">&#125;</span><br><span class="line">resp, err := client.Get(<span class="string">"http://5lmh.com"</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">req, err := http.NewRequest(<span class="string">"GET"</span>, <span class="string">"http://5lmh.com"</span>, <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">req.Header.Add(<span class="string">"If-None-Match"</span>, <span class="string">`W/"wyzzy"`</span>)</span><br><span class="line">resp, err := client.Do(req)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h3 id="自定义transport"><a class="markdownIt-Anchor" href="#自定义transport"></a> 自定义Transport</h3>
<p>要管理代理、TLS配置、keep-alive、压缩和其他设置，创建一个Transport：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tr := &amp;http.Transport&#123;</span><br><span class="line">    TLSClientConfig:    &amp;tls.Config&#123;RootCAs: pool&#125;,</span><br><span class="line">    DisableCompression: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line">client := &amp;http.Client&#123;Transport: tr&#125;</span><br><span class="line">resp, err := client.Get(<span class="string">"https://5lmh.com"</span>)</span><br></pre></td></tr></table></figure>
<p>Client和Transport类型都可以安全的被多个go程同时使用。出于效率考虑，应该一次建立、尽量重用。</p>
<h2 id="http服务端"><a class="markdownIt-Anchor" href="#http服务端"></a> HTTP服务端</h2>
<h3 id="默认的server"><a class="markdownIt-Anchor" href="#默认的server"></a> 默认的Server</h3>
<p><code>ListenAndServe</code>使用指定的监听地址和处理器<strong>启动一个HTTP服务端</strong>。处理器参数通常是<code>nil</code>，这表示采用包变量DefaultServeMux作为处理器。</p>
<p>Handle和HandleFunc函数可以向DefaultServeMux添加处理器。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http.Handle(<span class="string">"/foo"</span>, fooHandler)</span><br><span class="line">http.HandleFunc(<span class="string">"/bar"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    fmt.Fprintf(w, <span class="string">"Hello, %q"</span>, html.EscapeString(r.URL.Path))</span><br><span class="line">&#125;)</span><br><span class="line">log.Fatal(http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>))</span><br></pre></td></tr></table></figure>
<h3 id="默认的server示例"><a class="markdownIt-Anchor" href="#默认的server示例"></a> 默认的Server示例</h3>
<p>使用Go语言中的<code>net/http</code>包来编写一个简单的接收HTTP请求的Server端示例，<code>net/http</code>包是对<code>net</code>包的进一步封装，专门用来处理HTTP协议的数据。具体的代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, sayHello)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"http server failed, err:%v\n"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	fmt.Fprintln(w, <span class="string">"Hello World！"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行后访问http://127.0.0.1:8080/，结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220706004711.png" alt="" /></p>
<h3 id="自定义server"><a class="markdownIt-Anchor" href="#自定义server"></a> 自定义Server</h3>
<p>要管理服务端的行为，可以创建一个自定义的Server：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s := &amp;http.Server&#123;</span><br><span class="line">    Addr:           <span class="string">":8080"</span>,</span><br><span class="line">    Handler:        myHandler,</span><br><span class="line">    ReadTimeout:    <span class="number">10</span> * time.Second,</span><br><span class="line">    WriteTimeout:   <span class="number">10</span> * time.Second,</span><br><span class="line">    MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</span><br><span class="line">&#125;</span><br><span class="line">log.Fatal(s.ListenAndServe())</span><br></pre></td></tr></table></figure>
<h1 id="context"><a class="markdownIt-Anchor" href="#context"></a> Context</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/Context.html" target="_blank" rel="noopener">Context</a></p>
<p>在<code>http</code>包的Server中，每一个请求在都有一个对应的goroutine去处理。请求处理函数通常会启动额外的 goroutine用来访问后端服务，比如数据库和RPC服务。用来处理一个请求的goroutine通常需要访问一些与请求特定的数据，比如终端用户的身份认证信息、验证相关的token、请求的截止时间。 当一个请求被取消或超时时，所有用来处理该请求的goroutine都应该迅速退出，然后系统才能释放这些goroutine占用的资源。</p>
<h2 id="为什么需要context"><a class="markdownIt-Anchor" href="#为什么需要context"></a> 为什么需要Context</h2>
<h3 id="基本示例"><a class="markdownIt-Anchor" href="#基本示例"></a> 基本示例</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> hello()</span><br><span class="line">	wg.Wait() <span class="comment">// 如何优雅的实现结束子goroutine?</span></span><br><span class="line">	fmt.Println(<span class="string">"over"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done() <span class="comment">// 如何接收外部命令实现退出?</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"hello!"</span>)</span><br><span class="line">		time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个代码运行一下当然是会一直执行，停止不了的。那么如何优雅的实现结束子goroutine呢？</p>
<h3 id="全局变量方式"><a class="markdownIt-Anchor" href="#全局变量方式"></a> 全局变量方式</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> exit <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   wg.Add(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">go</span> hello()</span><br><span class="line">   time.Sleep(time.Second * <span class="number">3</span>) <span class="comment">// sleep3秒以免程序过快退出</span></span><br><span class="line">   exit = <span class="literal">true</span>                 <span class="comment">// 修改全局变量实现子goroutine的退出</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">   fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> wg.Done() <span class="comment">// 如何接收外部命令实现退出?</span></span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"hello!"</span>)</span><br><span class="line">      time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span> exit &#123;</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现效果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220707094043.png" alt="" /></p>
<p>全局变量方式存在的问题：</p>
<ul>
<li>使用全局变量在跨包调用时不容易统一</li>
<li>如果<code>hello()</code>中再启动goroutine，就不太好控制了</li>
</ul>
<h3 id="通道方式"><a class="markdownIt-Anchor" href="#通道方式"></a> 通道方式</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   exitChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">   wg.Add(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">go</span> hello(exitChan)</span><br><span class="line">   time.Sleep(time.Second * <span class="number">3</span>) <span class="comment">// sleep3秒以免程序过快退出</span></span><br><span class="line">   exitChan &lt;- <span class="number">1</span>               <span class="comment">// 给子goroutine发送退出信号</span></span><br><span class="line">   <span class="built_in">close</span>(exitChan)</span><br><span class="line">   wg.Wait()</span><br><span class="line">   fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(exitChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">LOOP:</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"hello"</span>)</span><br><span class="line">      time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-exitChan:</span><br><span class="line">         <span class="keyword">break</span> LOOP</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   wg.Done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>管道方式存在的问题：</p>
<ul>
<li>使用全局变量在跨包调用时不容易实现规范和统一</li>
<li>需要维护一个共用的channel</li>
</ul>
<h3 id="官方版的方案context"><a class="markdownIt-Anchor" href="#官方版的方案context"></a> 官方版的方案：context</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">   wg.Add(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">go</span> hello(ctx)</span><br><span class="line">   time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">   cancel() <span class="comment">// 通知子goroutine结束</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">   fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">LOOP:</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"hello"</span>)</span><br><span class="line">      time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">// 等待上级通知</span></span><br><span class="line">         <span class="keyword">break</span> LOOP</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   wg.Done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当子goroutine又开启另外一个goroutine时，只需要将ctx传入即可：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">   wg.Add(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">go</span> hello(ctx)</span><br><span class="line">   time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">   cancel() <span class="comment">// 通知子goroutine结束</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">   fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">   <span class="keyword">go</span> hello2(ctx)</span><br><span class="line">LOOP:</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"hello"</span>)</span><br><span class="line">      time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">// 等待上级通知</span></span><br><span class="line">         <span class="keyword">break</span> LOOP</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello2</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">LOOP:</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"hello2"</span>)</span><br><span class="line">      time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">// 等待上级通知</span></span><br><span class="line">         <span class="keyword">break</span> LOOP</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   wg.Done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="context初识"><a class="markdownIt-Anchor" href="#context初识"></a> Context初识</h2>
<p>Go1.7加入了一个新的标准库<code>context</code>，它定义了Context类型，专门用来简化对于处理单个请求的多个 <code>goroutine</code>之间与请求域的数据、取消信号、截止时间等相关操作，这些操作可能涉及多个API调用。</p>
<p>对服务器传入的请求应该创建上下文，而对服务器的传出调用应该接受上下文。它们之间的函数调用链必须传递上下文，或者可以使用<code>WithCancel</code>、<code>WithDeadline</code>、<code>WithTimeout</code>或<code>WithValue</code>创建的派生上下文。当一个上下文被取消时，它派生的所有上下文也被取消。</p>
<h3 id="context接口"><a class="markdownIt-Anchor" href="#context接口"></a> Context接口</h3>
<p><code>context.Context</code>是一个接口，该接口定义了四个需要实现的方法。具体签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">    Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line">    Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    Err() error</span><br><span class="line">    Value(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Deadline()</code>：需要返回当前Context被取消的时间，也就是完成工作的截止时间（deadline）；</li>
<li><code>Done()</code>：需要返回一个channel，这个channel会在当前工作完成或者上下文被取消之后关闭，多次调用<code>Done()</code>方法会返回同一个channel；</li>
<li><code>Err()</code>：会返回当前Context结束的原因，它只会在<code>Done()</code>返回的channel被关闭时才会返回非空的值；
<ul>
<li>如果当前Context被取消就会返回<code>Canceled</code>错误；</li>
<li>如果当前Context超时就会返回<code>DeadlineExceeded</code>错误；</li>
</ul>
</li>
<li><code>Value()</code>：会从Context中返回键对应的值，对于同一个上下文来说，多次调用<code>Value()</code>并传入相同的Key会返回相同的结果，该方法仅用于传递跨API和进程间跟请求域的数据。</li>
</ul>
<h3 id="background和todo"><a class="markdownIt-Anchor" href="#background和todo"></a> Background()和TODO()</h3>
<p>Go内置两个函数：<code>Background()</code>和<code>TODO()</code>，这两个函数分别返回一个实现了Context接口的background和todo。我们代码中最开始都是以这两个内置的上下文对象作为最顶层的partent context，衍生出更多的子上下文对象。</p>
<ul>
<li>
<p><code>Background()</code>：主要用于main函数、初始化以及测试代码中，作为Context这个树结构的最顶层的Context，也就是根Context。</p>
</li>
<li>
<p><code>TODO()</code>：目前还不知道具体的使用场景，如果我们不知道该使用什么Context的时候，可以使用这个。</p>
<p>background和todo本质上都是emptyCtx结构体类型，是一个不可取消，没有设置截止时间，没有携带任何值的Context。</p>
</li>
</ul>
<h2 id="with系列函数"><a class="markdownIt-Anchor" href="#with系列函数"></a> With系列函数</h2>
<p>context包中定义了四个With系列函数：<code>WithCancel</code>、<code>WithDeadline</code>、<code>WithTimeout</code>和<code>WithValue</code>。</p>
<h3 id="withcancel"><a class="markdownIt-Anchor" href="#withcancel"></a> WithCancel</h3>
<p><code>WithCancel()</code>的函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span></span><br></pre></td></tr></table></figure>
<p><code>WithCancel()</code>返回带有新Done通道的父节点的副本。当调用返回的cancel函数或当关闭父上下文的Done通道时，将关闭返回上下文的Done通道，无论先发生什么情况。取消此上下文将释放与其关联的资源，因此代码应该在此上下文中运行的操作完成后立即调用cancel。</p>
<p>举个例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">   <span class="keyword">defer</span> cancel()</span><br><span class="line">   <span class="keyword">for</span> n := <span class="keyword">range</span> gen(ctx) &#123;</span><br><span class="line">      fmt.Println(n)</span><br><span class="line">      <span class="keyword">if</span> n == <span class="number">5</span> &#123;</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gen</span><span class="params">(ctx context.Context)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">   dst := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">   n := <span class="number">1</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">for</span> &#123;</span><br><span class="line">         <span class="keyword">select</span> &#123;</span><br><span class="line">         <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">            <span class="keyword">return</span> <span class="comment">// return结束该goroutine，防止泄露</span></span><br><span class="line">         <span class="keyword">case</span> dst &lt;- n:</span><br><span class="line">            n++</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="keyword">return</span> dst</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的示例代码中，gen函数在单独的goroutine中生成整数并将它们发送到返回的通道。 <strong>gen的调用者在使用生成的整数之后需要取消上下文</strong>，以免gen启动的内部goroutine发生泄漏。</p>
<h3 id="withdeadline"><a class="markdownIt-Anchor" href="#withdeadline"></a> WithDeadline</h3>
<p><code>WithDeadline()</code>的函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, deadline time.Time)</span> <span class="params">(Context, CancelFunc)</span></span></span><br></pre></td></tr></table></figure>
<p>返回父上下文的副本，并将deadline调整为不迟于d。如果父上下文的deadline已经早于d，则<code>WithDeadline(parent, d)</code>在语义上等同于父上下文。当截止日过期时，当调用返回的cancel函数时，或者当父上下文的Done通道关闭时，返回上下文的Done通道将被关闭，以最先发生的情况为准。</p>
<p>取消此上下文将释放与其关联的资源，因此代码应该在此上下文中运行的操作完成后立即调用cancel。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   d := time.Now().Add(time.Second * <span class="number">1</span>)</span><br><span class="line">   ctx, cancel := context.WithDeadline(context.Background(), d)</span><br><span class="line">   <span class="comment">// 尽管ctx会过期，但在任何情况下调用它的cancel函数都是很好的实践。</span></span><br><span class="line">   <span class="comment">// 如果不这样做，可能会使上下文及其父类存活的时间超过必要的时间。</span></span><br><span class="line">   <span class="keyword">defer</span> cancel()</span><br><span class="line">   <span class="keyword">select</span> &#123;</span><br><span class="line">   <span class="keyword">case</span> &lt;-time.After(time.Second * <span class="number">1</span>):</span><br><span class="line">      fmt.Println(<span class="string">"overslept"</span>)</span><br><span class="line">   <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">      fmt.Println(ctx.Err())</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码中，定义了一个50毫秒之后过期的deadline，然后我们调用<code>context.WithDeadline(context.Background(), d)</code>得到一个上下文<code>ctx</code>和一个取消函数<code>cancel</code>，然后使用一个select让主程序陷入等待：等待1秒后打印overslept退出或者等待ctx过期后退出。 因为ctx 50毫秒后就过期，所以<code>ctx.Done()</code>会先接收到值，上面的代码会打印<code>ctx.Err()</code>取消原因。</p>
<h3 id="withtimeout"><a class="markdownIt-Anchor" href="#withtimeout"></a> WithTimeout</h3>
<p><code>WithTimeout()</code>的函数签名如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span></span><br></pre></td></tr></table></figure>
<p><code>WithTimeout()</code>返回<code>WithDeadline(parent, time.Now().Add(timeout))</code>。</p>
<p>取消此上下文将释放与其相关的资源，因此代码应该在此上下文中运行的操作完成后立即调用cancel，<strong>通常用于数据库或者网络连接的超时控制</strong>。</p>
<p>具体示例如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*<span class="number">50</span>) <span class="comment">// 设置一个50毫秒的超时</span></span><br><span class="line">   wg.Add(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">go</span> connect(ctx)</span><br><span class="line">   time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">   cancel() <span class="comment">// 通知子goroutine结束</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">   fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connect</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> wg.Done()</span><br><span class="line">LOOP:</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"db connecting ..."</span>)</span><br><span class="line">      time.Sleep(time.Millisecond * <span class="number">10</span>) <span class="comment">// // 假设正常连接数据库耗时10毫秒</span></span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">         <span class="keyword">break</span> LOOP</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"connect done!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="withvalue"><a class="markdownIt-Anchor" href="#withvalue"></a> WithValue</h3>
<p><code>WithValue()</code>函数能够将请求作用域的数据与 Context 对象建立关系。声明如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span></span><br></pre></td></tr></table></figure>
<p><code>WithValue()</code>返回父节点的副本，其中与key关联的值为val。</p>
<p>仅对API和进程间传递请求域的数据使用上下文值，而不是使用它来传递可选参数给函数。</p>
<p>所提供的键必须是可比较的，并且不应该是string类型或任何其他内置类型，以避免使用上下文在包之间发生冲突。WithValue的用户应该为键定义自己的类型。为了避免在分配给interface{}时进行分配，上下文键通常具有具体类型<code>struct{}</code>。或者，导出的上下文关键变量的静态类型应该是指针或接口。</p>
<p>示例如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TraceCode <span class="keyword">string</span> <span class="comment">// 设置类型别名</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*<span class="number">50</span>) <span class="comment">// 设置一个50毫秒的超时</span></span><br><span class="line">   ctx = context.WithValue(ctx, TraceCode(<span class="string">"TRACE_CODE"</span>), <span class="string">"12512312234"</span>)          <span class="comment">// 在系统的入口中设置trace code传递给后续启动的goroutine实现日志数据聚合</span></span><br><span class="line">   wg.Add(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">go</span> connect(ctx)</span><br><span class="line">   time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">   cancel() <span class="comment">// 通知子goroutine结束</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">   fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connect</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> wg.Done()</span><br><span class="line">   key := TraceCode(<span class="string">"TRACE_CODE"</span>)</span><br><span class="line">   traceCode, ok := ctx.Value(key).(<span class="keyword">string</span>)</span><br><span class="line">   <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      fmt.Println(<span class="string">"invalid trace code"</span>)</span><br><span class="line">   &#125;</span><br><span class="line">LOOP:</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"worker, trace code:%s\n"</span>, traceCode)</span><br><span class="line">      time.Sleep(time.Millisecond * <span class="number">10</span>) <span class="comment">// 假设正常连接数据库耗时10毫秒</span></span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">         <span class="keyword">break</span> LOOP</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"connect done!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用context的注意事项"><a class="markdownIt-Anchor" href="#使用context的注意事项"></a> 使用Context的注意事项</h2>
<ul>
<li>推荐<strong>以参数的方式显示传递Context</strong></li>
<li>以Context作为参数的函数方法，应该<strong>把Context作为第一个参数。</strong></li>
<li>给一个函数方法传递Context的时候，不要传递<code>nil</code>，<strong>如果不知道传递什么</strong>，就使用<code>context.TODO()</code></li>
<li>Context的Value相关方法应该传递请求域的<strong>必要数据</strong>，不应该用于传递可选参数</li>
<li><strong>Context是线程安全的，可以放心的在多个goroutine中传递</strong></li>
</ul>
<h2 id="客户端超时取消示例"><a class="markdownIt-Anchor" href="#客户端超时取消示例"></a> 客户端超时取消示例</h2>
<p>调用服务端API时如何在客户端实现超时控制？</p>
<h3 id="server端"><a class="markdownIt-Anchor" href="#server端"></a> Server端</h3>
<p>server端，随机出现慢响应。</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"math/rand"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">"/"</span>, indexHandler)</span><br><span class="line">   err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   number := rand.Intn(<span class="number">2</span>) <span class="comment">// 生成[0,2)的随机数</span></span><br><span class="line">   <span class="keyword">if</span> number == <span class="number">0</span> &#123;</span><br><span class="line">      time.Sleep(time.Second * <span class="number">3</span>) <span class="comment">// 耗时3秒的慢响应</span></span><br><span class="line">      fmt.Println(w, <span class="string">"slow response"</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(w, <span class="string">"quick response"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="client端"><a class="markdownIt-Anchor" href="#client端"></a> Client端</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"context"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io/ioutil"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> respData <span class="keyword">struct</span> &#123;</span><br><span class="line">   resp *http.Response</span><br><span class="line">   err  error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*<span class="number">100</span>) <span class="comment">// 定义一个100毫秒的超时</span></span><br><span class="line">   <span class="keyword">defer</span> cancel()</span><br><span class="line">   doCall(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doCall</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">   transport := http.Transport&#123;</span><br><span class="line">      <span class="comment">// 请求频繁可定义全局的client对象并启用长链接</span></span><br><span class="line">      <span class="comment">// 请求不频繁使用短链接</span></span><br><span class="line">      DisableCompression: <span class="literal">true</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   client := http.Client&#123;</span><br><span class="line">      Transport: &amp;transport,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   respChan := <span class="built_in">make</span>(<span class="keyword">chan</span> *respData, <span class="number">1</span>)</span><br><span class="line">   req, err := http.NewRequest(<span class="string">"GET"</span>, <span class="string">"http://127.0.0.1:8080/"</span>, <span class="literal">nil</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">   wg.Add(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">defer</span> wg.Wait()</span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wg.Done()</span><br><span class="line">      resp, err2 := client.Do(req)</span><br><span class="line">      fmt.Printf(<span class="string">"client.do resp:%v, err:%v\n"</span>, resp, err)</span><br><span class="line">      rd := &amp;respData&#123;</span><br><span class="line">         resp: resp,</span><br><span class="line">         err:  err2,</span><br><span class="line">      &#125;</span><br><span class="line">      respChan &lt;- rd</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="keyword">select</span> &#123;</span><br><span class="line">   <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">      <span class="comment">//transport.CancelRequest(req)</span></span><br><span class="line">      fmt.Println(<span class="string">"call api timeout"</span>)</span><br><span class="line">   <span class="keyword">case</span> result := &lt;-respChan:</span><br><span class="line">      fmt.Println(<span class="string">"call server api success"</span>)</span><br><span class="line">      <span class="keyword">if</span> result.err != <span class="literal">nil</span> &#123;</span><br><span class="line">         log.Fatalln(<span class="string">"call server api failed, err: "</span>, result.err)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">defer</span> result.resp.Body.Close()</span><br><span class="line">      data, err := ioutil.ReadAll(result.resp.Body)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         log.Fatalln(err)</span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Println(<span class="string">"resp: "</span>, <span class="keyword">string</span>(data))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="数据格式"><a class="markdownIt-Anchor" href="#数据格式"></a> 数据格式</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F.html" target="_blank" rel="noopener">数据格式</a></p>
<p>数据格式是系统中数据交互不可缺少的内容。这里主要介绍<code>JSON</code>、<code>XML</code>、<code>MSGPack</code>。</p>
<h2 id="json"><a class="markdownIt-Anchor" href="#json"></a> JSON</h2>
<p>关于json的序列化和反序列化已经用过很多次了。（<a href="https://www.qingbo1011.top/2022/04/23/Golang%E5%9F%BA%E7%A1%8001/#%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%8Ejson%E5%BA%8F%E5%88%97%E5%8C%96">结构体与JSON序列化 笔记</a>）</p>
<p>json是完全独立于语言的文本格式，是k-v的形式。应用场景：前后端交互，系统间数据交互。</p>
<p>json使用go语言内置的<code>encoding/json</code>标准库。</p>
<ul>
<li>编码json使用<code>json.Marshal()</code>函数可以对一组数据进行JSON格式的编码</li>
<li>解码json使用<code>json.Unmarshal()</code>函数可以对一组数据进行JSON格式的解码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Marshal</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unmarshal</span><span class="params">(data []<span class="keyword">byte</span>, v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span></span><br></pre></td></tr></table></figure>
<h3 id="结构体生成json"><a class="markdownIt-Anchor" href="#结构体生成json"></a> 结构体生成json</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"encoding/json"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意私有变量不能被json包访问！！所以这里的成员全部要大写开头</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">   Id     <span class="keyword">int</span></span><br><span class="line">   Name   <span class="keyword">string</span></span><br><span class="line">   Gender <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   stu := student&#123;</span><br><span class="line">      Id:     <span class="number">1001</span>,</span><br><span class="line">      Name:   <span class="string">"张三"</span>,</span><br><span class="line">      Gender: <span class="string">"男"</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 序列化</span></span><br><span class="line">   bytes, err := json.Marshal(stu)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="keyword">string</span>(bytes))</span><br><span class="line">   <span class="comment">// 格式化输出json</span></span><br><span class="line">   jsonBytes, err := json.MarshalIndent(stu, <span class="string">""</span>, <span class="string">" "</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="keyword">string</span>(jsonBytes))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220708125257.png" alt="" /></p>
<blockquote>
<p>struct tag：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">//"-"是忽略的意思</span></span><br><span class="line">    Name  <span class="keyword">string</span> <span class="string">`json:"-"`</span></span><br><span class="line">    Hobby <span class="keyword">string</span> <span class="string">`json:"hobby" `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="json解析到结构体"><a class="markdownIt-Anchor" href="#json解析到结构体"></a> json解析到结构体</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"encoding/json"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">   Age       <span class="keyword">int</span>    <span class="string">`json:"age,string"`</span></span><br><span class="line">   Name      <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">   Niubility <span class="keyword">bool</span>   <span class="string">`json:"niubility"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   b := []<span class="keyword">byte</span>(<span class="string">`&#123;"age":"18","name":"张三","marry":false&#125;`</span>) <span class="comment">// json数据</span></span><br><span class="line">   <span class="keyword">var</span> p person</span><br><span class="line">   err := json.Unmarshal(b, &amp;p)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(p) <span class="comment">// &#123;18 张三 false&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="map生成json"><a class="markdownIt-Anchor" href="#map生成json"></a> map生成json</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	student := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]any)</span><br><span class="line">	student[<span class="string">"name"</span>] = <span class="string">"qingbo1011.top"</span></span><br><span class="line">	student[<span class="string">"age"</span>] = <span class="number">18</span></span><br><span class="line">	student[<span class="string">"sex"</span>] = <span class="string">"男"</span></span><br><span class="line">	bytes, err := json.Marshal(student)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(bytes)) <span class="comment">// &#123;"age":18,"name":"qingbo1011.top","sex":"男"&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>升级到<code>go1.18</code>，使用了<code>any</code>。（<code>any</code>等价于空接口<code>interface{}</code>，go1.18中源码的所有空接口都被替换成了<code>any</code>）</p>
</blockquote>
<h3 id="json解析到anymap"><a class="markdownIt-Anchor" href="#json解析到anymap"></a> json解析到any（map）</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"encoding/json"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// json数据</span></span><br><span class="line">   b := []<span class="keyword">byte</span>(<span class="string">`&#123;"age":20,"name":"李四","marry":true&#125;`</span>) <span class="comment">// int和float64都当float64</span></span><br><span class="line">   <span class="keyword">var</span> obj any</span><br><span class="line">   err := json.Unmarshal(b, &amp;obj) <span class="comment">// 自动转到map</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(obj) <span class="comment">// map[age:20 marry:false name:李四]</span></span><br><span class="line">   <span class="comment">// 可以判断类型</span></span><br><span class="line">   m, ok := obj.(<span class="keyword">map</span>[<span class="keyword">string</span>]any)</span><br><span class="line">   <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      log.Println(<span class="string">"断言失败！无法断言为map[string]any类型"</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">      <span class="keyword">switch</span> t := v.(<span class="keyword">type</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">float64</span>:</span><br><span class="line">         fmt.Printf(<span class="string">"m[%v]是float64类型\n"</span>, k)</span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">         fmt.Printf(<span class="string">"m[%v]是string类型\n"</span>, k)</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">         fmt.Printf(<span class="string">"m[%v]是%v类型\n"</span>, k, t)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220708150036.png" alt="" /></p>
<h2 id="xml"><a class="markdownIt-Anchor" href="#xml"></a> XML</h2>
<p>XML是可扩展标记语言，包含声明、根标签、子元素和属性。应用场景：配置文件以及webService。</p>
<blockquote>
<p>示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servers</span> <span class="attr">version</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">serverName</span>&gt;</span>Shanghai_VPN<span class="tag">&lt;/<span class="name">serverName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">serverIP</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">serverIP</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">serverName</span>&gt;</span>Beijing_VPN<span class="tag">&lt;/<span class="name">serverName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">serverIP</span>&gt;</span>127.0.0.2<span class="tag">&lt;/<span class="name">serverIP</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><a href="https://www.qingbo1011.top/2021/03/28/XML/">XML 笔记</a></p>
<p>直接看代码吧：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"encoding/xml"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</span><br><span class="line">   ServerName <span class="keyword">string</span> <span class="string">`xml:"serverName"`</span></span><br><span class="line">   ServerIP   <span class="keyword">string</span> <span class="string">`xml:"serverIP"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Servers <span class="keyword">struct</span> &#123;</span><br><span class="line">   Name    xml.Name <span class="string">`xml:"servers"`</span></span><br><span class="line">   Version <span class="keyword">string</span>   <span class="string">`xml:"version"`</span></span><br><span class="line">   Servers []Server <span class="string">`xml:"server"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// xml转struct</span></span><br><span class="line">   xmlStr := <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="string">    &lt;servers version="1"&gt;</span></span><br><span class="line"><span class="string">        &lt;server&gt;</span></span><br><span class="line"><span class="string">            &lt;serverName&gt;Shanghai_VPN&lt;/serverName&gt;</span></span><br><span class="line"><span class="string">            &lt;serverIP&gt;127.0.0.1&lt;/serverIP&gt;</span></span><br><span class="line"><span class="string">        &lt;/server&gt;</span></span><br><span class="line"><span class="string">        &lt;server&gt;</span></span><br><span class="line"><span class="string">            &lt;serverName&gt;Beijing_VPN&lt;/serverName&gt;</span></span><br><span class="line"><span class="string">            &lt;serverIP&gt;127.0.0.2&lt;/serverIP&gt;</span></span><br><span class="line"><span class="string">        &lt;/server&gt;</span></span><br><span class="line"><span class="string">    &lt;/servers&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">   <span class="keyword">var</span> servers Servers</span><br><span class="line">   err := xml.Unmarshal([]<span class="keyword">byte</span>(xmlStr), &amp;servers)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatalln(err)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(servers) <span class="comment">// &#123;&#123; &#125;  [&#123;Shanghai_VPN 127.0.0.1&#125; &#123;Beijing_VPN 127.0.0.2&#125;]&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="msgpack"><a class="markdownIt-Anchor" href="#msgpack"></a> MSGPack</h2>
<p>MSGPack是<strong>二进制的json</strong>，性能更快，更省空间。</p>
<blockquote>
<p><strong>It’s like JSON. but fast and small.</strong></p>
<p>MessagePack is an efficient binary serialization format. It lets you exchange data among multiple languages like JSON. But it’s faster and smaller. Small integers are encoded into a single byte, and typical short strings require only one extra byte in addition to the strings themselves.</p>
</blockquote>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"github.com/vmihailenco/msgpack"</span></span><br><span class="line">   <span class="string">"io/ioutil"</span></span><br><span class="line">   <span class="string">"math/rand"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">   Name <span class="keyword">string</span></span><br><span class="line">   Age  <span class="keyword">int</span></span><br><span class="line">   Sex  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二进制写出</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writerJson</span><span class="params">(filename <span class="keyword">string</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> persons []*Person</span><br><span class="line">   <span class="comment">// 假数据</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      p := &amp;Person&#123;</span><br><span class="line">         Name: fmt.Sprintf(<span class="string">"name%d"</span>, i),</span><br><span class="line">         Age:  rand.Intn(<span class="number">100</span>),</span><br><span class="line">         Sex:  <span class="string">"male"</span>,</span><br><span class="line">      &#125;</span><br><span class="line">      persons = <span class="built_in">append</span>(persons, p)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 二进制json序列化</span></span><br><span class="line">   data, err := msgpack.Marshal(persons)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   err = ioutil.WriteFile(filename, data, <span class="number">0666</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二进制读取</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readJson</span><span class="params">(filename <span class="keyword">string</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> persons []*Person</span><br><span class="line">   <span class="comment">// 读文件</span></span><br><span class="line">   data, err := ioutil.ReadFile(filename)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 反序列化</span></span><br><span class="line">   err = msgpack.Unmarshal(data, &amp;persons)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> _, v := <span class="keyword">range</span> persons &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"%#v\n"</span>, v)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//err := writerJson("D:/person.dat")</span></span><br><span class="line">   <span class="comment">//if err != nil &#123;</span></span><br><span class="line">   <span class="comment">// fmt.Println(err)</span></span><br><span class="line">   <span class="comment">// return</span></span><br><span class="line">   <span class="comment">//&#125;</span></span><br><span class="line">   err := readJson(<span class="string">"D:/person.dat"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="反射"><a class="markdownIt-Anchor" href="#反射"></a> 反射</h1>
<p><a href="https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/%E5%8F%8D%E5%B0%84.html" target="_blank" rel="noopener">反射</a></p>
<p><a href="https://draveness.me/golang/docs/part2-foundation/ch04-basic/golang-reflect/" target="_blank" rel="noopener">Go语言设计与实现之反射</a></p>
<p><strong>反射是指在程序运行期对程序本身进行访问和修改的能力</strong>。</p>
<h2 id="变量的内在机制"><a class="markdownIt-Anchor" href="#变量的内在机制"></a> 变量的内在机制</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>变量包含<strong>类型信息</strong>和<strong>值信息</strong>：</p>
<ul>
<li>类型信息：是静态的元信息，是预先定义好的</li>
<li>值信息：是程序运行过程中动态改变的</li>
</ul>
<h2 id="反射的使用"><a class="markdownIt-Anchor" href="#反射的使用"></a> 反射的使用</h2>
<p><code>reflect</code>包封装了反射相关的方法：</p>
<ul>
<li>获取类型信息：<code>reflect.TypeOf()</code>，是静态的</li>
<li>获取值信息：<code>reflect.ValueOf()</code>，是动态的</li>
</ul>
<h2 id="空接口与反射"><a class="markdownIt-Anchor" href="#空接口与反射"></a> 空接口与反射</h2>
<p>反射可以在运行时动态获取程序的各种详细信息。</p>
<h3 id="反射获取interface类型信息"><a class="markdownIt-Anchor" href="#反射获取interface类型信息"></a> 反射获取interface类型信息</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.14</span></span><br><span class="line">   test(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">   t := reflect.TypeOf(a)</span><br><span class="line">   fmt.Println(t) <span class="comment">// float64</span></span><br><span class="line">   <span class="comment">// kind()可以获取具体类型</span></span><br><span class="line">   k := t.Kind()</span><br><span class="line">   fmt.Println(k) <span class="comment">// float64</span></span><br><span class="line">   <span class="keyword">switch</span> k &#123;</span><br><span class="line">   <span class="keyword">case</span> reflect.Float64:</span><br><span class="line">      fmt.Println(<span class="string">"float64"</span>)</span><br><span class="line">   <span class="keyword">case</span> reflect.String:</span><br><span class="line">      fmt.Println(<span class="string">"string"</span>)</span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">"其他类型"</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* switch t2 := a.(type) &#123;</span></span><br><span class="line"><span class="comment">      case float64:</span></span><br><span class="line"><span class="comment">         fmt.Println(t2, "float64") // 3.14 float64</span></span><br><span class="line"><span class="comment">      case string:</span></span><br><span class="line"><span class="comment">         fmt.Println(t2, "string")</span></span><br><span class="line"><span class="comment">      default:</span></span><br><span class="line"><span class="comment">         fmt.Println(t2, "其他类型")</span></span><br><span class="line"><span class="comment">      &#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关于Kind，源码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Kind represents the specific kind of type that a Type represents.</span></span><br><span class="line"><span class="comment">// The zero Kind is not a valid kind.</span></span><br><span class="line"><span class="keyword">type</span> Kind <span class="keyword">uint</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Invalid Kind = <span class="literal">iota</span></span><br><span class="line">	Bool</span><br><span class="line">	Int</span><br><span class="line">	Int8</span><br><span class="line">	Int16</span><br><span class="line">	Int32</span><br><span class="line">	Int64</span><br><span class="line">	Uint</span><br><span class="line">	Uint8</span><br><span class="line">	Uint16</span><br><span class="line">	Uint32</span><br><span class="line">	Uint64</span><br><span class="line">	Uintptr</span><br><span class="line">	Float32</span><br><span class="line">	Float64</span><br><span class="line">	Complex64</span><br><span class="line">	Complex128</span><br><span class="line">	Array</span><br><span class="line">	Chan</span><br><span class="line">	Func</span><br><span class="line">	Interface</span><br><span class="line">	Map</span><br><span class="line">	Pointer</span><br><span class="line">	Slice</span><br><span class="line">	String</span><br><span class="line">	Struct</span><br><span class="line">	UnsafePointer</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="反射获取interface值信息"><a class="markdownIt-Anchor" href="#反射获取interface值信息"></a> 反射获取interface值信息</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.14</span></span><br><span class="line">   test(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">   v := reflect.ValueOf(a)</span><br><span class="line">   fmt.Println(v) <span class="comment">// 3.14</span></span><br><span class="line">   k := v.Kind()</span><br><span class="line">   fmt.Println(k) <span class="comment">// float64</span></span><br><span class="line">   <span class="keyword">switch</span> k &#123;</span><br><span class="line">   <span class="keyword">case</span> reflect.Float64:</span><br><span class="line">      fmt.Println(<span class="string">"a是："</span>, v.Float()) <span class="comment">// a是： 3.14</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="反射修改值信息"><a class="markdownIt-Anchor" href="#反射修改值信息"></a> 反射修改值信息</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.14</span></span><br><span class="line">   fmt.Println(x) <span class="comment">// 3.14</span></span><br><span class="line">   <span class="comment">// 反射认为下面是指针类型，不是float64类型</span></span><br><span class="line">   reflectSetValue(&amp;x)</span><br><span class="line">   fmt.Println(x) <span class="comment">// 8.8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectSetValue</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">   v := reflect.ValueOf(a)</span><br><span class="line">   k := v.Kind()</span><br><span class="line">   <span class="keyword">switch</span> k &#123;</span><br><span class="line">   <span class="keyword">case</span> reflect.Float64:</span><br><span class="line">      <span class="comment">// 反射修改值</span></span><br><span class="line">      v.SetFloat(<span class="number">6.18</span>)</span><br><span class="line">      fmt.Println(<span class="string">"a is Float64"</span>, v.Float())</span><br><span class="line">   <span class="keyword">case</span> reflect.Ptr:</span><br><span class="line">      v.Elem().SetFloat(<span class="number">8.8</span>)                     <span class="comment">// Elem()获取地址指向的值</span></span><br><span class="line">      fmt.Println(<span class="string">"a is Ptr:"</span>, v.Elem().Float()) <span class="comment">// a is Ptr: 8.8</span></span><br><span class="line">      <span class="comment">// 地址</span></span><br><span class="line">      fmt.Println(v.Pointer()) <span class="comment">// 824634417240</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结构体与反射"><a class="markdownIt-Anchor" href="#结构体与反射"></a> 结构体与反射</h2>
<h3 id="查看类型-字段和方法"><a class="markdownIt-Anchor" href="#查看类型-字段和方法"></a> 查看类型、字段和方法</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">   Id   <span class="keyword">int</span></span><br><span class="line">   Name <span class="keyword">string</span></span><br><span class="line">   Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u user)</span> <span class="title">Hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(u.Name, <span class="string">"say: hello!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   u := user&#123;</span><br><span class="line">      Id:   <span class="number">1</span>,</span><br><span class="line">      Name: <span class="string">"张三"</span>,</span><br><span class="line">      Age:  <span class="number">18</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   poni(u)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">poni</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">   t := reflect.TypeOf(a)</span><br><span class="line">   fmt.Println(<span class="string">"类型："</span>, t)                 <span class="comment">// 类型： main.user</span></span><br><span class="line">   fmt.Println(<span class="string">"以结构体字符串形式输出："</span>, t.Name()) <span class="comment">// 以结构体字符串形式输出： user</span></span><br><span class="line">   <span class="comment">// 获取值</span></span><br><span class="line">   v := reflect.ValueOf(a)</span><br><span class="line">   fmt.Println(v) <span class="comment">// &#123;1 张三 18&#125;</span></span><br><span class="line">   <span class="comment">// 获取所有属性</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123; <span class="comment">// t.NumField():获取结构体字段个数</span></span><br><span class="line">      <span class="comment">// 取每个字段</span></span><br><span class="line">      f := t.Field(i)</span><br><span class="line">      fmt.Printf(<span class="string">"%s : %v\n"</span>, f.Name, f.Type)</span><br><span class="line">      <span class="comment">// 获取字段的值信息</span></span><br><span class="line">      val := v.Field(i).Interface() <span class="comment">// Interface():获取字段对应的值</span></span><br><span class="line">      fmt.Println(<span class="string">"val :"</span>, val)</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(<span class="string">"======================================="</span>)</span><br><span class="line">   <span class="comment">// 获取方法</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumMethod(); i++ &#123;</span><br><span class="line">      m := t.Method(i)</span><br><span class="line">      fmt.Println(m.Name) <span class="comment">// Hello</span></span><br><span class="line">      fmt.Println(m.Type) <span class="comment">// func(main.user)</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220711120028.png" alt="" /></p>
<h3 id="查看匿名字段"><a class="markdownIt-Anchor" href="#查看匿名字段"></a> 查看匿名字段</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">   Id   <span class="keyword">int</span></span><br><span class="line">   Name <span class="keyword">string</span></span><br><span class="line">   Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Boy <span class="keyword">struct</span> &#123;</span><br><span class="line">   User</span><br><span class="line">   Addr <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   m := Boy&#123;</span><br><span class="line">      User: User&#123;<span class="number">1</span>, <span class="string">"张三"</span>, <span class="number">18</span>&#125;,</span><br><span class="line">      Addr: <span class="string">"北京"</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   t := reflect.TypeOf(m)</span><br><span class="line">   fmt.Println(t) <span class="comment">// main.Boy</span></span><br><span class="line">   <span class="comment">// Anonymous：匿名</span></span><br><span class="line">   fmt.Printf(<span class="string">"%#v\n"</span>, t.Field(<span class="number">0</span>)) <span class="comment">// reflect.StructField&#123;Name:"User", PkgPath:"", Type:(*reflect.rtype)(0x3bd400), Tag:"", Offset:0x0, Index:[]int&#123;0&#125;, Anonymous:true&#125;</span></span><br><span class="line">   <span class="comment">// 值信息</span></span><br><span class="line">   fmt.Printf(<span class="string">"%#v\n"</span>, reflect.ValueOf(m).Field(<span class="number">0</span>)) <span class="comment">// main.User&#123;Id:1, Name:"张三", Age:18&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="修改结构体的值"><a class="markdownIt-Anchor" href="#修改结构体的值"></a> 修改结构体的值</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">   Id   <span class="keyword">int</span></span><br><span class="line">   Name <span class="keyword">string</span></span><br><span class="line">   Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   u := User&#123;</span><br><span class="line">      Id:   <span class="number">0</span>,</span><br><span class="line">      Name: <span class="string">"张三"</span>,</span><br><span class="line">      Age:  <span class="number">18</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   fmt.Println(u) <span class="comment">// &#123;0 张三 18&#125;</span></span><br><span class="line">   SetValue(&amp;u)</span><br><span class="line">   fmt.Println(u) <span class="comment">// &#123;0 李四 18&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetValue</span><span class="params">(a any)</span></span> &#123;</span><br><span class="line">   v := reflect.ValueOf(a)</span><br><span class="line">   value := v.Elem()                  <span class="comment">// 获取指针指向的元素</span></span><br><span class="line">   field := value.FieldByName(<span class="string">"Name"</span>) <span class="comment">// 取字段</span></span><br><span class="line">   <span class="keyword">if</span> field.Kind() == reflect.String &#123;</span><br><span class="line">      field.SetString(<span class="string">"李四"</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用方法"><a class="markdownIt-Anchor" href="#调用方法"></a> 调用方法</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">   Id   <span class="keyword">int</span></span><br><span class="line">   Name <span class="keyword">string</span></span><br><span class="line">   Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u User)</span> <span class="title">Hello</span><span class="params">(name <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">   fmt.Println(u.Name, <span class="string">"say: Hello!"</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   u := User&#123;</span><br><span class="line">      Id:   <span class="number">1</span>,</span><br><span class="line">      Name: <span class="string">"张三"</span>,</span><br><span class="line">      Age:  <span class="number">18</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   v := reflect.ValueOf(u)</span><br><span class="line">   m := v.MethodByName(<span class="string">"Hello"</span>)                   <span class="comment">// 获取方法</span></span><br><span class="line">   args := []reflect.Value&#123;reflect.ValueOf(<span class="string">"李四"</span>)&#125; <span class="comment">// 构建一些参数</span></span><br><span class="line">   m.Call(args)                                   <span class="comment">// 调用方法，需要传入方法的参数</span></span><br><span class="line">   <span class="comment">// 没参数的情况下：</span></span><br><span class="line">   <span class="comment">//var args2 []reflect.Value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">张三 say: Hello! 李四</span><br></pre></td></tr></table></figure>
<h3 id="获取字段的tag"><a class="markdownIt-Anchor" href="#获取字段的tag"></a> 获取字段的tag</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">   Name <span class="keyword">string</span> <span class="string">`json:"name" db:"stu_name"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> s Student</span><br><span class="line">   v := reflect.ValueOf(&amp;s)</span><br><span class="line">   t := v.Type()                      <span class="comment">// 类型</span></span><br><span class="line">   field := t.Elem().Field(<span class="number">0</span>)         <span class="comment">// 获取字段</span></span><br><span class="line">   fmt.Println(field.Tag.Get(<span class="string">"json"</span>)) <span class="comment">// name</span></span><br><span class="line">   fmt.Println(field.Tag.Get(<span class="string">"db"</span>))   <span class="comment">// stu_name</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:qingbo1011@163.com">qingbo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.qingbo1011.top/2022/04/27/Go%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/">http://www.qingbo1011.top/2022/04/27/Go%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.qingbo1011.top" target="_blank">Qing's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Go/">Go</a></div><div class="post_share"><div class="social-share" data-image="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20231003161115.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2022/04/28/Go%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"><img class="prev_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220707172953.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Go排序</div></div></a></div><div class="next-post pull_right"><a href="/2022/04/26/Golang%E8%BF%9B%E9%98%B602%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><img class="next_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220509153103.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Golang进阶——并发编程</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2022/06/26/Gin+Gorm v2+Github Action的实践/" title="Gin+Gorm v2+Github Action的实践"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220808182712.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-26</div><div class="relatedPosts_title">Gin+Gorm v2+Github Action的实践</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/02/Gin+Gorm开发在线备忘录（To do list）/" title="Gin+Gorm开发在线备忘录（To do list）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-02</div><div class="relatedPosts_title">Gin+Gorm开发在线备忘录（To do list）</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/01/Gin+JWT+Air热部署的简单实践/" title="Gin+JWT+Air热部署的简单实践"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-01</div><div class="relatedPosts_title">Gin+JWT+Air热部署的简单实践</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/21/Gin+WebSocket+MongoDB的IM即时聊天Demo/" title="Gin+Websocket+MangoDB实现的IM系统"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-21</div><div class="relatedPosts_title">Gin+Websocket+MangoDB实现的IM系统</div></div></a></div><div class="relatedPosts_item"><a href="/2022/06/12/Gin-blog：go1.18在gin上的实践/" title="Gin-blog：go1.18在gin上的实践"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-12</div><div class="relatedPosts_title">Gin-blog：go1.18在gin上的实践</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/10/Gin限流/" title="Gin限流"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220718144444.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-10</div><div class="relatedPosts_title">Gin限流</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'oNS5Emx1qUL3wN5yvPLKol0W-gzGzoHsz',
  appKey: 'ytbw0ho3DMX0FeoAOWa37lf9',
  notify: false,
  verify: false,
  placeholder: 'Stay hungry,stay foolish~',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: 'https://',
  emojiMaps: {"欢呼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100836.gif","笑眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100849.gif","花心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100907.gif","吐舌":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100937.gif","疑问":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100951.gif","滑稽":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101004.gif","太开心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101017.gif","酷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101029.gif","怒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101044.gif","阴险":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101100.gif","委屈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101116.gif","乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101129.gif","你懂的":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101204.gif","小乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101215.gif","突然兴奋":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101228.gif","喷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101241.gif","哈哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101255.gif","喝酒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101305.gif","汗":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101323.gif","笑尿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102004.gif","嘿嘿嘿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102018.gif","真棒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102047.gif","托腮":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102108.gif","微笑":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e3/2018new_weixioa02_org.png","礼貌":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/09/2018new_keai_org.png","笑哭":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/4a/2018new_xiaoku_thumb.png","无奈":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/83/2018new_kuxiao_org.png","爱你":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f6/2018new_aini_org.png","吃瓜":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/01/2018new_chigua_thumb.png","doge":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a1/2018new_doge02_org.png","dog":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/22/2018new_erha_org.png","cat":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7b/2018new_miaomiao_thumb.png","星星眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102225.png","酸了":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102240.png","大哭":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102254.png","傲娇":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102314.png","给心心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102328.png","嘿哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102345.png","custom0":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101410.gif","custom1":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101424.webp","狗头":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101710.png","搬砖中":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101744.png","忙到飞起":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102411.png","裂开":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102426.png","叹气":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102439.png","让我看看":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102456.png","panda0":"https://bbs.res.meizu.com/static/image/smiley/panda/_000.png","panda1":"https://bbs.res.meizu.com/static/image/smiley/panda/_001.png","panda2":"https://bbs.res.meizu.com/static/image/smiley/panda/_002.png","panda3":"https://bbs.res.meizu.com/static/image/smiley/panda/_003.png","panda4":"https://bbs.res.meizu.com/static/image/smiley/panda/_004.png","panda5":"https://bbs.res.meizu.com/static/image/smiley/panda/_005.png","panda6":"https://bbs.res.meizu.com/static/image/smiley/panda/_006.png","panda7":"https://bbs.res.meizu.com/static/image/smiley/panda/_007.png","panda8":"https://bbs.res.meizu.com/static/image/smiley/panda/_008.png","panda9":"https://bbs.res.meizu.com/static/image/smiley/panda/_009.png","panda10":"https://bbs.res.meizu.com/static/image/smiley/panda/_010.png","panda11":"https://bbs.res.meizu.com/static/image/smiley/panda/_011.png","panda12":"https://bbs.res.meizu.com/static/image/smiley/panda/_012.png","panda13":"https://bbs.res.meizu.com/static/image/smiley/panda/_013.png","panda14":"https://bbs.res.meizu.com/static/image/smiley/panda/_014.png","panda15":"https://bbs.res.meizu.com/static/image/smiley/panda/_015.png","panda16":"https://bbs.res.meizu.com/static/image/smiley/panda/_016.png","panda17":"https://bbs.res.meizu.com/static/image/smiley/panda/_017.png","panda18":"https://bbs.res.meizu.com/static/image/smiley/panda/_018.png","panda19":"https://bbs.res.meizu.com/static/image/smiley/panda/_019.png","panda20":"https://bbs.res.meizu.com/static/image/smiley/panda/_020.png","panda21":"https://bbs.res.meizu.com/static/image/smiley/panda/_021.png","panda22":"https://bbs.res.meizu.com/static/image/smiley/panda/_022.png","panda23":"https://bbs.res.meizu.com/static/image/smiley/panda/_023.png","panda24":"https://bbs.res.meizu.com/static/image/smiley/panda/_024.png","panda25":"https://bbs.res.meizu.com/static/image/smiley/panda/_025.png","panda26":"https://bbs.res.meizu.com/static/image/smiley/panda/_026.png","panda27":"https://bbs.res.meizu.com/static/image/smiley/panda/_027.png","panda28":"https://bbs.res.meizu.com/static/image/smiley/panda/_028.png","panda29":"https://bbs.res.meizu.com/static/image/smiley/panda/_029.png"},
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220711144924.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By qingbo</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">宇宙很大，生活更大</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>
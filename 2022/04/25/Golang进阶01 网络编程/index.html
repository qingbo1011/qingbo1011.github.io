<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Golang进阶——网络编程 | Qing's Blog</title><meta name="description" content="Golang进阶——网络编程 网络编程 如果要对Go原生的网络编程跟进一步学习的话，可以参考实战教程：【码神之路】原生Go语言博客实战教程  互联网协议介绍 互联网协议介绍 互联网的核心是一系列协议，总称为”互联网协议”（Internet Protocol Suite），正是这一些协议规定了电脑如何连接和组网。我们理解了这些协议，就理解了互联网的原理。 这些协议太过庞大和复杂，这里简单介绍一下日"><meta name="keywords" content="Golang进阶——网络编程"><meta name="author" content="qingbo,qingbo1011@163.com"><meta name="copyright" content="qingbo"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Golang进阶——网络编程"><meta name="twitter:description" content="Golang进阶——网络编程 网络编程 如果要对Go原生的网络编程跟进一步学习的话，可以参考实战教程：【码神之路】原生Go语言博客实战教程  互联网协议介绍 互联网协议介绍 互联网的核心是一系列协议，总称为”互联网协议”（Internet Protocol Suite），正是这一些协议规定了电脑如何连接和组网。我们理解了这些协议，就理解了互联网的原理。 这些协议太过庞大和复杂，这里简单介绍一下日"><meta name="twitter:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220509153103.png"><meta property="og:type" content="article"><meta property="og:title" content="Golang进阶——网络编程"><meta property="og:url" content="http://www.qingbo1011.top/2022/04/25/Golang%E8%BF%9B%E9%98%B601%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><meta property="og:site_name" content="Qing's Blog"><meta property="og:description" content="Golang进阶——网络编程 网络编程 如果要对Go原生的网络编程跟进一步学习的话，可以参考实战教程：【码神之路】原生Go语言博客实战教程  互联网协议介绍 互联网协议介绍 互联网的核心是一系列协议，总称为”互联网协议”（Internet Protocol Suite），正是这一些协议规定了电脑如何连接和组网。我们理解了这些协议，就理解了互联网的原理。 这些协议太过庞大和复杂，这里简单介绍一下日"><meta property="og:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220509153103.png"><meta property="article:published_time" content="2022-04-25T00:47:03.000Z"><meta property="article:modified_time" content="2023-10-03T08:16:11.761Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://www.qingbo1011.top/2022/04/25/Golang%E8%BF%9B%E9%98%B601%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><link rel="prev" title="Golang进阶——并发编程" href="http://www.qingbo1011.top/2022/04/26/Golang%E8%BF%9B%E9%98%B602%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><link rel="next" title="Golang基础（二）" href="http://www.qingbo1011.top/2022/04/24/Golang%E5%9F%BA%E7%A1%8002/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230440.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">87</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">81</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#golang进阶网络编程"><span class="toc-number">1.</span> <span class="toc-text"> Golang进阶——网络编程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#互联网协议介绍"><span class="toc-number">2.</span> <span class="toc-text"> 互联网协议介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#互联网分层模型"><span class="toc-number">3.</span> <span class="toc-text"> 互联网分层模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#物理层"><span class="toc-number">3.1.</span> <span class="toc-text"> 物理层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据链路层"><span class="toc-number">3.2.</span> <span class="toc-text"> 数据链路层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络层"><span class="toc-number">3.3.</span> <span class="toc-text"> 网络层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#传输层"><span class="toc-number">3.4.</span> <span class="toc-text"> 传输层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用层"><span class="toc-number">3.5.</span> <span class="toc-text"> 应用层</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#socket编程"><span class="toc-number">4.</span> <span class="toc-text"> Socket编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#socket介绍"><span class="toc-number">4.1.</span> <span class="toc-text"> Socket介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go语言实现tcp通信"><span class="toc-number">4.2.</span> <span class="toc-text"> Go语言实现TCP通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tcp服务端"><span class="toc-number">4.2.1.</span> <span class="toc-text"> TCP服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcp客户端"><span class="toc-number">4.2.2.</span> <span class="toc-text"> TCP客户端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go语言实现udp通信"><span class="toc-number">4.3.</span> <span class="toc-text"> Go语言实现UDP通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#udp服务端"><span class="toc-number">4.3.1.</span> <span class="toc-text"> UDP服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#udp客户端"><span class="toc-number">4.3.2.</span> <span class="toc-text"> UDP客户端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp粘包"><span class="toc-number">4.4.</span> <span class="toc-text"> TCP粘包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tcp粘包示例"><span class="toc-number">4.4.1.</span> <span class="toc-text"> TCP粘包示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决方案"><span class="toc-number">4.4.2.</span> <span class="toc-text"> 解决方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http编程"><span class="toc-number">5.</span> <span class="toc-text"> HTTP编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#http服务端"><span class="toc-number">5.1.</span> <span class="toc-text"> HTTP服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http客户端"><span class="toc-number">5.2.</span> <span class="toc-text"> HTTP客户端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#websocket编程"><span class="toc-number">6.</span> <span class="toc-text"> WebSocket编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#websocket是什么"><span class="toc-number">6.1.</span> <span class="toc-text"> WebSocket是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#聊天室小案例"><span class="toc-number">6.2.</span> <span class="toc-text"> 聊天室小案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#datago"><span class="toc-number">6.2.1.</span> <span class="toc-text"> data.go</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#connectiongo"><span class="toc-number">6.2.2.</span> <span class="toc-text"> connection.go</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hubgo"><span class="toc-number">6.2.3.</span> <span class="toc-text"> hub.go</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#servergo"><span class="toc-number">6.2.4.</span> <span class="toc-text"> server.go</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#localhtml"><span class="toc-number">6.2.5.</span> <span class="toc-text"> local.html</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#爬虫"><span class="toc-number">7.</span> <span class="toc-text"> 爬虫</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220509153103.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Qing's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Golang进阶——网络编程</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2022-04-25 08:47:03"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2022-04-25</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2023-10-03 16:16:11"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2023-10-03</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Go/">Go</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">7.7k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 30 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2022/04/25/Golang%E8%BF%9B%E9%98%B601%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2022/04/25/Golang%E8%BF%9B%E9%98%B601%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="golang进阶网络编程"><a class="markdownIt-Anchor" href="#golang进阶网络编程"></a> Golang进阶——网络编程</h1>
<p><a href="https://www.topgoer.com/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" target="_blank" rel="noopener">网络编程</a></p>
<p>如果要对Go原生的网络编程跟进一步学习的话，可以参考实战教程：<a href="https://www.bilibili.com/video/BV1VS4y1F7NM" target="_blank" rel="noopener">【码神之路】原生Go语言博客实战教程</a></p>
<h1 id="互联网协议介绍"><a class="markdownIt-Anchor" href="#互联网协议介绍"></a> 互联网协议介绍</h1>
<p><a href="https://www.topgoer.com/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E4%BA%92%E8%81%94%E7%BD%91%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D.html" target="_blank" rel="noopener">互联网协议介绍</a></p>
<p>互联网的核心是一系列协议，总称为”互联网协议”（Internet Protocol Suite），正是这一些协议规定了电脑如何连接和组网。我们理解了这些协议，就理解了互联网的原理。</p>
<p>这些协议太过庞大和复杂，这里简单介绍一下日常开发中接触较多的几个协议。</p>
<h1 id="互联网分层模型"><a class="markdownIt-Anchor" href="#互联网分层模型"></a> 互联网分层模型</h1>
<p>计网知识中经常提到的OSI七层模型。</p>
<p>互联网的逻辑实现被分为好几层。每一层都有自己的功能，就像建筑物一样，每一层都靠下一层支持。用户接触到的只是最上面的那一层，根本不会感觉到下面的几层。要理解互联网就需要自下而上理解每一层的实现的功能。</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220514132232.png" alt="" /></p>
<p>如上图所示，互联网按照不同的模型划分会有不用的分层，但是不论按照什么模型去划分，越往上的层越靠近用户，越往下的层越靠近硬件。在软件开发中我们使用最多的是上图中将互联网划分为五个分层的模型。</p>
<h2 id="物理层"><a class="markdownIt-Anchor" href="#物理层"></a> 物理层</h2>
<p>我们的电脑要与外界互联网通信，需要先把电脑连接网络，我们可以用<strong>双绞线、光纤、无线电波</strong>等方式。这就叫做”实物理层”，它就是把电脑连接起来的物理手段。它主要规定了网络的一些电气特性，<strong>作用是负责传送0和1的电信号</strong>。</p>
<h2 id="数据链路层"><a class="markdownIt-Anchor" href="#数据链路层"></a> 数据链路层</h2>
<p>单纯的0和1没有任何意义，所以我们使用者会为其赋予一些特定的含义，规定解读电信号的方式：例如：多少个电信号算一组？每个信号位有何意义？这就是<strong>数据链接层</strong>的功能，它在<strong>物理层</strong>的上方，<strong>确定了物理层传输的0和1的分组方式及代表的意义</strong>。早期的时候，每家公司都有自己的电信号分组方式。逐渐地，一种叫做”以太网”（Ethernet）的协议，占据了主导地位。</p>
<p>以太网规定，一组电信号构成一个数据包，叫做<strong>帧（Frame）</strong>。每一帧分成两个部分：<strong>标头（Head）<strong>和</strong>数据（Data）</strong>。其中<strong>标头</strong>包含数据包的一些说明项，比如发送者、接受者、数据类型等等；<strong>数据</strong>则是数据包的具体内容。<strong>标头的长度，固定为18字节</strong>；<strong>数据的长度，最短为46字节，最长为1500字节</strong>。因此，<strong>整个帧最短为64字节，最长为1518字节</strong>。如果数据很长，就必须分割成多个帧进行发送。</p>
<p>那么，发送者和接受者是如何标识呢？以太网规定，连入网络的所有设备都必须具有<strong>网卡</strong>接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做<strong>MAC地址</strong>。每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48个二进制位，通常用12个十六进制数表示。前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号。有了MAC地址，就可以定位网卡和数据包的路径了。</p>
<p>我们会通过ARP协议来获取接受方的MAC地址，有了MAC地址之后，如何把数据准确的发送给接收方呢？其实这里以太网采用了一种很“原始”的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机都发送，让每台计算机读取这个包的标头，找到接收方的MAC地址，然后与自身的MAC地址相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。这种发送方式就叫做<strong>广播（broadcasting）</strong>。</p>
<h2 id="网络层"><a class="markdownIt-Anchor" href="#网络层"></a> 网络层</h2>
<p>按照以太网协议的规则我们可以依靠MAC地址来向外发送数据。理论上依靠MAC地址，你电脑的网卡就可以找到身在世界另一个角落的某台电脑的网卡了，但是这种做法有一个重大缺陷就是<strong>以太网采用广播方式发送数据包</strong>，所有成员人手一”包”，不仅<strong>效率低</strong>，而且<strong>发送的数据只能局限在发送者所在的子网络</strong>。也就是说如果两台计算机不在同一个子网络，广播是传不过去的。这种设计是合理且必要的，因为如果互联网上每一台计算机都会收到互联网上收发的所有数据包，那是不现实的。</p>
<p>因此，必须找到一种方法区分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则就采用<strong>路由</strong>方式发送。这就导致了<strong>网络层</strong>的诞生。它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做<strong>网络地址</strong>，简称<strong>网址</strong>。</p>
<p><strong>网络层</strong>出现以后，每台计算机有了两种地址，一种是<strong>MAC地址</strong>，另一种是<strong>网络地址</strong>。两种地址之间没有任何联系，<strong>MAC地址是绑定在网卡上的，网络地址则是网络管理员分配的</strong>。网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是<strong>先处理网络地址，然后再处理MAC地址。</strong></p>
<p>规定网络地址的协议，叫做<strong>IP协议</strong>。它所定义的地址，就被称为<strong>IP地址</strong>。目前，广泛采用的是IP协议第四版，简称IPv4。IPv4这个版本规定，网络地址由32个二进制位组成，我们通常习惯用分成四段的十进制数表示IP地址，从<code>0.0.0.0</code>一直到<code>255.255.255.255</code>。</p>
<p>根据IP协议发送的数据，就叫做<strong>IP数据包</strong>。IP数据包也分为<strong>标头</strong>和<strong>数据</strong>两个部分：标头部分主要包括版本、长度、IP地址等信息；数据部分则是IP数据包的具体内容。I<strong>P数据包的标头部分的长度为20到60字节，整个数据包的总长度最大为65535字节。</strong></p>
<h2 id="传输层"><a class="markdownIt-Anchor" href="#传输层"></a> 传输层</h2>
<p>有了MAC地址和IP地址，我们已经可以在互联网上任意两台主机上建立通信。但问题是同一台主机上会有许多程序都需要用网络收发数据，比如QQ和浏览器这两个程序都需要连接互联网并收发数据，我们如何区分某个数据包到底是归哪个程序的呢？也就是说，我们<strong>还需要一个参数，表示这个数据包到底供哪个程序（进程）使用</strong>。这个参数就叫做<strong>端口（port）</strong>，它其实是每一个使用网卡的程序的编号。每个数据包都发到主机的特定端口，所以不同的程序就能取到自己所需要的数据。</p>
<p><strong>端口是0到65535之间的一个整数</strong>，正好16个二进制位。0到1023的端口被系统占用，用户只能选用大于1023的端口。有了IP和端口我们就能实现唯一确定互联网上一个程序，进而实现网络间的程序通信。</p>
<p>我们必须在数据包中加入端口信息，这就需要新的协议。最简单的实现叫做<strong>UDP协议</strong>，它的格式几乎就是在数据前面，加上端口号。<strong>UDP数据包</strong>，也是由<strong>标头</strong>和<strong>数据</strong>两部分组成：标头部分主要定义了发出端口和接收端口，数据部分就是具体的内容。<strong>UDP数据包非常简单，标头部分一共只有8个字节，总长度不超过65535字节，正好放进一个IP数据包。</strong></p>
<p>UDP协议的优点是比较简单，容易实现，但是缺点是可靠性较差，一旦数据包发出，无法知道对方是否收到。为了解决这个问题，提高网络可靠性，<strong>TCP协议</strong>就诞生了。TCP协议能够确保数据不会遗失。它的缺点是过程复杂、实现困难、消耗较多的资源。TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。</p>
<h2 id="应用层"><a class="markdownIt-Anchor" href="#应用层"></a> 应用层</h2>
<p>应用程序收到<strong>传输层</strong>的数据，接下来就要对数据进行解包。由于互联网是开放架构，数据来源五花八门，必须事先规定好通信的数据格式，否则接收方根本无法获得真正发送的数据内容。”应用层”的作用就是规定应用程序使用的数据格式，例如我们<strong>TCP协议之上</strong>常见的<code>HTTP</code>、<code>HTTPS</code>、<code>FTP</code>、<code>SMTP</code>、<code>POP3</code>、等协议，这些协议就组成了互联网协议的应用。</p>
<p>只使用TCP协议的协议：</p>
<ul>
<li><code>HTTP</code>协议：超文本传输协议，用于普通浏览</li>
<li><code>HTTPS</code>协议：安全超文本传输协议，身披SSL外衣的HTTP协议</li>
<li><code>FTP</code>协议：文件传输协议，用于文件传输</li>
<li><code>POP3</code>协议：邮局协议，收邮件使用</li>
<li><code>SMTP</code>协议：简单邮件传输协议，用来发送电子邮件</li>
<li><code>Telent</code>协议：远程登陆协议，通过一个终端登陆到网络</li>
<li><code>SSH</code>协议：安全外壳协议，用于加密安全登陆，替代安全性差的Telent协议</li>
</ul>
<blockquote>
<p><strong>DNS区域传输的时候使用TCP协议，域名解析时使用UDP协议。</strong></p>
</blockquote>
<p>发送方的HTTP数据经过互联网的传输过程中会依次添加各层协议的标头信息，接收方收到数据包之后再依次根据协议解包得到数据。</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220514201323.png" alt="" /></p>
<h1 id="socket编程"><a class="markdownIt-Anchor" href="#socket编程"></a> Socket编程</h1>
<p><a href="https://www.topgoer.com/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/socket%E7%BC%96%E7%A8%8B/" target="_blank" rel="noopener">socket编程</a></p>
<h2 id="socket介绍"><a class="markdownIt-Anchor" href="#socket介绍"></a> Socket介绍</h2>
<p>Socket是BSD UNIX的进程通信机制，通常也称作套接字，用于描述IP地址和端口，是一个通信链的句柄。<strong>Socket可以理解为TCP/IP网络的API</strong>，它定义了许多函数或例程，程序员可以用它们来开发TCP/IP网络上的应用程序。电脑上运行的应用程序通常通过套接字向网络发出请求或者应答网络请求。</p>
<p><strong>Socket是应用层与TCP/IP协议族通信的中间软件抽象层</strong>。在设计模式中，Socket其实就是一个门面模式，它把复杂的TCP/IP协议族隐藏在Socket后面，<strong>对用户来说只需要调用Socket规定的相关函数，让Socket去组织符合指定的协议数据然后进行通信</strong>。</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220514201857.png" alt="" /></p>
<p>Socket又称套接字，应用程序通常通过套接字向网络发出请求或者应答网络请求。常用的Socket类型有两种：<strong>流式Socket</strong>和<strong>数据报式Socket</strong>。</p>
<ul>
<li><strong>流式</strong>是一种面向连接的Socket, 针对于面向连接的<strong>TCP</strong>服务应用（TCP：可靠，面向连接，速度慢）</li>
<li><strong>数据报式</strong>Socket是一种无连接的Socket, 针对于无连接的<strong>UDP</strong>服务应用（UDP：可靠，无连接，速度快）</li>
</ul>
<blockquote>
<p>举个例子：TCP就像货到付款的快递，送到家还必须见到你人才算一整套流程。UDP就像某快递快递柜一扔就走管你收到收不到，<strong>一般直播用UDP</strong>。</p>
</blockquote>
<h2 id="go语言实现tcp通信"><a class="markdownIt-Anchor" href="#go语言实现tcp通信"></a> Go语言实现TCP通信</h2>
<p>TCP协议：TCP/IP(Transmission Control Protocol/Internet Protocol) 即传输控制协议/网间协议，是一种面向连接（连接导向）的、可靠的、基于字节流的传输层（Transport layer）通信协议，因为是面向连接的协议，数据像水流一样传输，会存在<strong>粘包问题</strong>。</p>
<h3 id="tcp服务端"><a class="markdownIt-Anchor" href="#tcp服务端"></a> TCP服务端</h3>
<p><strong>一个TCP服务端可以同时连接很多个客户端</strong>，例如世界各地的用户使用自己电脑上的浏览器访问淘宝网。因为Go语言中创建多个<strong>goroutine</strong>实现<strong>并发</strong>非常方便和高效，所以我们可以<strong>每建立一次链接就创建一个goroutine去处理</strong>。</p>
<p>TCP服务端程序的处理流程：</p>
<ol>
<li>监听端口</li>
<li>接收客户端请求建立链接</li>
<li>创建goroutine处理链接</li>
</ol>
<p>TCP服务端代码如下：<code>socket/tcp/server/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	listen, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:20000"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"listen failed, err:, err:"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		conn, err := listen.Accept() <span class="comment">// 建立连接</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"accept failed, err:"</span>, err)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">go</span> process(conn) <span class="comment">// 启动一个goroutine处理连接</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		reader := bufio.NewReader(conn)</span><br><span class="line">		<span class="keyword">var</span> buf [<span class="number">128</span>]<span class="keyword">byte</span></span><br><span class="line">		n, err := reader.Read(buf[:])</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"read from client failed, err:"</span>, err)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		recvStr := <span class="keyword">string</span>(buf[:n])</span><br><span class="line">		fmt.Println(<span class="string">"收到client端发来的数据："</span>, recvStr)</span><br><span class="line">		conn.Write([]<span class="keyword">byte</span>(recvStr)) <span class="comment">// 发送数据</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在终端执行：<code>go build -o ./socket/tcp/cmd/server.exe ./socket/tcp/server</code>，编译出可执行文件<code>server.exe</code>并保存在<code>cmd</code>包下。</p>
<blockquote>
<p>这里给出以下项目目录，就清楚<code>go build</code>的用法了：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220515003856.png" alt="" /></p>
</blockquote>
<h3 id="tcp客户端"><a class="markdownIt-Anchor" href="#tcp客户端"></a> TCP客户端</h3>
<p>一个TCP客户端进行TCP通信的流程如下：</p>
<ol>
<li>建立与服务端的链接</li>
<li>进行数据收发</li>
<li>关闭链接</li>
</ol>
<p>TCP客户端代码如下：<code>socket/tcp/client/client.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"bufio"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"net"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">   <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   conn, err := net.Dial(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:20000"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"建立网络连接出现错误："</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> conn.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">   inputReader := bufio.NewReader(os.Stdin)</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      input, err := inputReader.ReadString(<span class="string">'\n'</span>) <span class="comment">// 读取用户输入</span></span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"读取用户输入失败："</span>, err)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      inputInfo := strings.Trim(input, <span class="string">"\r\n"</span>)  <span class="comment">// 去掉input中的回车和换行</span></span><br><span class="line">      <span class="keyword">if</span> inputInfo == <span class="string">"q"</span> || inputInfo == <span class="string">"Q"</span> &#123; <span class="comment">// 输入q(Q)就退出</span></span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      _, err = conn.Write([]<span class="keyword">byte</span>(inputInfo)) <span class="comment">// 发送数据</span></span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"发送数据失败："</span>, err)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      buf := [<span class="number">512</span>]<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line">      n, err := conn.Read(buf[:])</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"recv failed, err:"</span>, err)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Println(<span class="keyword">string</span>(buf[:n]))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在终端执行：<code>go build -o ./socket/tcp/cmd/client.exe ./socket/tcp/client</code>，编译出可执行文件<code>client.exe</code>并保存在<code>cmd</code>包下。</p>
<p>然后我们先后启动server端和client端，在client端输入任意内容回车之后就能够在server端看到client端发送的数据，从而实现TCP通信。</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220515004024.png" alt="" /></p>
<h2 id="go语言实现udp通信"><a class="markdownIt-Anchor" href="#go语言实现udp通信"></a> Go语言实现UDP通信</h2>
<p>UDP协议：UDP协议（User Datagram Protocol）中文名称是用户数据报协议，是OSI（Open System Interconnection，开放式系统互联）参考模型中一种无连接的传输层协议，<strong>不需要建立连接</strong>就能直接进行数据发送和接收，属于不可靠的、没有时序的通信，但是UDP协议的实时性比较好，<strong>通常用于视频直播</strong>相关领域。</p>
<h3 id="udp服务端"><a class="markdownIt-Anchor" href="#udp服务端"></a> UDP服务端</h3>
<p>UDP服务端代码如下：<code>socket/udp/server/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   listen, err := net.ListenUDP(<span class="string">"udp"</span>, &amp;net.UDPAddr&#123;</span><br><span class="line">      IP:   net.IPv4(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">      Port: <span class="number">30000</span>,</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"listen failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> listen.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> data [<span class="number">1024</span>]<span class="keyword">byte</span></span><br><span class="line">      n, addr, err := listen.ReadFromUDP(data[:]) <span class="comment">// 接受数据</span></span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"read udp failed, err:"</span>, err)</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Printf(<span class="string">"data:%v addr:%v count:%v"</span>, <span class="keyword">string</span>(data[:n]), addr, n)</span><br><span class="line">      _, err = listen.WriteToUDP(data[:n], addr) <span class="comment">// 发送数据</span></span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"write to udp failed, err:"</span>, err)</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在终端执行：<code>go build -o ./socket/udp/cmd/server.exe ./socket/udp/server</code>，编译出可执行文件<code>server.exe</code>并保存在<code>cmd</code>包下。</p>
<h3 id="udp客户端"><a class="markdownIt-Anchor" href="#udp客户端"></a> UDP客户端</h3>
<p>UDP服务端代码如下：<code>socket/udp/client/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	socket, err := net.DialUDP(<span class="string">"udp"</span>, <span class="literal">nil</span>, &amp;net.UDPAddr&#123;</span><br><span class="line">		IP:   net.IPv4(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">		Port: <span class="number">30000</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"连接服务器失败！err："</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> socket.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">	sendData := []<span class="keyword">byte</span>(<span class="string">"hello,world!"</span>)</span><br><span class="line">	_, err = socket.Write(sendData) <span class="comment">// 发送数据</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"发送数据失败！err："</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	data := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">4096</span>)</span><br><span class="line">	n, udpAddr, err := socket.ReadFromUDP(data) <span class="comment">// 接收数据</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"接收数据失败！err："</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"receive:%v addr:%v count:%v \n"</span>, <span class="keyword">string</span>(data[:n]), udpAddr, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在终端执行：<code>go build -o ./socket/udp/cmd/client.exe ./socket/udp/client</code>，编译出可执行文件<code>client.exe</code>并保存在<code>cmd</code>包下。</p>
<p>我们先运行<code>server.exe</code>，然后点击一次<code>client.exe</code>都会发现<code>server.exe</code>更新了数据：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220515004916.png" alt="" /></p>
<h2 id="tcp粘包"><a class="markdownIt-Anchor" href="#tcp粘包"></a> TCP粘包</h2>
<h3 id="tcp粘包示例"><a class="markdownIt-Anchor" href="#tcp粘包示例"></a> TCP粘包示例</h3>
<p>强烈推荐：<strong><a href="https://segmentfault.com/a/1190000039691657" target="_blank" rel="noopener">硬核图解|tcp为什么会粘包？背后的原因让人暖心</a></strong></p>
<blockquote>
<p>粘包出现的根本原因是不确定<strong>消息的边界</strong>。接收端在面对**&quot;无边无际&quot;的二进制流<strong>的时候，根本不知道收了多少 01 才算</strong>一个消息**。一不小心拿多了就说是<strong>粘包</strong>。其实粘包根本不是 TCP 的问题，是<strong>使用者对于 TCP 的理解有误</strong>导致的一个问题。</p>
<p>只要在发送端每次发送消息的时候给消息<strong>带上识别消息边界的信息</strong>，接收端就可以根据这些信息识别出消息的边界，从而区分出每个消息。</p>
<p>常见方法有：</p>
<ul>
<li>加入特殊标志</li>
<li>加入消息长度信息</li>
</ul>
</blockquote>
<p>我们先看一个例子。</p>
<p>编写服务端代码如下：<code>socket/tcp_stick/server/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	listen, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"listen failed, err:"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> listen.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		conn, err := listen.Accept()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"accept failed, err:"</span>, err)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">go</span> process(conn)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">	reader := bufio.NewReader(conn)</span><br><span class="line">	<span class="keyword">var</span> buf [<span class="number">1024</span>]<span class="keyword">byte</span></span><br><span class="line">	<span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">		n, err := reader.Read(buf[:])</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">			fmt.Println(<span class="string">"read from client failed, err:"</span>, err)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		recvStr := <span class="keyword">string</span>(buf[:n])</span><br><span class="line">		fmt.Println(<span class="string">"收到client发来的数据："</span>, recvStr)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在终端执行：<code>go build -o ./socket/tcp_stick/cmd/server.exe ./socket/tcp_stick/server</code>，编译出可执行文件<code>server.exe</code>并保存在<code>cmd</code>包下。</p>
<p>编写客户端代码如下：<code>socket/tcp_stick/client/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	conn, err := net.Dial(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"dial failed, err"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">		msg := <span class="string">"hello,world! --from:qingbo1011.top"</span></span><br><span class="line">		conn.Write([]<span class="keyword">byte</span>(msg))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在终端执行：<code>go build -o ./socket/tcp_stick/cmd/client.exe ./socket/tcp_stick/client</code>，编译出可执行文件<code>client.exe</code>并保存在<code>cmd</code>包下。</p>
<p>先启动服务端再启动客户端，可以看到服务端输出结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220518162103.png" alt="" /></p>
<p>客户端分20次发送的数据，在服务端并没有成功的输出20次，而是多条数据“粘”到了一起。</p>
<p>为什么会出现TCP粘包呢？主要原因就是tcp数据传递模式是流模式（传输字节流），在保持长连接的时候可以进行多次的收和发。粘包可发生在发送端也可发生在接收端：</p>
<ul>
<li>由Nagle算法造成的发送端的粘包：Nagle算法是一种改善网络传输效率的算法。简单来说就是当我们提交一段数据给TCP发送时，TCP并不立刻发送此段数据，而是等待一小段时间看看在等待期间是否还有要发送的数据，若有则会一次把这两段数据发送出去。</li>
<li>接收端接收不及时造成的接收端粘包：TCP会把接收到的数据存在自己的缓冲区中，然后通知应用层取数据。当应用层由于某些原因不能及时的把TCP的数据取出来，就会造成TCP缓冲区中存放了几段数据。</li>
</ul>
<h3 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案"></a> 解决方案</h3>
<p>出现粘包的关键在于接收方不确定将要传输的数据包的大小，因此我们可以<strong>对数据包进行封包和拆包的操作</strong>。</p>
<p>封包：<strong>封包就是给一段数据加上包头</strong>，这样一来数据包就分为包头和包体两部分内容了(过滤非法包时封包会加入”包尾”内容)。包头部分的长度是固定的，并且它存储了包体的长度，根据包头长度固定以及包头中含有包体长度的变量就能正确的拆分出一个完整的数据包。</p>
<p>我们先自己定义一个协议，比如数据包的前4个字节为包头，里面<strong>存储发送的数据长度</strong>。</p>
<p>proto代码如下：<code>socket/tcp_stick/proto/proto.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> proto</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"bufio"</span></span><br><span class="line">   <span class="string">"bytes"</span></span><br><span class="line">   <span class="string">"encoding/binary"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encode 将消息编码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Encode</span><span class="params">(msg <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">   <span class="comment">// 读取消息的长度，转换为int32类型（占4个字节）</span></span><br><span class="line">   length := <span class="keyword">int32</span>(<span class="built_in">len</span>(msg))</span><br><span class="line">   pkg := <span class="built_in">new</span>(bytes.Buffer) <span class="comment">// 使用new函数得到的是一个类型的指针，并且该指针对应的值为该类型的零值</span></span><br><span class="line">   <span class="comment">// 写入消息头</span></span><br><span class="line">   err := binary.Write(pkg, binary.LittleEndian, length)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 写入消息实体</span></span><br><span class="line">   err = binary.Write(pkg, binary.LittleEndian, []<span class="keyword">byte</span>(msg))</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> pkg.Bytes(), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Decode 解码消息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decode</span><span class="params">(reader *bufio.Reader)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">   <span class="comment">// 读取消息的长度</span></span><br><span class="line">   lengthByte, err := reader.Peek(<span class="number">4</span>) <span class="comment">// 读取前4个字节的数据</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   lengthBuff := bytes.NewBuffer(lengthByte)</span><br><span class="line">   <span class="keyword">var</span> length <span class="keyword">int32</span></span><br><span class="line">   err = binary.Read(lengthBuff, binary.LittleEndian, &amp;length)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// Buffered返回缓冲中现有的可读取的字节数。</span></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">int32</span>(reader.Buffered()) &lt; length+<span class="number">4</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 读取真正的消息数据</span></span><br><span class="line">   pack := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="keyword">int</span>(<span class="number">4</span>+length))</span><br><span class="line">   _, err = reader.Read(pack)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">string</span>(pack[<span class="number">4</span>:]), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来在服务端和客户端分别<strong>使用上面定义的proto包的<code>Decode</code>和<code>Encode</code>函数处理数据</strong>。</p>
<p>服务端代码如下：<code>socket/tcp_stick/server/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"bufio"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"io"</span></span><br><span class="line">   <span class="string">"net"</span></span><br><span class="line">   <span class="string">"web/socket/tcp_stick/proto"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   listen, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"listen failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> listen.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line">      conn, err := listen.Accept()</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"accept failed, err:"</span>, err)</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">go</span> process(conn)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> conn.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">   reader := bufio.NewReader(conn)</span><br><span class="line">   <span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">      msg, err := proto.Decode(reader)</span><br><span class="line">      <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"decode msg failed,err:"</span>, err)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Println(<span class="string">"收到client发来的数据："</span>, msg)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端代码如下：<code>socket/tcp_stick/client/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"net"</span></span><br><span class="line">   <span class="string">"web/socket/tcp_stick/proto"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   conn, err := net.Dial(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"dial failed, err"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> conn.Close()</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">      msg := <span class="string">"hello,world! --from:qingbo1011.top"</span></span><br><span class="line">      data, err := proto.Encode(msg)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"encode msg failed, err:"</span>, err)</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      conn.Write(data)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时再进行<code>go build</code>，然后先运行服务端再运行客户端，结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220518175430.png" alt="" /></p>
<p>这样就解决了TCP粘包问题。</p>
<h1 id="http编程"><a class="markdownIt-Anchor" href="#http编程"></a> HTTP编程</h1>
<p>Web服务器的工作原理可以简单地归纳为：</p>
<ul>
<li>客户机通过<strong>TCP/IP协议</strong>建立到服务器的TCP连接</li>
<li>客户端向服务器发送<strong>HTTP协议</strong>请求包，请求服务器里的资源文档</li>
<li>服务器向客户机发送HTTP协议应答包，如果请求的资源包含有动态语言的内容，那么服务器会调用动态语言的解释引擎负责处理动态内容，并将处理得到的数据返回给客户端</li>
<li>客户机与服务器断开。由客户端解释HTML文档，在客户端屏幕上渲染图形结果</li>
</ul>
<p>HTTP协议：超文本传输协议(HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议，它详细规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。</p>
<p>HTTP协议承载于TCP协议之上。</p>
<h2 id="http服务端"><a class="markdownIt-Anchor" href="#http服务端"></a> HTTP服务端</h2>
<p>HTTP服务端代码如下：<code>http/server/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">"/go"</span>, myHandler)                 <span class="comment">// 单独写回调函数</span></span><br><span class="line">   err := http.ListenAndServe(<span class="string">"127.0.0.1:8000"</span>, <span class="literal">nil</span>) <span class="comment">// 参数说明：addr：监听的地址 handler：回调函数</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// handler函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myHandler</span><span class="params">(writer http.ResponseWriter, request *http.Request)</span></span> &#123;</span><br><span class="line">   fmt.Println(request.RemoteAddr, <span class="string">"连接成功！"</span>)</span><br><span class="line">   <span class="comment">// 请求方式有：GET POST DELETE PUT UPDATE</span></span><br><span class="line">   fmt.Println(<span class="string">"method:"</span>, request.Method)</span><br><span class="line">   <span class="comment">// /go路由下</span></span><br><span class="line">   fmt.Println(<span class="string">"url:"</span>, request.URL)</span><br><span class="line">   fmt.Println(<span class="string">"header:"</span>, request.Header)</span><br><span class="line">   fmt.Println(<span class="string">"body:"</span>, request.Body)</span><br><span class="line">   <span class="comment">// 回复</span></span><br><span class="line">   writer.Write([]<span class="keyword">byte</span>(<span class="string">"hello,world! form:qingbo1011.top"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="http客户端"><a class="markdownIt-Anchor" href="#http客户端"></a> HTTP客户端</h2>
<p>HTTP客户端代码如下：<code>http/server/main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//resp, err := http.Get("https://www.baidu.com/")</span></span><br><span class="line">	<span class="comment">//fmt.Println(resp)</span></span><br><span class="line">	resp, err := http.Get(<span class="string">"http://127.0.0.1:8000/go"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"http.Get Error:"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close() <span class="comment">// 关闭连接</span></span><br><span class="line">	fmt.Println(resp.Status)</span><br><span class="line">	fmt.Println(resp.Header)</span><br><span class="line"></span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">4096</span>)</span><br><span class="line">	<span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">		<span class="comment">// 接受服务端信息</span></span><br><span class="line">		n, err := resp.Body.Read(buf)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != io.EOF &#123;</span><br><span class="line">			fmt.Println(<span class="string">"resp.Body.Read Error:"</span>, err)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="string">"读取完毕"</span>)</span><br><span class="line">		res := <span class="keyword">string</span>(buf[:n])</span><br><span class="line">		fmt.Println(res)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先运行服务端代码，再运行客户端，结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220515115430.png" alt="server" /></p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220515115503.png" alt="client" /></p>
<h1 id="websocket编程"><a class="markdownIt-Anchor" href="#websocket编程"></a> WebSocket编程</h1>
<h2 id="websocket是什么"><a class="markdownIt-Anchor" href="#websocket是什么"></a> WebSocket是什么</h2>
<p><strong><a href="https://www.zhihu.com/question/20215561/answer/40316953" target="_blank" rel="noopener">WebSocket 是什么原理？为什么可以实现持久连接？</a></strong></p>
<ul>
<li><strong>WebSocket是一种在单个TCP连接上进行全双工通信的协议</strong></li>
<li>WebSocket使得客户端和服务器之间的数据交换变得更加简单，<strong>允许服务端主动向客户端推送数据</strong></li>
<li>在WebSocket API中，<strong>浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输</strong></li>
</ul>
<p>需要安装第三方包：cmd中：<code>go get -u -v github.com/gorilla/websocket</code></p>
<h2 id="聊天室小案例"><a class="markdownIt-Anchor" href="#聊天室小案例"></a> 聊天室小案例</h2>
<p>首先在<strong>同一级目录下</strong>新建四个go文件：<code>data.go</code>，<code>connection.go</code>，<code>hub.go</code>，<code>server.go</code>。</p>
<h3 id="datago"><a class="markdownIt-Anchor" href="#datago"></a> data.go</h3>
<p>编写data.go代码如下：<code>websocket/data.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Data <span class="keyword">struct</span> &#123;</span><br><span class="line">   Ip       <span class="keyword">string</span>   <span class="string">`json:"ip"`</span></span><br><span class="line">   User     <span class="keyword">string</span>   <span class="string">`json:"user"`</span></span><br><span class="line">   From     <span class="keyword">string</span>   <span class="string">`json:"from"`</span></span><br><span class="line">   Type     <span class="keyword">string</span>   <span class="string">`json:"type"`</span></span><br><span class="line">   Content  <span class="keyword">string</span>   <span class="string">`json:"content"`</span></span><br><span class="line">   UserList []<span class="keyword">string</span> <span class="string">`json:"user_list"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="connectiongo"><a class="markdownIt-Anchor" href="#connectiongo"></a> connection.go</h3>
<p>编写connection.go代码如下：<code>websocket/connection.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"encoding/json"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"github.com/gorilla/websocket"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> connection <span class="keyword">struct</span> &#123;</span><br><span class="line">   ws   *websocket.Conn</span><br><span class="line">   sc   <span class="keyword">chan</span> []<span class="keyword">byte</span></span><br><span class="line">   data *Data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *connection)</span> <span class="title">writer</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> msg := <span class="keyword">range</span> c.sc &#123;</span><br><span class="line">      c.ws.WriteMessage(websocket.TextMessage, msg)</span><br><span class="line">   &#125;</span><br><span class="line">   c.ws.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *connection)</span> <span class="title">reader</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">      _, message, err := c.ws.ReadMessage()</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">         h.r &lt;- c</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      json.Unmarshal(message, &amp;c.data) <span class="comment">// 反序列化</span></span><br><span class="line">      <span class="keyword">switch</span> c.data.Type &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"login"</span>:</span><br><span class="line">         c.data.User = c.data.Content</span><br><span class="line">         c.data.From = c.data.User</span><br><span class="line">         user_list = <span class="built_in">append</span>(user_list, c.data.User)</span><br><span class="line">         c.data.UserList = user_list</span><br><span class="line">         dataJson, _ := json.Marshal(c.data)</span><br><span class="line">         h.b &lt;- dataJson</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"user"</span>:</span><br><span class="line">         c.data.Type = <span class="string">"user"</span></span><br><span class="line">         dataJson, _ := json.Marshal(c.data)</span><br><span class="line">         h.b &lt;- dataJson</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"logout"</span>:</span><br><span class="line">         c.data.Type = <span class="string">"logout"</span></span><br><span class="line">         user_list = del(user_list, c.data.User)</span><br><span class="line">         dataJson, _ := json.Marshal(c.data)</span><br><span class="line">         h.b &lt;- dataJson</span><br><span class="line">         h.r &lt;- c</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">         fmt.Print(<span class="string">"========default================"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wu = &amp;websocket.Upgrader&#123;</span><br><span class="line">   ReadBufferSize:  <span class="number">512</span>,</span><br><span class="line">   WriteBufferSize: <span class="number">512</span>,</span><br><span class="line">   CheckOrigin: <span class="function"><span class="keyword">func</span><span class="params">(r *http.Request)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user_list []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除切片s中的指定user数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">del</span><span class="params">(s []<span class="keyword">string</span>, user <span class="keyword">string</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> i, item := <span class="keyword">range</span> s &#123;</span><br><span class="line">      <span class="keyword">if</span> item == user &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">append</span>(s[:i], s[i+<span class="number">1</span>:]...) <span class="comment">// Order matters(如果Order is not important，有更高效的方法)</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myws</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   ws, err := wu.Upgrade(w, r, <span class="literal">nil</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"wu.Upgrade err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   c := &amp;connection&#123;</span><br><span class="line">      ws:   ws,</span><br><span class="line">      sc:   <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="keyword">byte</span>, <span class="number">256</span>),</span><br><span class="line">      data: &amp;Data&#123;&#125;,</span><br><span class="line">   &#125;</span><br><span class="line">   h.r &lt;- c</span><br><span class="line">   <span class="keyword">go</span> c.writer()</span><br><span class="line">   c.reader()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="hubgo"><a class="markdownIt-Anchor" href="#hubgo"></a> hub.go</h3>
<p>编写hub.go代码如下：<code>websocket/hub.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"encoding/json"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> hub <span class="keyword">struct</span> &#123;</span><br><span class="line">   c <span class="keyword">map</span>[*connection]<span class="keyword">bool</span></span><br><span class="line">   b <span class="keyword">chan</span> []<span class="keyword">byte</span></span><br><span class="line">   r <span class="keyword">chan</span> *connection</span><br><span class="line">   u <span class="keyword">chan</span> *connection</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h = hub&#123;</span><br><span class="line">   c: <span class="built_in">make</span>(<span class="keyword">map</span>[*connection]<span class="keyword">bool</span>),</span><br><span class="line">   b: <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="keyword">byte</span>),</span><br><span class="line">   r: <span class="built_in">make</span>(<span class="keyword">chan</span> *connection),</span><br><span class="line">   u: <span class="built_in">make</span>(<span class="keyword">chan</span> *connection),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *hub)</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> c := &lt;-h.r:</span><br><span class="line">         h.c[c] = <span class="literal">true</span></span><br><span class="line">         c.data.Ip = c.ws.RemoteAddr().String()</span><br><span class="line">         c.data.Type = <span class="string">"handshake"</span></span><br><span class="line">         c.data.UserList = user_list</span><br><span class="line">         dataJson, _ := json.Marshal(c.data)</span><br><span class="line">         c.sc &lt;- dataJson</span><br><span class="line">      <span class="keyword">case</span> c := &lt;-h.u:</span><br><span class="line">         <span class="keyword">if</span> _, ok := h.c[c]; ok &#123;</span><br><span class="line">            <span class="built_in">delete</span>(h.c, c)</span><br><span class="line">            <span class="built_in">close</span>(c.sc)</span><br><span class="line">         &#125;</span><br><span class="line">      <span class="keyword">case</span> data := &lt;-h.b:</span><br><span class="line">         <span class="keyword">for</span> c := <span class="keyword">range</span> h.c &#123;</span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> c.sc &lt;- data:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">               <span class="built_in">delete</span>(h.c, c)</span><br><span class="line">               <span class="built_in">close</span>(c.sc)</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="servergo"><a class="markdownIt-Anchor" href="#servergo"></a> server.go</h3>
<p>编写server.go代码如下：<code>websocket/server.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">   <span class="string">"github.com/gorilla/mux"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   router := mux.NewRouter()</span><br><span class="line">   <span class="keyword">go</span> h.run()</span><br><span class="line">   router.HandleFunc(<span class="string">"/ws"</span>, myws)</span><br><span class="line">   err := http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, router)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="localhtml"><a class="markdownIt-Anchor" href="#localhtml"></a> local.html</h3>
<p>local.html代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        p &#123;</span><br><span class="line">            text-align: left;</span><br><span class="line">            padding-left: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 800px;height: 600px;margin: 30px auto;text-align: center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>www.5lmh.comy演示聊天室<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 800px;border: 1px solid gray;height: 300px;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 200px;height: 300px;float: left;text-align: left;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>当前在线:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"user_num"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"user_list"</span> <span class="attr">style</span>=<span class="string">"overflow: auto;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"msg_list"</span> <span class="attr">style</span>=<span class="string">"width: 598px;border:  1px solid gray; height: 300px;overflow: scroll;float: left;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"msg_box"</span> <span class="attr">rows</span>=<span class="string">"6"</span> <span class="attr">cols</span>=<span class="string">"50"</span> <span class="attr">onkeydown</span>=<span class="string">"confirm(event)"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"发送"</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> uname = prompt(<span class="string">'请输入用户名'</span>, <span class="string">'user'</span> + uuid(<span class="number">8</span>, <span class="number">16</span>));</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"ws://127.0.0.1:8080/ws"</span>);</span></span><br><span class="line"><span class="actionscript">    ws.onopen = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> data = <span class="string">"系统消息：建立连接成功"</span>;</span></span><br><span class="line">        listMsg(data);</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="actionscript">    ws.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> msg = <span class="built_in">JSON</span>.parse(e.data);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> sender, user_name, name_list, change_type;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">switch</span> (msg.type) &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="string">'system'</span>:</span></span><br><span class="line"><span class="actionscript">                sender = <span class="string">'系统消息: '</span>;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="string">'user'</span>:</span></span><br><span class="line"><span class="actionscript">                sender = msg.from + <span class="string">': '</span>;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="string">'handshake'</span>:</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">var</span> user_info = &#123;<span class="string">'type'</span>: <span class="string">'login'</span>, <span class="string">'content'</span>: uname&#125;;</span></span><br><span class="line">                sendMsg(user_info);</span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="string">'login'</span>:</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="string">'logout'</span>:</span></span><br><span class="line">                user_name = msg.content;</span><br><span class="line">                name_list = msg.user_list;</span><br><span class="line">                change_type = msg.type;</span><br><span class="line">                dealUser(user_name, change_type, name_list);</span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> data = sender + msg.content;</span></span><br><span class="line">        listMsg(data);</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="actionscript">    ws.onerror = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> data = <span class="string">"系统消息 : 出错了,请退出重试."</span>;</span></span><br><span class="line">        listMsg(data);</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">confirm</span><span class="params">(event)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> key_num = event.keyCode;</span></span><br><span class="line">        if (13 == key_num) &#123;</span><br><span class="line">            send();</span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> msg_box = <span class="built_in">document</span>.getElementById(<span class="string">"msg_box"</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> content = msg_box.value;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"\r\n"</span>, <span class="string">"g"</span>);</span></span><br><span class="line"><span class="actionscript">        content = content.replace(reg, <span class="string">""</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> msg = &#123;<span class="string">'content'</span>: content.trim(), <span class="string">'type'</span>: <span class="string">'user'</span>&#125;;</span></span><br><span class="line">        sendMsg(msg);</span><br><span class="line"><span class="actionscript">        msg_box.value = <span class="string">''</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">listMsg</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> msg_list = <span class="built_in">document</span>.getElementById(<span class="string">"msg_list"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> msg = <span class="built_in">document</span>.createElement(<span class="string">"p"</span>);</span></span><br><span class="line">        msg.innerHTML = data;</span><br><span class="line">        msg_list.appendChild(msg);</span><br><span class="line">        msg_list.scrollTop = msg_list.scrollHeight;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">dealUser</span><span class="params">(user_name, type, name_list)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> user_list = <span class="built_in">document</span>.getElementById(<span class="string">"user_list"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> user_num = <span class="built_in">document</span>.getElementById(<span class="string">"user_num"</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">while</span>(user_list.hasChildNodes()) &#123;</span></span><br><span class="line">            user_list.removeChild(user_list.firstChild);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> name_list) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> user = <span class="built_in">document</span>.createElement(<span class="string">"p"</span>);</span></span><br><span class="line">            user.innerHTML = name_list[index];</span><br><span class="line">            user_list.appendChild(user);</span><br><span class="line">        &#125;</span><br><span class="line">        user_num.innerHTML = name_list.length;</span><br><span class="line">        user_list.scrollTop = user_list.scrollHeight;</span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> change = type == <span class="string">'login'</span> ? <span class="string">'上线'</span> : <span class="string">'下线'</span>;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> data = <span class="string">'系统消息: '</span> + user_name + <span class="string">' 已'</span> + change;</span></span><br><span class="line">        listMsg(data);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">sendMsg</span><span class="params">(msg)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> data = <span class="built_in">JSON</span>.stringify(msg);</span></span><br><span class="line">        ws.send(data);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">uuid</span><span class="params">(len, radix)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> chars = <span class="string">'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span>.split(<span class="string">''</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> uuid = [], i;</span></span><br><span class="line">        radix = radix || chars.length;</span><br><span class="line">        if (len) &#123;</span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) uuid[i] = chars[<span class="number">0</span> | <span class="built_in">Math</span>.random() * radix];</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> r;</span></span><br><span class="line"><span class="actionscript">            uuid[<span class="number">8</span>] = uuid[<span class="number">13</span>] = uuid[<span class="number">18</span>] = uuid[<span class="number">23</span>] = <span class="string">'-'</span>;</span></span><br><span class="line"><span class="actionscript">            uuid[<span class="number">14</span>] = <span class="string">'4'</span>;</span></span><br><span class="line">            for (i = 0; i &lt; 36; i++) &#123;</span><br><span class="line">                if (!uuid[i]) &#123;</span><br><span class="line"><span class="javascript">                    r = <span class="number">0</span> | <span class="built_in">Math</span>.random() * <span class="number">16</span>;</span></span><br><span class="line">                    uuid[i] = chars[(i == 19) ? (r &amp; 0x3) | 0x8 : r];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> uuid.join(<span class="string">''</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行<code>go run websocket/server.go websocket/hub.go websocket/data.go websocket/connection.go</code>，然后在运行local.html文件，结果如下：</p>
<center class="half">
    <img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220518235952.png"/>
    <img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220519000006.png"/>
</center>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220519000110.png" alt="" /></p>
<h1 id="爬虫"><a class="markdownIt-Anchor" href="#爬虫"></a> 爬虫</h1>
<p><strong><a href="https://www.golangroadmap.com/books/gin/20-1.html#%E7%9B%AE%E6%A0%87" target="_blank" rel="noopener">Go爬虫系列</a></strong></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:qingbo1011@163.com">qingbo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.qingbo1011.top/2022/04/25/Golang%E8%BF%9B%E9%98%B601%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">http://www.qingbo1011.top/2022/04/25/Golang%E8%BF%9B%E9%98%B601%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.qingbo1011.top" target="_blank">Qing's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Go/">Go</a><a class="post-meta__tags" href="/tags/WebSocket/">WebSocket</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><a class="post-meta__tags" href="/tags/Socket/">Socket</a><a class="post-meta__tags" href="/tags/HTTP/">HTTP</a></div><div class="post_share"><div class="social-share" data-image="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20231003161115.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2022/04/26/Golang%E8%BF%9B%E9%98%B602%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><img class="prev_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220509153103.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Golang进阶——并发编程</div></div></a></div><div class="next-post pull_right"><a href="/2022/04/24/Golang%E5%9F%BA%E7%A1%8002/"><img class="next_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220509153103.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Golang基础（二）</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2022/05/21/Gin+WebSocket+MongoDB的IM即时聊天Demo/" title="Gin+Websocket+MangoDB实现的IM系统"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-21</div><div class="relatedPosts_title">Gin+Websocket+MangoDB实现的IM系统</div></div></a></div><div class="relatedPosts_item"><a href="/2022/06/26/Gin+Gorm v2+Github Action的实践/" title="Gin+Gorm v2+Github Action的实践"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220808182712.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-26</div><div class="relatedPosts_title">Gin+Gorm v2+Github Action的实践</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/02/Gin+Gorm开发在线备忘录（To do list）/" title="Gin+Gorm开发在线备忘录（To do list）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-02</div><div class="relatedPosts_title">Gin+Gorm开发在线备忘录（To do list）</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/01/Gin+JWT+Air热部署的简单实践/" title="Gin+JWT+Air热部署的简单实践"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-01</div><div class="relatedPosts_title">Gin+JWT+Air热部署的简单实践</div></div></a></div><div class="relatedPosts_item"><a href="/2022/06/12/Gin-blog：go1.18在gin上的实践/" title="Gin-blog：go1.18在gin上的实践"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220525201522.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-12</div><div class="relatedPosts_title">Gin-blog：go1.18在gin上的实践</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/10/Gin限流/" title="Gin限流"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220718144444.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-10</div><div class="relatedPosts_title">Gin限流</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'oNS5Emx1qUL3wN5yvPLKol0W-gzGzoHsz',
  appKey: 'ytbw0ho3DMX0FeoAOWa37lf9',
  notify: false,
  verify: false,
  placeholder: 'Stay hungry,stay foolish~',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: 'https://',
  emojiMaps: {"欢呼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100836.gif","笑眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100849.gif","花心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100907.gif","吐舌":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100937.gif","疑问":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100951.gif","滑稽":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101004.gif","太开心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101017.gif","酷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101029.gif","怒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101044.gif","阴险":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101100.gif","委屈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101116.gif","乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101129.gif","你懂的":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101204.gif","小乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101215.gif","突然兴奋":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101228.gif","喷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101241.gif","哈哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101255.gif","喝酒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101305.gif","汗":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101323.gif","笑尿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102004.gif","嘿嘿嘿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102018.gif","真棒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102047.gif","托腮":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102108.gif","微笑":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e3/2018new_weixioa02_org.png","礼貌":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/09/2018new_keai_org.png","笑哭":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/4a/2018new_xiaoku_thumb.png","无奈":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/83/2018new_kuxiao_org.png","爱你":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f6/2018new_aini_org.png","吃瓜":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/01/2018new_chigua_thumb.png","doge":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a1/2018new_doge02_org.png","dog":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/22/2018new_erha_org.png","cat":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7b/2018new_miaomiao_thumb.png","星星眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102225.png","酸了":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102240.png","大哭":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102254.png","傲娇":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102314.png","给心心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102328.png","嘿哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102345.png","custom0":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101410.gif","custom1":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101424.webp","狗头":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101710.png","搬砖中":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101744.png","忙到飞起":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102411.png","裂开":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102426.png","叹气":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102439.png","让我看看":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102456.png","panda0":"https://bbs.res.meizu.com/static/image/smiley/panda/_000.png","panda1":"https://bbs.res.meizu.com/static/image/smiley/panda/_001.png","panda2":"https://bbs.res.meizu.com/static/image/smiley/panda/_002.png","panda3":"https://bbs.res.meizu.com/static/image/smiley/panda/_003.png","panda4":"https://bbs.res.meizu.com/static/image/smiley/panda/_004.png","panda5":"https://bbs.res.meizu.com/static/image/smiley/panda/_005.png","panda6":"https://bbs.res.meizu.com/static/image/smiley/panda/_006.png","panda7":"https://bbs.res.meizu.com/static/image/smiley/panda/_007.png","panda8":"https://bbs.res.meizu.com/static/image/smiley/panda/_008.png","panda9":"https://bbs.res.meizu.com/static/image/smiley/panda/_009.png","panda10":"https://bbs.res.meizu.com/static/image/smiley/panda/_010.png","panda11":"https://bbs.res.meizu.com/static/image/smiley/panda/_011.png","panda12":"https://bbs.res.meizu.com/static/image/smiley/panda/_012.png","panda13":"https://bbs.res.meizu.com/static/image/smiley/panda/_013.png","panda14":"https://bbs.res.meizu.com/static/image/smiley/panda/_014.png","panda15":"https://bbs.res.meizu.com/static/image/smiley/panda/_015.png","panda16":"https://bbs.res.meizu.com/static/image/smiley/panda/_016.png","panda17":"https://bbs.res.meizu.com/static/image/smiley/panda/_017.png","panda18":"https://bbs.res.meizu.com/static/image/smiley/panda/_018.png","panda19":"https://bbs.res.meizu.com/static/image/smiley/panda/_019.png","panda20":"https://bbs.res.meizu.com/static/image/smiley/panda/_020.png","panda21":"https://bbs.res.meizu.com/static/image/smiley/panda/_021.png","panda22":"https://bbs.res.meizu.com/static/image/smiley/panda/_022.png","panda23":"https://bbs.res.meizu.com/static/image/smiley/panda/_023.png","panda24":"https://bbs.res.meizu.com/static/image/smiley/panda/_024.png","panda25":"https://bbs.res.meizu.com/static/image/smiley/panda/_025.png","panda26":"https://bbs.res.meizu.com/static/image/smiley/panda/_026.png","panda27":"https://bbs.res.meizu.com/static/image/smiley/panda/_027.png","panda28":"https://bbs.res.meizu.com/static/image/smiley/panda/_028.png","panda29":"https://bbs.res.meizu.com/static/image/smiley/panda/_029.png"},
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220509153103.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By qingbo</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">宇宙很大，生活更大</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>
<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mybatis（三） | Qing's Blog</title><meta name="description" content="Mybatis（三）  Mybatis中的连接池以及事务控制（了解原理，会用）  Mybatis中连接池使用及分析 Mybatis事务控制的分析   Mybatis基于XML配置的动态SQL语句（会用即可）  mappers配置文件中的几个标签：&lt;if&gt;，&lt;where&gt;，&lt;foreach&gt;，&lt;sql&gt;   Mybatis中的多表操作  一对一（多对"><meta name="keywords" content="Mybatis笔记"><meta name="author" content="qingbo,qingbo1011@163.com"><meta name="copyright" content="qingbo"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Mybatis（三）"><meta name="twitter:description" content="Mybatis（三）  Mybatis中的连接池以及事务控制（了解原理，会用）  Mybatis中连接池使用及分析 Mybatis事务控制的分析   Mybatis基于XML配置的动态SQL语句（会用即可）  mappers配置文件中的几个标签：&lt;if&gt;，&lt;where&gt;，&lt;foreach&gt;，&lt;sql&gt;   Mybatis中的多表操作  一对一（多对"><meta name="twitter:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png"><meta property="og:type" content="article"><meta property="og:title" content="Mybatis（三）"><meta property="og:url" content="http://www.qingbo1011.top/2021/05/08/Mybatis03/"><meta property="og:site_name" content="Qing's Blog"><meta property="og:description" content="Mybatis（三）  Mybatis中的连接池以及事务控制（了解原理，会用）  Mybatis中连接池使用及分析 Mybatis事务控制的分析   Mybatis基于XML配置的动态SQL语句（会用即可）  mappers配置文件中的几个标签：&lt;if&gt;，&lt;where&gt;，&lt;foreach&gt;，&lt;sql&gt;   Mybatis中的多表操作  一对一（多对"><meta property="og:image" content="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png"><meta property="article:published_time" content="2021-05-08T00:47:03.000Z"><meta property="article:modified_time" content="2023-10-03T08:16:11.785Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://www.qingbo1011.top/2021/05/08/Mybatis03/"><link rel="prev" title="Mybatis（四）" href="http://www.qingbo1011.top/2021/05/10/Mybatis04/"><link rel="next" title="Mybatis（二）" href="http://www.qingbo1011.top/2021/04/30/Mybatis02/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220501212415.jpg" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230440.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">87</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">81</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mybatis三"><span class="toc-number">1.</span> <span class="toc-text"> Mybatis（三）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mybatis中的连接池以及事务控制"><span class="toc-number">2.</span> <span class="toc-text"> Mybatis中的连接池以及事务控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mybatis连接池技术"><span class="toc-number">2.1.</span> <span class="toc-text"> Mybatis连接池技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis中的连接池"><span class="toc-number">2.1.1.</span> <span class="toc-text"> Mybatis中的连接池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis中使用unpooled配置连接池的原理分析"><span class="toc-number">2.1.2.</span> <span class="toc-text"> Mybatis中使用unpooled配置连接池的原理分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis中使用pooled配置连接池的原理分析"><span class="toc-number">2.1.3.</span> <span class="toc-text"> Mybatis中使用pooled配置连接池的原理分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis中使用jndi配置连接池的原理分析"><span class="toc-number">2.1.4.</span> <span class="toc-text"> Mybatis中使用JNDI配置连接池的原理分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mybatis中的事务原理和自动提交设置"><span class="toc-number">2.2.</span> <span class="toc-text"> Mybatis中的事务原理和自动提交设置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mybatis的动态sql语句"><span class="toc-number">3.</span> <span class="toc-text"> Mybatis的动态SQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#动态sql之if标签"><span class="toc-number">3.1.</span> <span class="toc-text"> 动态SQL之&lt;if&gt;标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态sql之where标签"><span class="toc-number">3.2.</span> <span class="toc-text"> 动态SQL之&lt;where&gt;标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态sql之foreach标签"><span class="toc-number">3.3.</span> <span class="toc-text"> 动态SQL之&lt;foreach&gt;标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态sql之sql标签"><span class="toc-number">3.4.</span> <span class="toc-text"> 动态SQL之&lt;sql&gt;标签</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mybatis多表查询"><span class="toc-number">4.</span> <span class="toc-text"> Mybatis多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mybatis多表查询之一对一查询多对一"><span class="toc-number">4.1.</span> <span class="toc-text"> Mybatis多表查询之一对一查询（多对一）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方法一"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 方法一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方式二"><span class="toc-number">4.1.2.</span> <span class="toc-text"> 方式二</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mybatis多表查询之一对多查询"><span class="toc-number">4.2.</span> <span class="toc-text"> Mybatis多表查询之一对多查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mybatis多表查询之多对多查询"><span class="toc-number">4.3.</span> <span class="toc-text"> Mybatis多表查询之多对多查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查询角色同时得到角色的所赋予的用户信息"><span class="toc-number">4.3.1.</span> <span class="toc-text"> 查询角色同时得到角色的所赋予的用户信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询用户同时得到用户所包含的角色信息"><span class="toc-number">4.3.2.</span> <span class="toc-text"> 查询用户同时得到用户所包含的角色信息</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Qing's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Mybatis（三）</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-05-08 08:47:03"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-05-08</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2023-10-03 16:16:11"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2023-10-03</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SSM/">SSM</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">8.2k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 30 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2021/05/08/Mybatis03/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2021/05/08/Mybatis03/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="mybatis三"><a class="markdownIt-Anchor" href="#mybatis三"></a> Mybatis（三）</h1>
<ul>
<li>Mybatis中的连接池以及事务控制（了解原理，会用）
<ul>
<li>Mybatis中连接池使用及分析</li>
<li>Mybatis事务控制的分析</li>
</ul>
</li>
<li>Mybatis基于XML配置的动态SQL语句（会用即可）
<ul>
<li>mappers配置文件中的几个标签：<code>&lt;if&gt;</code>，<code>&lt;where&gt;</code>，<code>&lt;foreach&gt;</code>，<code>&lt;sql&gt;</code></li>
</ul>
</li>
<li><strong><mark>Mybatis中的多表操作</mark></strong>
<ul>
<li>一对一（多对一）</li>
<li>一对多</li>
<li>多对多</li>
</ul>
</li>
</ul>
<h1 id="mybatis中的连接池以及事务控制"><a class="markdownIt-Anchor" href="#mybatis中的连接池以及事务控制"></a> Mybatis中的连接池以及事务控制</h1>
<ul>
<li>Mybatis连接池技术</li>
<li>Mybatis事务控制</li>
</ul>
<h2 id="mybatis连接池技术"><a class="markdownIt-Anchor" href="#mybatis连接池技术"></a> Mybatis连接池技术</h2>
<blockquote>
<p>我们在前面的 WEB 学习中我们已经接触过过类似的连接池技术（<a href="https://www.qingbo1011.top/2021/03/28/JDBC%EF%BC%88%E4%BA%8C%EF%BC%89/#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0">数据库连接池笔记</a>），而在 Mybatis 中也有连接池技术，但是它采用的是自的连接池技术。在 Mybatis 的 <strong>SqlMapConfig.xml 配置文件</strong>中，通过<code>&lt;dataSource type=&quot;pooled&quot;&gt;</code>来实现 Mybatis 中连接池的配置。（<a href="https://mybatis.org/mybatis-3/zh/configuration.html#environments" target="_blank" rel="noopener">环境配置（environments）</a>）</p>
</blockquote>
<p>我们在实际开发中都会使用连接池，它可以减少我们获取连接所消耗的时间</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505112700.png" alt="连接池介绍" /></p>
<p><a href="https://www.bilibili.com/video/BV1mE411X7yp?p=40" target="_blank" rel="noopener">视频讲解</a></p>
<h3 id="mybatis中的连接池"><a class="markdownIt-Anchor" href="#mybatis中的连接池"></a> Mybatis中的连接池</h3>
<p><strong><a href="https://mybatis.org/mybatis-3/zh/configuration.html#environments" target="_blank" rel="noopener">数据源（dataSource）</a></strong></p>
<p>Mybatis连接池提供了3种方式的配置。</p>
<p><strong>主配置文件SqlMapConfig.xml</strong>中的**<code>dataSource</code>标签**，<strong>type属性</strong>就是表示采用何种连接池方式。如：<code>&lt;dataSource type=&quot;POOLED&quot;&gt;</code></p>
<p><strong>type属性</strong>的取值：</p>
<ul>
<li><strong><code>POOLED</code>：采用传统的javax.sql.DataSource规范中的连接池，mybatis中有针对规范的实现</strong></li>
<li><code>UNPOOLED</code>：采用传统的获取连接的方式，虽然也实现Javax.sql.DataSource接口，但是并没有使用池的思想</li>
<li><code>JNDI</code>：采用服务器提供的JNDI技术实现，来获取DataSource对象，不同的服务器所能拿到DataSource是不一样</li>
</ul>
<p>注意：<strong>如果不是web或者maven的war工程，是不能使用的</strong>。（我们学习时使用的是tomcat服务器，采用连接池是dbcp连接池）</p>
<p>例子：在之前的学习中，我们的SqlMapConfig.xml文件中的相关配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置连接数据库的四个基本信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>MyBatis 在初始化时，根据<code>&lt;dataSource&gt;</code>的 type 属性来创建相应类型的的数据源 DataSource</strong>，即：</p>
<p>type=”POOLED”：MyBatis 会创建 PooledDataSource 实例</p>
<p>type=”UNPOOLED” ： MyBatis 会创建 UnpooledDataSource 实例</p>
<p>type=”JNDI”：MyBatis 会从 JNDI 服务上查找 DataSource 实例，然后返回使用</p>
</blockquote>
<p>这里我们就只介绍一下POOLED和UNPOOLED，JNDI可以自行查看。<strong><mark>在后续开发中使用更多的还是POOLED</mark></strong></p>
<h3 id="mybatis中使用unpooled配置连接池的原理分析"><a class="markdownIt-Anchor" href="#mybatis中使用unpooled配置连接池的原理分析"></a> Mybatis中使用unpooled配置连接池的原理分析</h3>
<blockquote>
<p><strong>UNPOOLED</strong>– 这个数据源的实现会<strong>每次请求时打开和关闭连接</strong>。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：</p>
<ul>
<li><code>driver</code> – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）</li>
<li><code>url</code> – 这是数据库的 JDBC URL 地址</li>
<li><code>username</code> – 登录数据库的用户名</li>
<li><code>password</code> – 登录数据库的密码</li>
<li><code>defaultTransactionIsolationLevel</code> – 默认的连接事务隔离级别</li>
<li><code>defaultNetworkTimeout</code> – 等待数据库操作完成的默认网络超时时间（单位：毫秒）</li>
</ul>
<p>作为可选项，你也可以传递属性给数据库驱动。只需在属性名加上“driver.”前缀即可，例如：</p>
<ul>
<li><code>driver.encoding=UTF8</code></li>
</ul>
<p>这将通过 DriverManager.getConnection(url, driverProperties) 方法传递值为 <code>UTF8</code> 的 <code>encoding</code> 属性给数据库驱动。</p>
</blockquote>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505112713.png" alt="UNPOOLED和UNPOOLED分析" /></p>
<p>（<a href="https://www.bilibili.com/video/BV1mE411X7yp?p=42" target="_blank" rel="noopener">视频讲解</a>）</p>
<h3 id="mybatis中使用pooled配置连接池的原理分析"><a class="markdownIt-Anchor" href="#mybatis中使用pooled配置连接池的原理分析"></a> Mybatis中使用pooled配置连接池的原理分析</h3>
<blockquote>
<p><strong>POOLED</strong>– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。</p>
<p><strong>除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源：      （<mark>UNPOOLED 的属性POOLED也有</mark> ）</strong></p>
<ul>
<li><code>poolMaximumActiveConnections</code> – 在任意时间可存在的活动（正在使用）连接数量，默认值：10</li>
<li><code>poolMaximumIdleConnections</code> – 任意时间可能存在的空闲连接数</li>
<li><code>poolMaximumCheckoutTime</code> – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）</li>
<li><code>poolTimeToWait</code> – 这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）</li>
<li><code>poolMaximumLocalBadConnectionTolerance</code> – 这是一个关于坏连接容忍度的底层设置， 作用于每一个尝试从缓存池获取连接的线程。 如果这个线程获取到的是一个坏的连接，那么这个数据源允许这个线程尝试重新获取一个新的连接，但是这个重新尝试的次数不应该超过 <code>poolMaximumIdleConnections</code> 与 <code>poolMaximumLocalBadConnectionTolerance</code> 之和。 默认值：3（新增于 3.4.5）</li>
<li><code>poolPingQuery</code> – 发送到数据库的侦测查询，用来检验连接是否正常工作并准备接受请求。默认是“NO PING QUERY SET”，这会导致多数数据库驱动出错时返回恰当的错误消息</li>
<li><code>poolPingEnabled</code> – 是否启用侦测查询。若开启，需要设置 <code>poolPingQuery</code> 属性为一个可执行的 SQL 语句（最好是一个速度非常快的 SQL 语句），默认值：false</li>
<li><code>poolPingConnectionsNotUsedFor</code> – 配置 poolPingQuery 的频率。可以被设置为和数据库连接超时时间一样，来避免不必要的侦测，默认值：0（即所有连接每一时刻都被侦测 — 当然仅当 poolPingEnabled 为 true 时适用）</li>
</ul>
</blockquote>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505112724.jpg" alt="" /></p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505112846.png" alt="mybatis_pooled的过程" /></p>
<p>（<a href="https://www.bilibili.com/video/BV1mE411X7yp?p=43" target="_blank" rel="noopener">视频讲解</a>）</p>
<h3 id="mybatis中使用jndi配置连接池的原理分析"><a class="markdownIt-Anchor" href="#mybatis中使用jndi配置连接池的原理分析"></a> Mybatis中使用JNDI配置连接池的原理分析</h3>
<blockquote>
<p>JNDI是 Java 命名与目录接口（Java Naming and Directory Interface），在J2EE规范中是重要的规范之一，不少专家认为，没有透彻理解JNDI的意义和作用，就没有真正掌握J2EE特别是EJB的知识。</p>
</blockquote>
<p><a href="https://www.cnblogs.com/study-everyday/p/6723313.html" target="_blank" rel="noopener">JNDI是什么，怎么理解</a></p>
<p>（<a href="https://www.bilibili.com/video/BV1mE411X7yp?p=57" target="_blank" rel="noopener">视频讲解</a>）</p>
<h2 id="mybatis中的事务原理和自动提交设置"><a class="markdownIt-Anchor" href="#mybatis中的事务原理和自动提交设置"></a> Mybatis中的事务原理和自动提交设置</h2>
<p>在之前MySQL的笔记中我们已经接触过<a href="https://www.qingbo1011.top/2021/03/17/MySQL%EF%BC%88%E5%9B%9B%EF%BC%89/#%E4%BA%8B%E5%8A%A1">事务</a>了，这里我们可以根据之前的笔记再去了解一下：事务的四大特性、不考虑隔离性会产生的3个问题以及解决办法（四种隔离级别），它是通过sqlsession对象的<code>commit</code>方法和<code>rollback</code>方法实现事务的提交和回滚</p>
<p><a href="https://mybatis.org/mybatis-3/zh/configuration.html#environments" target="_blank" rel="noopener">事务管理器（transactionManager）</a></p>
<blockquote>
<p>在SQLMapConfig中配置事务管理的是<code>&lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;</code></p>
<p>在 MyBatis 中有两种类型的事务管理器（即type有两种取值）：</p>
<ul>
<li>
<p>JDBC – <strong>这个配置直接使用了 JDBC 的提交和回滚设施，它依赖从数据源获得的连接来管理事务作用域</strong></p>
</li>
<li>
<p>MANAGED – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 <strong>默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为</strong>。例如:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"MANAGED"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"closeConnection"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>提示</strong>：如果你正在**<mark>使用 Spring + MyBatis，则没有必要配置事务管理器</mark>**，因为 <strong>Spring 模块会使用自带的管理器来覆盖前面的配置。</strong></p>
</blockquote>
<p>在我们之前的之前的<a href="https://www.qingbo1011.top/2021/04/30/Mybatis02/#mybatis%E5%9F%BA%E4%BA%8E%E4%BB%A3%E7%90%86dao%E7%9A%84crud%E6%93%8D%E4%BD%9C">增删改操作</a>过程中，我们<strong>都要手动进行事务的提交，即要写上<code>session.commit();</code></strong>。原因是 <code>setAutoCommit()</code>方法，在执行时它的值被设置为 false 了，所以我们在增删改操作中，必须通过 <code>sqlSession.commit()</code>方法来执行提交操作。</p>
<p>想要设置事务的自动提交其实非常简单，只需要**将原来的<code>session = factory.openSession();</code>代码改成<code>session = factory.openSession(true);</code>**即可。</p>
<p>（<a href="https://www.bilibili.com/video/BV1mE411X7yp?p=44" target="_blank" rel="noopener">视频讲解</a>）</p>
<hr />
<h1 id="mybatis的动态sql语句"><a class="markdownIt-Anchor" href="#mybatis的动态sql语句"></a> Mybatis的动态SQL语句</h1>
<p>官网：<a href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html" target="_blank" rel="noopener">动态 SQL</a></p>
<p>W3C教程：<a href="https://www.w3cschool.cn/mybatis/l5cx1ilz.html" target="_blank" rel="noopener">MyBatis 动态SQL</a></p>
<blockquote>
<p>动态 SQL 是 MyBatis 的强大特性之一。如果你<strong>使用过 JDBC 或其它类似的框架，你应该能理解根据不同条件拼接 SQL 语句有多痛苦，例如拼接时要确保不能忘记添加必要的空格，还要注意去掉列表最后一个列名的逗号</strong>（在之前的<a href="https://www.qingbo1011.top/2021/04/21/Maven%E9%A1%B9%E7%9B%AE/">Maven项目之黑马旅游网</a>中，我们就用到了sql拼接）。利用动态 SQL，可以彻底摆脱这种痛苦。</p>
<p>使用动态 SQL 并非一件易事，但借助可用于任何 SQL 映射语句中的强大的动态 SQL 语言，MyBatis 显著地提升了这一特性的易用性。</p>
</blockquote>
<p>借助功能强大的基于 OGNL 的表达式，MyBatis 3 替换了之前的大部分元素，大大精简了元素种类，现在要学习的元素种类比原来的一半还要少：</p>
<ul>
<li><strong><code>&lt;if&gt;</code></strong></li>
<li><strong><code>&lt;choose&gt;</code> (<code>&lt;when&gt;</code>, <code>&lt;otherwise&gt;</code>)</strong></li>
<li><strong><code>&lt;trim&gt;</code> (<code>&lt;where&gt;</code>, <code>&lt;set&gt;</code>)</strong></li>
<li><strong><code>&lt;foreach&gt;</code></strong></li>
</ul>
<h2 id="动态sql之if标签"><a class="markdownIt-Anchor" href="#动态sql之if标签"></a> 动态SQL之<code>&lt;if&gt;</code>标签</h2>
<p>官网：<a href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html" target="_blank" rel="noopener">if</a></p>
<blockquote>
<p>我们根据实体类的不同取值，使用不同的 SQL 语句来进行查询。比如在 id 如果不为空时可以根据 id 查询，如果 username 不同空时还要加入用户名作为条件。这种情况在我们的多条件组合查询中经常会碰到（在之前的<a href="https://www.qingbo1011.top/2021/04/21/Maven%E9%A1%B9%E7%9B%AE/">Maven项目之黑马旅游网</a>中，我们就这样使用过了，即客户端想服务端传递cid和cname两个参数，cname可能为空（即用户没有搜索））</p>
</blockquote>
<p>举个例子，我们要写一个根据条件查询的接口，条件有可能是用户名，有可能是性别，或者都有。在以前我们可能需要用到SQL拼接，但是现在我们只需要借助Mybatis的动态SQL之**<code>&lt;if&gt;</code>标签**就可以完成。</p>
<p>首先在持久层接口（UserDao）添加代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据传入的条件查询用户</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 查询的条件，有可能是用户名，有可能是性别,或者都有</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findByCondition</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后在映射配置文件（UserDao.xml）中添加代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据条件查询用户--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">resultType</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">    select * from user where 1 = 1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null and username != '' "</span>&gt;</span></span><br><span class="line">       and username like #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex != null and sex != '' "</span>&gt;</span></span><br><span class="line">        and sex = #&#123;sex&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<strong><code>&lt;if&gt;</code>标签的 test 属性中写的是对象的属性名</strong>，如果是包装类的对象要使用 OGNL 表达式的写法</p>
</blockquote>
<p>最后在测试类中（执行代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByCondition</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    User user1 = <span class="keyword">new</span> User();</span><br><span class="line">    User user2 = <span class="keyword">new</span> User();</span><br><span class="line">    user1.setUsername(<span class="string">"%王%"</span>);</span><br><span class="line">    user2.setUsername(<span class="string">"%王%"</span>);</span><br><span class="line">    user2.setSex(<span class="string">"男"</span>);</span><br><span class="line">    <span class="comment">// 使用useDao代理对象执行方法</span></span><br><span class="line">    List&lt;User&gt; users1 = userDao.findByCondition(user1);</span><br><span class="line">    List&lt;User&gt; users2 = userDao.findByCondition(user2);</span><br><span class="line">    System.out.println(<span class="string">"users1结果为："</span>);</span><br><span class="line">    <span class="keyword">for</span> (User user : users1) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"users2结果为："</span>);</span><br><span class="line">    <span class="keyword">for</span> (User user : users2) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505112858.png" alt="" /></p>
<h2 id="动态sql之where标签"><a class="markdownIt-Anchor" href="#动态sql之where标签"></a> 动态SQL之<code>&lt;where&gt;</code>标签</h2>
<p>官网：<a href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html" target="_blank" rel="noopener">trim、where、set</a></p>
<p>为了简化上面 where 1=1 的条件拼装，我们可以采用<code>&lt;where&gt;</code>标签来简化开发。</p>
<p>还是上面的例子，只不过这次我们使用<code>&lt;where&gt;</code>标签</p>
<p>只需要将映射配置文件（UserDao.xml）中添加修改如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据条件查询用户--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">resultType</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null and username != '' "</span>&gt;</span></span><br><span class="line">            and username like #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex != null and sex != '' "</span>&gt;</span></span><br><span class="line">            and sex = #&#123;sex&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>结果和上面是一样的：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505112941.png" alt="" /></p>
<h2 id="动态sql之foreach标签"><a class="markdownIt-Anchor" href="#动态sql之foreach标签"></a> 动态SQL之<code>&lt;foreach&gt;</code>标签</h2>
<p>动态 SQL 的另一个常见使用场景是对集合进行遍历（尤其是在<strong>构建 IN 条件语句的时候</strong>）</p>
<blockquote>
<p>需求：传入多个 id 查询用户信息，用下边两个 sql 实现：</p>
<p><code>SELECT * FROM USERS WHERE username LIKE '%张%' AND (id =10 OR id =89 OR id=16)</code></p>
<p><code>SELECT * FROM USERS WHERE username LIKE '%张%' AND id IN (10,89,16)</code></p>
<p>这样我们在进行范围查询时，就要将一个集合中的值，作为参数动态添加进来。</p>
<p>这样我们将如何进行参数的传递？</p>
</blockquote>
<p>这种情况就需要使用<code>&lt;foreach&gt;</code>标签了</p>
<p>首先在QueryVo类中添加属性<code>private List&lt;Integer&gt; ids;</code></p>
<p>首先在持久层接口（UserDao）添加代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据QueryVo中提供的id集合，查询用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findUserInIds</span><span class="params">(QueryVo vo)</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后在映射配置文件（UserDao.xml）中添加代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--据QueryVo中提供的id集合，查询用户信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserInIds"</span> <span class="attr">resultType</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size() &gt; 0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">open</span>=<span class="string">" id in ("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">item</span>=<span class="string">"uid"</span> <span class="attr">index</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">                #&#123;uid&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里我们要执行的语句的SQL 语句为：<code>select id from user where id in (?)</code>。而<code>&lt;foreach&gt;</code>标签内的相关语句就是为了拼接sql语句中select * from user后面的内容</p>
<p><code>&lt;foreach&gt;</code>标签用于遍历集合，它的属性有：</p>
<ul>
<li><strong>collection：代表要遍历的集合元素</strong>，注意<strong>编写时不要写#{}</strong>（这里我们要遍历QueryVo对象中的属性ids（一个List集合），所以写ids）</li>
<li><strong>open：代表语句的开始部分</strong>（这里我们以 <code>id in (</code>作为开头）</li>
<li><strong>close：代表结束部分</strong>（这里我们以<code>)</code>结尾）</li>
<li><strong>item：代表遍历集合的每个元素，生成的变量名</strong>（这里我们取名uid，所以在<code>&lt;foreach&gt;</code>标签里写上<code>#{uid}</code>）</li>
<li><strong>sperator：代表分隔符</strong>（这里我们以<code>,</code>作为分隔符）</li>
</ul>
<p><code>foreach</code>标签的功能非常强大，它允许你指定一个集合，声明可以在元素体内使用的**集合项（item）<strong>和</strong>索引（index）**变量。它也允许你指定开头与结尾的字符串以及集合项迭代之间的分隔符。这个元素也不会错误地添加多余的分隔符</p>
<p><strong>提示</strong>： 你可以将任何可迭代对象（如 List、Set 等）、Map 对象或者数组对象作为集合参数传递给 <code>foreach</code></p>
<ul>
<li><strong>当使用可迭代对象或者数组时，index 是当前迭代的序号，item 的值是本次迭代获取到的元素</strong></li>
<li><strong>当使用 Map 对象（或者 Map.Entry 对象的集合）时，index 是键，item 是值</strong></li>
</ul>
</blockquote>
<p>最后在测试类中（执行代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserInIds</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    QueryVo queryVo = <span class="keyword">new</span> QueryVo();</span><br><span class="line">    List&lt;Integer&gt; ids = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    ids.add(<span class="number">43</span>);</span><br><span class="line">    ids.add(<span class="number">46</span>);</span><br><span class="line">    ids.add(<span class="number">48</span>);</span><br><span class="line">    queryVo.setIds(ids);</span><br><span class="line">   <span class="comment">// 使用useDao代理对象执行方法</span></span><br><span class="line">    List&lt;User&gt; users = userDao.findUserInIds(queryVo);</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505112953.png" alt="" /></p>
<h2 id="动态sql之sql标签"><a class="markdownIt-Anchor" href="#动态sql之sql标签"></a> 动态SQL之<code>&lt;sql&gt;</code>标签</h2>
<p>在映射配置文件（User.xml）中，可以发先有一些重复的sql。可以<strong>利用<code>&lt;sql&gt;</code>标签将重复的 sql 提取出来，使用时用 <code>&lt;include&gt;</code>标签 引用即可</strong>，最终达到 sql 重用的目的。</p>
<p>例子：在映射配置文件中修改如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"defaultSql"</span>&gt;</span></span><br><span class="line">  		 select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置查询所有结果--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"defaultSql"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">       <span class="comment">&lt;!--据QueryVo中提供的id集合，查询用户信息--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserInIds"</span> <span class="attr">resultType</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"defaultSql"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size() &gt; 0"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">open</span>=<span class="string">" id in ("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">item</span>=<span class="string">"uid"</span> <span class="attr">index</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">                   #&#123;uid&#125;</span><br><span class="line">               <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中<code>&lt;sql&gt;</code>标签的<strong>id</strong>属性和<code>&lt;include&gt;</code>标签的<strong>refid</strong>属性很容易就可以看出是什么作用。</p>
<hr />
<h1 id="mybatis多表查询"><a class="markdownIt-Anchor" href="#mybatis多表查询"></a> <mark>Mybatis多表查询</mark></h1>
<p>（<a href="https://www.bilibili.com/video/BV1mE411X7yp?p=48" target="_blank" rel="noopener">视频讲解</a>）</p>
<p>关于数据库中的表与表之间的关系我们在之前的<a href="https://www.qingbo1011.top/2021/03/14/MySQL%EF%BC%88%E4%BA%8C%EF%BC%89/#%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><strong>笔记</strong></a>中已经提到过了，这里我再简单提一下：</p>
<p>表之间的关系：</p>
<ul>
<li>一对多</li>
<li>多对一</li>
<li>一对一</li>
<li>多对多</li>
</ul>
<p>举例：</p>
<ul>
<li>用户和订单就是一对多（一个用户可以下多个订单）</li>
<li>订单和用户就是多对一（多个订单属于同一个用户）</li>
<li>人和身份证号就是一对一（一个人只能有一个身份证号，一个身份证号只能属于一个人）</li>
<li>老师和学生之间就是多对多（一个学生可以被多个老师教过，一个老师可以交多个学生）</li>
</ul>
<p>注意：我们拿出每一个订单，都只能属于一个用户，所以**<mark>Mybatis就把多对一看成了一对一</mark>**</p>
<h2 id="mybatis多表查询之一对一查询多对一"><a class="markdownIt-Anchor" href="#mybatis多表查询之一对一查询多对一"></a> Mybatis多表查询之一对一查询（多对一）</h2>
<blockquote>
<p>本次案例主要以最为简单的用户和账户的模型来分析 Mybatis 多表关系。用户为 user 表，账户为account表。<strong>一个用户（User）可以有多个账户（Account）</strong>。具体关系如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113004.png" alt="" /></p>
</blockquote>
<ul>
<li>一个用户可以有多个账户</li>
<li>一个账户只能属于一个用户（多个账户也可以属于同一个用户）</li>
</ul>
<p>步骤：</p>
<ol>
<li>建立两张表：用户表，账户表。让用户表和账户表之间具备一对多的关系：需要在账户表中添加外键</li>
<li>建立两个实体类：用户实体类和账户实体类。让用户和账户的实体类能体现出来一对多的关系（即用户实体类中要有一个账户实体类集合的属性）</li>
<li>建立两个映射配置文件：
<ul>
<li>用户的配置文件（UserDao.xml）</li>
<li>账户的配置文件（AccountDao.xml）</li>
</ul>
</li>
<li>实现配置：
<ul>
<li>当我们查询用户时，可以同时得到用户下所包含的账户信息</li>
<li>当我们查询账户时，可以同时得到账户的所属用户信息</li>
</ul>
</li>
</ol>
<blockquote>
<p>需求：<strong>查询所有账户信息，关联查询下单用户信息（多表查询）</strong></p>
<p>注意：因为<strong>一个账户信息只能供某个用户使用，所以从查询账户信息出发关联查询用户信息为一对一查询</strong>。如果从用户信息出发查询用户下的账户信息则为一对多查询，因为一个用户可以有多个账户。</p>
</blockquote>
<ul>
<li>方法一：<strong>定义专门的PO类作为输出类型</strong>，其中定义了 sql 查询结果集所有的字段（此方法较为简单，企业中使用普遍</li>
<li>方法二：使用 <strong>resultMap</strong>，定义专门的 resultMap 用于映射一对一查询结果</li>
</ul>
<h3 id="方法一"><a class="markdownIt-Anchor" href="#方法一"></a> 方法一</h3>
<p><strong>定义专门的PO类作为输出类型</strong>，其中定义了 sql 查询结果集所有的字段（此方法较为简单，企业中使用普遍)</p>
<p>首先定义账户信息的实体类Account，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.qing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ID;</span><br><span class="line">    <span class="keyword">private</span> Integer UID;</span><br><span class="line">    <span class="keyword">private</span> Double MONEY;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们要查询账户信息以及账户信息所对应的用户信息（用户信息中不需要id，因为id就是account表中的uid，同时为了方便打印我们也去掉birthday信息），SQL语句中是这样的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        account.*,user.username,<span class="string">`user`</span>.sex,user.address</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        <span class="keyword">account</span>,<span class="keyword">user</span></span><br><span class="line">        <span class="keyword">WHERE</span> account.uid = user.id</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113015.png" alt="" /></p>
<p>接下来我们要<strong>定义一个PO类AccountUser，用于封装上面 SQL 语句的查询结果</strong>。由于<strong>结果中既包含账户信息同时还要包含用户信息，所以我们要在定义AccountUser类时可以继承 Account类</strong>（因为Account类的所有属性都要封装到结果，而User类中只是部分属性）。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.qing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountUser</span> <span class="keyword">extends</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString() +  <span class="string">"    AccountUser&#123;"</span> +</span><br><span class="line">                <span class="string">"username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先在持久层接口添加代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有账户信息,同时还要获取当前账户所属用户的相关信息（多表查询）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;AccountUser&gt; <span class="title">findAllAccount</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后在映射配置文件中添加代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查询所有账户信息,同时还要获取当前账户所属用户的相关信息，除去id和birthday（多表查询）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllAccount"</span> <span class="attr">resultType</span>=<span class="string">"top.qing.domain.AccountUser"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    account.*,user.username,`user`.sex,user.address</span><br><span class="line">    FROM</span><br><span class="line">        account,user</span><br><span class="line">    WHERE account.uid = user.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后在测试类中（执行代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意别忘了init()方法和destroy()方法</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAllAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用代理对象accountDao执行查询所有方法</span></span><br><span class="line">    List&lt;AccountUser&gt; allAccount = accountDao.findAllAccount();</span><br><span class="line">    <span class="keyword">for</span> (AccountUser accountUser : allAccount) &#123;</span><br><span class="line">        System.out.println(accountUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113025.png" alt="" /></p>
<h3 id="方式二"><a class="markdownIt-Anchor" href="#方式二"></a> 方式二</h3>
<p>使用<strong>resultMap</strong>，<strong>定义专门的resultMap 用于映射一对一查询结果</strong></p>
<p>首先修改Account类，在Account类中添加一个User类的对象作为属性，修改后的Account类代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.qing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer ID;</span><br><span class="line">    <span class="keyword">private</span> Integer UID;</span><br><span class="line">    <span class="keyword">private</span> Double MONEY;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多对一（一对一）关系映射</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们修改findAll()方法，在持久层接口（UserDao）修改代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有账户信息(包括账户所对应的用户的信息)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后在映射配置文件（UserDao.xml）中添加代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义封装account和user的resultMap--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"accountUserMap"</span> <span class="attr">type</span>=<span class="string">"top.qing.domain.Account"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--主键字段的对应--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"ID"</span> <span class="attr">column</span>=<span class="string">"aid"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--非主键字段的对应--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"UID"</span> <span class="attr">column</span>=<span class="string">"UID"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"MONEY"</span> <span class="attr">column</span>=<span class="string">"MONEY"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一的关系映射，配置封装user的内容--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;association&gt;标签：一个复杂类型的关联，许多结果将包装成这种类型--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--简单地说，用于指定从表的应用实体（这里当然就是user）的属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--查询所有账户信息(包括账户所对应的用户的信息)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"accountUserMap"</span>&gt;</span></span><br><span class="line">   select u.*,a.id as aid,a.uid,a.money from account a,user u where a.uid =u.id;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><mark><strong>注意</strong></mark>：**这里的<code>&lt;association&gt;</code>标签下的<code>&lt;id property=&quot;id&quot; column=&quot;id&quot;&gt;&lt;/id&gt;</code>等语句是爆红的，但是并不影响最后的运行结果！**写成<code>&lt;id property=&quot;user.id&quot; column=&quot;id&quot;&gt;&lt;/id&gt;</code>虽然xml文件不会报错，但是无法正常运行！！</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113037.png" alt="这里的xml文件爆红并不会影响最后结果的运行！" /></p>
<blockquote>
<p>之前的<a href="https://www.qingbo1011.top/2021/04/30/Mybatis02/#parametertype-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0">笔记</a>中已经提到过resultMap了，这里再补充一下</p>
<p>结果映射<code>&lt;resultMap&gt;</code>标签下的相关标签：</p>
<ul>
<li><code>&lt;constructor&gt;</code>：用于在实例化类时，注入结果到构造方法中
<ul>
<li><code>&lt;idArg&gt;</code>：ID 参数；标记出作为 ID 的结果可以帮助提高整体性能</li>
<li><code>&lt;arg&gt;</code>：将被注入到构造方法的一个普通结果</li>
</ul>
</li>
<li><strong><code>&lt;id&gt;</code></strong>： 一个 ID 结果；标记出作为 ID 的结果可以帮助提高整体性能**（通常用于指定主键字段）**</li>
<li><strong><code>&lt;result&gt;</code></strong>：注入到字段或 JavaBean 属性的普通结果**（通常用于指定非主键字段）**</li>
<li><strong><code>&lt;association&gt;</code></strong>：<strong>一个复杂类型的关联；许多结果将包装成这种类型</strong>
<ul>
<li><strong>嵌套结果映射：关联可以是 resultMap 元素，或是对其它结果映射的引用</strong></li>
</ul>
</li>
<li><strong><code>&lt;collection&gt;</code></strong>： <strong>一个复杂类型的集合</strong>
<ul>
<li><strong>嵌套结果映射：集合可以是 resultMap 元素，或是对其它结果映射的引用</strong></li>
</ul>
</li>
<li><code>&lt;discriminator&gt;</code>：使用结果值来决定使用哪个 resultMap
<ul>
<li><code>&lt;case&gt;</code>：基于某些值的结果映射
<ul>
<li>嵌套结果映射：case 也是一个结果映射，因此具有相同的结构和元素；或者引用其它的结果映射</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>具体可查看官网：<a href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps" target="_blank" rel="noopener">结果映射</a></p>
<p><strong>关于<code>&lt;association&gt;</code>更详细的说明可查看官网：<a href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps" target="_blank" rel="noopener">关联</a></strong></p>
<p><strong>关于<code>&lt;collection&gt;</code>更详细的说明可查看官网：<a href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps" target="_blank" rel="noopener">集合</a></strong></p>
</blockquote>
<p>最后在测试类中（执行代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 使用代理对象accountDao执行查询所有方法</span></span><br><span class="line">    List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">        System.out.println(<span class="string">"-------------每个account的信息（含所对应的user信息）---------------"</span>);</span><br><span class="line">        System.out.println(account);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113050.png" alt="" /></p>
<h2 id="mybatis多表查询之一对多查询"><a class="markdownIt-Anchor" href="#mybatis多表查询之一对多查询"></a> Mybatis多表查询之一对多查询</h2>
<blockquote>
<p>需求：查询所有用户信息及用户关联的账户信息</p>
<p>分析：<strong>用户信息和他的账户信息为一对多关系</strong>，<strong>并且查询过程中如果用户没有账户信息，此时也要将用户信息查询出来，我们想到了左外连接查询比较合适</strong></p>
</blockquote>
<p>对应的sql语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">`user`</span> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">account</span> <span class="keyword">ON</span> <span class="string">`user`</span>.id = account.UID</span><br></pre></td></tr></table></figure>
<p>查询结果为：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113102.png" alt="" /></p>
<p>修改User类：（添加了一个Account集合）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.qing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一对多关系映射(一个用户可能有多个账单)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; accounts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先在持久层接口（UserDao）添加代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有用户(如果用户有账单，要把账单信息也查询出来)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后在映射配置文件（UserDao.xml）中添加代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userAccountMap"</span> <span class="attr">type</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--collection 是用于建立一对多中集合属性的对应关系，ofType 用于指定集合的元素数据类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"top.qing.domain.Account"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"ID"</span> <span class="attr">column</span>=<span class="string">"aid"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"UID"</span> <span class="attr">column</span>=<span class="string">"UID"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"MONEY"</span> <span class="attr">column</span>=<span class="string">"MONEY"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置查询所有结果--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userAccountMap"</span>&gt;</span></span><br><span class="line">    SELECT account.ID aid,account.UID,account.MONEY,`user`.* FROM `user` LEFT JOIN account ON `user`.id = account.UID;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>&lt;collection&gt;</code>，部分定义了用户关联的账户信息。表示关联查询结果集</p>
<ul>
<li>property=“accounts”，表示关联查询的结果集存储在 User 对象的上哪个属性（我们这里当然是User对象的accounts属性）</li>
<li><strong>ofType=“top.qing.domain.Account”</strong>，指定关联查询的<strong>结果集中的对象类型</strong>即List中的对象类型。此处可以使用别名，也可以使用全限定名（我们这里accounts里的元素类型是Account，所以就写Account的全限定类名了）</li>
</ul>
</blockquote>
<p>最后在测试类中（执行代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 使用刚刚创建的代理对象userDao执行查询所有方法</span></span><br><span class="line">    List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113207.png" alt="" /></p>
<blockquote>
<p><strong><mark>小结</mark></strong>：在<code>&lt;resultMap&gt;</code>中</p>
<ul>
<li><strong>多对一（一对一）：使用<code>&lt;association&gt;</code>标签</strong></li>
<li><strong>一对多：使用<code>&lt;collection&gt;</code>标签</strong></li>
</ul>
</blockquote>
<h2 id="mybatis多表查询之多对多查询"><a class="markdownIt-Anchor" href="#mybatis多表查询之多对多查询"></a> Mybatis多表查询之多对多查询</h2>
<blockquote>
<p>上面我们使用 Mybatis实现了一对多关系的维护。<strong>多对多关系其实我们看成是双向的一对多关系</strong></p>
</blockquote>
<p>多对多关系举例：用户和角色</p>
<ul>
<li>一个用户可以有多个角色</li>
<li>一个角色可以赋予多个用户</li>
</ul>
<p>步骤：</p>
<ol>
<li>建立两张表：用户表，角色表（<strong>让用户表和角色表具有多对多的关系</strong>。需要<strong>使用中间表，中间表中包含各自的主键，在中间表中是外键</strong>）</li>
<li>建立两个实体类：用户实体类和角色实体类（让用户和角色的<strong>实体类能体现出来多对多的关系</strong>，<strong>各自包含对方一个集合引用</strong>）</li>
<li>建立两个配置文件
<ul>
<li>用户的配置文件</li>
<li>角色的配置文件</li>
</ul>
</li>
<li>实现配置：
<ul>
<li>当我们查询角色时，可以同时得到角色的所赋予的用户信息</li>
<li>当我们查询用户时，可以同时得到用户所包含的角色信息</li>
</ul>
</li>
</ol>
<blockquote>
<p>本次案例用户与角色的多对多关系模型如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113218.png" alt="" /></p>
</blockquote>
<p>对应的SQL语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`role`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`role`</span> (</span><br><span class="line">  <span class="string">`ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'编号'</span>,</span><br><span class="line">  <span class="string">`ROLE_NAME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色名称'</span>,</span><br><span class="line">  <span class="string">`ROLE_DESC`</span> <span class="built_in">varchar</span>(<span class="number">60</span>) <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色描述'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`ID`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`role`</span>(<span class="string">`ID`</span>,<span class="string">`ROLE_NAME`</span>,<span class="string">`ROLE_DESC`</span>) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">'院长'</span>,<span class="string">'管理整个学院'</span>),(<span class="number">2</span>,<span class="string">'总裁'</span>,<span class="string">'管理整个公司'</span>),(<span class="number">3</span>,<span class="string">'校长'</span>,<span class="string">'管理整个学校'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user_role`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> (</span><br><span class="line">  <span class="string">`UID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户编号'</span>,</span><br><span class="line">  <span class="string">`RID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色编号'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`UID`</span>,<span class="string">`RID`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`FK_Reference_10`</span> (<span class="string">`RID`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`FK_Reference_10`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`RID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`role`</span> (<span class="string">`ID`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`FK_Reference_9`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`UID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`user`</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`user_role`</span>(<span class="string">`UID`</span>,<span class="string">`RID`</span>) <span class="keyword">values</span> (<span class="number">41</span>,<span class="number">1</span>),(<span class="number">45</span>,<span class="number">1</span>),(<span class="number">41</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>然后创建User和Role的实体类，分别为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.qing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实现多对多关系（其实可以看做是双向一对多）</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.qing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line">    <span class="keyword">private</span> String roleDesc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实现多对多关系（其实可以看做是双向一对多）</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><mark>注意</mark></strong>：这里<strong>在Role实体类中我们并没有完全对应数据库的字段名，而是使用了Java的命名规范</strong>（即小驼峰命名），如数据库字段名ROLE_NAME在Java实体类属性中命名为roleName，所以后<strong>续就需要使用<code>&lt;resultMap&gt;</code></strong></p>
</blockquote>
<h3 id="查询角色同时得到角色的所赋予的用户信息"><a class="markdownIt-Anchor" href="#查询角色同时得到角色的所赋予的用户信息"></a> 查询角色同时得到角色的所赋予的用户信息</h3>
<p>首先来看一下SQL语句。<strong><mark>注意</mark></strong>，<strong>我们这里是先查询角色，然后在查询该角色所赋予的用户信息</strong>。<strong>重点在角色，即所有角色都要查询到，如果有用户信息就查出用户信息，没有用户信息就返回null</strong></p>
<p>所以就<strong>不能简单地使用内连接查询了，而应该使用两次外连接</strong>。SQL语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> role.ID <span class="keyword">AS</span> rid, role.ROLE_NAME, role.ROLE_DESC, <span class="string">`user`</span>.*</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">role</span></span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> user_role <span class="keyword">ON</span> role.ID = user_role.RID</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="string">`user`</span> <span class="keyword">ON</span> <span class="string">`user`</span>.id = user_role.UID</span><br></pre></td></tr></table></figure>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113228.png" alt="" /></p>
<p>首先在持久层接口（RoleDao）添加代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有角色，同时得到角色的所赋予的用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Role&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后在映射配置文件（RoleDao.xml）中添加代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注意别忘了配置resultMap，因为我们Role实体类的属性和数据库字段名称不一致--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"top.qing.domain.Role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleId"</span> <span class="attr">column</span>=<span class="string">"rid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"ROLE_NAME"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleDesc"</span> <span class="attr">column</span>=<span class="string">"ROLE_DESC"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"users"</span> <span class="attr">ofType</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--查询所有角色，同时得到角色的所赋予的用户信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">    SELECT role.ID AS rid, role.ROLE_NAME, role.ROLE_DESC, `user`.*</span><br><span class="line">FROM role</span><br><span class="line">LEFT JOIN user_role ON role.ID = user_role.RID</span><br><span class="line">LEFT JOIN `user` ON `user`.id = user_role.UID</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后在测试类中（执行代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 别忘了init()和destroy()方法</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    List&lt;Role&gt; roleList = roleDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (Role role : roleList) &#123;</span><br><span class="line">        System.out.println(role);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113240.png" alt="" /></p>
<h3 id="查询用户同时得到用户所包含的角色信息"><a class="markdownIt-Anchor" href="#查询用户同时得到用户所包含的角色信息"></a> 查询用户同时得到用户所包含的角色信息</h3>
<p>首先还是先看一下SQL语句。大体思路同上，只不过这一次主体是用户。SQL如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`user`</span>.*, role.ID <span class="keyword">AS</span> rid, role.ROLE_NAME, role.ROLE_DESC</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`user`</span></span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> user_role <span class="keyword">ON</span> <span class="string">`user`</span>.id = user_role.UID</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">role</span> <span class="keyword">ON</span> role.ID = user_role.RID;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113253.png" alt="" /></p>
<p>首先在持久层接口（UserDao）添加代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有用户(如果用户有角色，要把角色信息也查询出来)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后在映射配置文件（UserDao.xml）中添加代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"top.qing.domain.User"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roles"</span> <span class="attr">ofType</span>=<span class="string">"top.qing.domain.Role"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleId"</span> <span class="attr">column</span>=<span class="string">"rid"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"ROLE_NAME"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleDesc"</span> <span class="attr">column</span>=<span class="string">"ROLE_DESC"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--配置查询所有结果--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">       SELECT `user`.*, role.ID AS rid, role.ROLE_NAME, role.ROLE_DESC</span><br><span class="line">   FROM `user`</span><br><span class="line">LEFT JOIN user_role ON `user`.id = user_role.UID</span><br><span class="line">LEFT JOIN role ON role.ID = user_role.RID;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后在测试类中（执行代码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 别忘了init()和destroy()方法</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 使用刚刚创建的代理对象userDao执行查询所有方法</span></span><br><span class="line">    List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220505113304.png" alt="" /></p>
<p>（Mybatis会将重复结果智能放在一起）</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:qingbo1011@163.com">qingbo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.qingbo1011.top/2021/05/08/Mybatis03/">http://www.qingbo1011.top/2021/05/08/Mybatis03/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.qingbo1011.top" target="_blank">Qing's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mybatis/">Mybatis</a><a class="post-meta__tags" href="/tags/SSM/">SSM</a></div><div class="post_share"><div class="social-share" data-image="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20231003161115.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/05/10/Mybatis04/"><img class="prev_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Mybatis（四）</div></div></a></div><div class="next-post pull_right"><a href="/2021/04/30/Mybatis02/"><img class="next_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png" onerror="onerror=null;src='https://gitee.com/qingyu1011/blog_img/raw/master/img/20201006230435.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mybatis（二）</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/04/28/Mybatis01/" title="Mybatis（一）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-04-28</div><div class="relatedPosts_title">Mybatis（一）</div></div></a></div><div class="relatedPosts_item"><a href="/2021/04/30/Mybatis02/" title="Mybatis（二）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-04-30</div><div class="relatedPosts_title">Mybatis（二）</div></div></a></div><div class="relatedPosts_item"><a href="/2021/05/10/Mybatis04/" title="Mybatis（四）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-05-10</div><div class="relatedPosts_title">Mybatis（四）</div></div></a></div><div class="relatedPosts_item"><a href="/2021/05/13/Spring01/" title="Spring（一）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504095341.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-05-13</div><div class="relatedPosts_title">Spring（一）</div></div></a></div><div class="relatedPosts_item"><a href="/2021/05/17/Spring02/" title="Spring（二）"><img class="relatedPosts_cover" src="https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504095341.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-05-17</div><div class="relatedPosts_title">Spring（二）</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'oNS5Emx1qUL3wN5yvPLKol0W-gzGzoHsz',
  appKey: 'ytbw0ho3DMX0FeoAOWa37lf9',
  notify: false,
  verify: false,
  placeholder: 'Stay hungry,stay foolish~',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: 'https://',
  emojiMaps: {"欢呼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100836.gif","笑眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100849.gif","花心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100907.gif","吐舌":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100937.gif","疑问":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502100951.gif","滑稽":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101004.gif","太开心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101017.gif","酷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101029.gif","怒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101044.gif","阴险":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101100.gif","委屈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101116.gif","乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101129.gif","你懂的":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101204.gif","小乖":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101215.gif","突然兴奋":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101228.gif","喷":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101241.gif","哈哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101255.gif","喝酒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101305.gif","汗":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101323.gif","笑尿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102004.gif","嘿嘿嘿":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102018.gif","真棒":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102047.gif","托腮":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102108.gif","微笑":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e3/2018new_weixioa02_org.png","礼貌":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/09/2018new_keai_org.png","笑哭":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/4a/2018new_xiaoku_thumb.png","无奈":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/83/2018new_kuxiao_org.png","爱你":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f6/2018new_aini_org.png","吃瓜":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/01/2018new_chigua_thumb.png","doge":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a1/2018new_doge02_org.png","dog":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/22/2018new_erha_org.png","cat":"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7b/2018new_miaomiao_thumb.png","星星眼":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102225.png","酸了":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102240.png","大哭":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102254.png","傲娇":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102314.png","给心心":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102328.png","嘿哈":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102345.png","custom0":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101410.gif","custom1":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101424.webp","狗头":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101710.png","搬砖中":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502101744.png","忙到飞起":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102411.png","裂开":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102426.png","叹气":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102439.png","让我看看":"https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220502102456.png","panda0":"https://bbs.res.meizu.com/static/image/smiley/panda/_000.png","panda1":"https://bbs.res.meizu.com/static/image/smiley/panda/_001.png","panda2":"https://bbs.res.meizu.com/static/image/smiley/panda/_002.png","panda3":"https://bbs.res.meizu.com/static/image/smiley/panda/_003.png","panda4":"https://bbs.res.meizu.com/static/image/smiley/panda/_004.png","panda5":"https://bbs.res.meizu.com/static/image/smiley/panda/_005.png","panda6":"https://bbs.res.meizu.com/static/image/smiley/panda/_006.png","panda7":"https://bbs.res.meizu.com/static/image/smiley/panda/_007.png","panda8":"https://bbs.res.meizu.com/static/image/smiley/panda/_008.png","panda9":"https://bbs.res.meizu.com/static/image/smiley/panda/_009.png","panda10":"https://bbs.res.meizu.com/static/image/smiley/panda/_010.png","panda11":"https://bbs.res.meizu.com/static/image/smiley/panda/_011.png","panda12":"https://bbs.res.meizu.com/static/image/smiley/panda/_012.png","panda13":"https://bbs.res.meizu.com/static/image/smiley/panda/_013.png","panda14":"https://bbs.res.meizu.com/static/image/smiley/panda/_014.png","panda15":"https://bbs.res.meizu.com/static/image/smiley/panda/_015.png","panda16":"https://bbs.res.meizu.com/static/image/smiley/panda/_016.png","panda17":"https://bbs.res.meizu.com/static/image/smiley/panda/_017.png","panda18":"https://bbs.res.meizu.com/static/image/smiley/panda/_018.png","panda19":"https://bbs.res.meizu.com/static/image/smiley/panda/_019.png","panda20":"https://bbs.res.meizu.com/static/image/smiley/panda/_020.png","panda21":"https://bbs.res.meizu.com/static/image/smiley/panda/_021.png","panda22":"https://bbs.res.meizu.com/static/image/smiley/panda/_022.png","panda23":"https://bbs.res.meizu.com/static/image/smiley/panda/_023.png","panda24":"https://bbs.res.meizu.com/static/image/smiley/panda/_024.png","panda25":"https://bbs.res.meizu.com/static/image/smiley/panda/_025.png","panda26":"https://bbs.res.meizu.com/static/image/smiley/panda/_026.png","panda27":"https://bbs.res.meizu.com/static/image/smiley/panda/_027.png","panda28":"https://bbs.res.meizu.com/static/image/smiley/panda/_028.png","panda29":"https://bbs.res.meizu.com/static/image/smiley/panda/_029.png"},
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://img-qingbo.oss-cn-beijing.aliyuncs.com/img/20220504105319.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By qingbo</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">宇宙很大，生活更大</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>